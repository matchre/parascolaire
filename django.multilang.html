<!DOCTYPE html>
<html lang="{{fr|en}}">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" /> 
        <link href="django-with-bird.png" rel="icon" type="image/png" />
        <title>Apprenez à programmer un site web avec Django !</title>
        
        <meta property="og:image" content="https://robertvandeneynde.be/parascolaire/django-with-bird.png" />
        <meta property="og:description" content="Apprenez à programmer un site web avec Django" />
        <!-- <meta property="og:url" content="" /> -->
        <meta property="og:title" content="Apprenez à programmer un site web avec Django" />
        <meta property="og:type" content="article" /> 
        
        <link rel="stylesheet" type="text/css" href="base.css" />
        <script src="https://code.jquery.com/jquery-2.1.4.js"></script>
        <script src="animations.js"></script>
        <script src="utils.js"></script>
        <script src="slides.js"></script>
        <style>
            body {
                background: url('diamond.jpg');
                background-size: 400px;
            }
            img:not(.free), pre {
                max-width: 100%;
            }
            pre {
                overflow-x: auto;
                border: 1px solid #ccc;
            }
            figcaption:not(.mandatory) {
                display: none;
            }
            p code.hljs {
                display: inline !important;
            }
            :not(pre) > code {
                border: 1px solid #ccc;
                display: inline-block;
                padding: 2px !important;
            }
            table {
                border-collapse: collapse;
            }
            table td, table th {
                border: 1px solid #ddd;
                padding: 5px;
            }
            kbd {
                border: 1px solid #ccc;
                display: inline-block;
                padding: 2px;
                font-family: serif;
                border-radius: 5px;
                background: white;
            }
            table.shortcuts > tbody > tr > td:first-child {
                text-align: center;
                min-width: 160px;
            }
            table.shortcuts em {
                font-style: normal;
            }
            tr {
                background-color: rgb(252, 252, 255);
            }
            tr.interesting-row {
                background: rgb(255, 251, 221); /* rgb(255, 250, 240); */
            }
            .slide.next {
                cursor: pointer;
            }
            
            p.comment, ul.comment, ol.comment {
                font-style: italic;
            }
            p.comment {
                margin-left: 20px;
            }
            
            code.url {
                color: #001eff !important;
            }
            figcaption.mandatory {
                font-style: italic;
                padding-left: 20px;
            }
            
            .little-box {
                border: 1px solid black;
                border-left: 0;
                border-right: 0;
                padding: 5px 0;
            }
            button {
                cursor: pointer;
            }
        </style>
        
        <link id="stylesheet" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/default.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/highlight.min.js"></script>
        <script>
        $(function(){
            $('figure.half-size img').each(function(){
                var self = this;
                function applyWidth() {
                    // console.log('applyWidth', self.id, self.src, self.width, $(self).width())
                    if(self.width) { // attention, self.width != $(self).width()
                        $(self).css('max-width', self.width / 2)
                    } else {
                        setTimeout(applyWidth, 1000);
                    }
                }
                
                applyWidth();
                
                $(this).wrap( $('<a>').attr('href', $(this).attr('src') ) )
                $(this).parent().append(
                    $("<figcaption class='mandatory'>Cliquez pour agrandir</figcaption>"))
            })
            
            $('pre.developpement').addClass('closable') // must be before next block
        
            var DEFAULT_SYMBOL = '{{Solution|Solution}}';
            $('.developpement').each(function(){
                var self = $(this)
                
                var substitute = $('<button>').text(
                    (self.attr('symbol') == 'iff' ? '⇔' : self.attr('symbol') != null ? self.attr('symbol') : DEFAULT_SYMBOL)
                    + ' ... '
                    + (self.attr('symbolpost') == 'iff' ? '⇔' : self.attr('symbolpost') != null ? self.attr('symbolpost') : '')
                );
                
                this.substitute = substitute;
                
                self.hide().before(substitute)
                substitute.click(function(){
                    substitute.hide()
                    self.fadeIn(800)
                })
                
                if(self.hasClass('closable')) {
                    self.css('position', 'relative')
                    self.append($('<button>&#x274c;</button>').css({ // &#x2715; &times; https://stackoverflow.com/questions/7493954/what-is-the-unicode-character-for-the-close-symbol-used-by-twitter-bootstrap#17622391
                        position: 'absolute',
                        top: '0px',
                        right: '0px',
                        transform: self.is('pre') ? '' : 'translate(0, -50%)',
                        cursor: 'pointer',
                    }).click(function(){
                        // self.fadeOut(300, function(){ substitute.show() })
                        self.hide()
                        substitute.show()
                    }))
                }
            })
            
            $(".open-all-developpement").click(function(){
                var p = $(this).parent()
                if(p.prop('tagName').toLowerCase() != 'section')
                    p = $(document.body)
                
                p.find('.developpement').each(function(){
                    if(! this.substitute)
                        return console.log('error, .developpement has no substitute')
                    
                    if($(this.substitute).is(':visible')) {
                        $(this.substitute).click()
                    }
                })
                
                if(p.attr('name'))
                    location.hash = '#' + p.attr('name')
                
                $(this).hide()
            })
        });
        </script>
        <script>
            $(function(){
                utils.dedentPreCode()
                var COMMENT_ELEM = [
                    ['py', ['# ', '']],
                    ['html', ['&lt;!-- ', ' -->']],
                ]
                
                function forEachComment(callback) {
                    for(var i = 0; i < COMMENT_ELEM.length; i++)
                        callback(COMMENT_ELEM[i][0], COMMENT_ELEM[i][1])
                }
                
                $('pre.developpement').each(function(){
                    var pre = $(this)
                    var code = pre.find('code')
                    
                    if(! code.attr('class')) {
                        forEachComment(function(k, l) {
                            if(pre.attr('symbol').indexOf('.' + k) != -1)
                                code.addClass(k)
                        })
                    }
                    
                    forEachComment(function(k, l) {
                        if(code.hasClass(k))
                            code.html(l[0] + pre.attr('symbol') + l[1] + '\n\n' + $(code).html())
                    })
                })
                
                $('[contains-code]').each(function(){
                    var cls = $(this).attr('contains-code')
                    $(this).find('code:not([class])').addClass(cls)
                })
                
                hljs.initHighlightingOnLoad()
                $('p > code[class]').each(function(i, block) {
                    hljs.highlightBlock(block);
                    // console.log($(block).text())
                });
                utils.makeTitleLinks()
                utils.smoothLinks()
                
                function replaceUrls(hostname) {
                    $('code.url, .contains-group').each(function(){
                        var is_group = $(this).is('.contains-group')
                        var is_code_url = $(this).is('code.url')
                        
                        if(! $(this).data('base-url')) {
                            var path = $(this).text()
                            $(this).data('base-url', path)
                            if(! is_group)
                                $(this).wrap('<a>')
                        } else {
                            var path = $(this).data('base-url')
                        }
                        
                        if(is_group) {
                            if(hostname.indexOf('127.0.0.1') != -1)
                                var username = 'infosgr42'
                            else
                                var username = hostname.split('.')[0] || 'infosgr42'
                            $(this).text(path.replace(/infosgr42/g, username).replace(/username/g, username))
                        } else { // code.url
                            if(path.indexOf('127.0.0.1:8000') != -1) {
                                var url = path.replace('127.0.0.1:8000', hostname)
                                $(this).text(url);
                            } else {
                                var url = hostname + path
                            }
                            $(this).parent().attr('href', 'http://' + url)
                        }
                        
                    })
                }
                
                replaceUrls('127.0.0.1:8000')
                
                $('#group_selector_ok').click(function() {
                    var s = $('#group_selector').val()
                    // var m = /^infosgr(\d+)$/.exec(s.toLowerCase().trim()) || /^(\d+)$/.exec(s.toLowerCase().trim())
                    var m = /^(\d+)$/.exec(s.toLowerCase().trim())
                    var username = m ? 'infosgr' + parseInt(m[1]) : s.trim()
                    
                    replaceUrls(username + '.pythonanywhere.com')
                    
                    var saved = $('#group_selector_saved');
                    
                    if(! saved.data('orignal-template'))
                        saved.data('orignal-template', saved.text() )
                    
                    saved.text( saved.data('orignal-template').replace('{username}', username) ).show()
                    
                    setTimeout(function(){
                        saved.fadeOut();
                    }, 3000);
                })
                
                $('#group_selector').on('keyup', function(ev){
                    if(ev.keyCode == 13) {
                        $('#group_selector_ok').trigger('click')
                        ev.target.blur()
                    }
                })
                
                $('#group_selector_saved').hide()
                
                $('#group_selector_saved').click(function(){
                    $(this).fadeOut()
                })
            })
        </script>
    </head>
    <body class="algos">
    <div id="wrapper">
        <h1><!-- class="nocontent"
            --><a class="homeicon" href="index.html"></a><!--
            --><span class="text">Apprenez à programmer un site web avec Django</span><!--
        --></h1>
        <section>
        
            <p>Bienvenue dans le tutoriel django, voici une liste d'exercice à faire pour bien comprendre les concepts de base de django !
            
            <p>Dans ce tutoriel, nous ferons un site de sondage, appelé <code>askme</code>, c'est une version simplifiée du <a href="https://docs.djangoproject.com/en/2.0/intro/tutorial01/">tutoriel django officiel</a>, nous serons capables de :</p>
            <ul>
                <li>Créer une question.</li>
                <li>Voir la liste des questions et cliquer dessus pour la voir en détail.</li>
                <li>Avoir les réponses possibles à une question en cas de choix multiple.</li>
                <li>Répondre à une question.</li>
                <li>Voir les résultats d'une question.</li>
                <li>Bien séparer les questions par <em>catégories</em> (Sport, Sciences, Culture).</li>
                <li>Ne voir que les résultats quand la date de fin est passée.</li>
                <li>Limiter la création des questions aux administrateurs.</li>
            </ul>
            
            <p class="comment">Les paragraphes en italique indiquent une information complémentaire non nécessaire pour la compréhesion et la réussite du cours, bien entendu, ça peut toujours aider.
                C'est un peu comme une section « Pour en savoir plus ».
            <p class="comment">Pour faire un site économique du style, <em>marketplace</em>,
                on choisira un nom comme <code>funnycoin</code> et non <code>askme</code>, on y verra quelques opérations de base du même style dans ce but.
            
        </section>
        
        <nav>
            <a href="django.{{en|fr}}.html"><img src="flag-{{en|fr}}.png" /></a>
        </nav>
        
        <nav>
            <a href="#{{prerequis|prerequisites}}">Prérequis</a>
        </nav>
        
        <nav>
            <a href="#{{site-statique|static-site}}">Site statique</a>
            <a href="#{{bdd|db}}">Lire une base de données</a>
            <a href="#form">Formulaires</a>
            <a href="#{{bddr|rdb}}">Bases de données <em>relationnelles</em></a>
        </nav>
        
        <h2 id="{{prerequis|prerequisites}}">Prérequis</h2>
        
        <section name="{{prerequis|prerequisites}}">
            <p class="lang-switch"><a href="django.{{en|fr}}.html#{{prerequis|prerequisites}}" lang="{{en|fr}}" hreflang="{{en|fr}}"><img style="vertical-align:middle; margin-right: 5px;" src="flag-{{en|fr}}.png"/>{{English here!|Français ici !}}</a>

            <p>Une petite connaissance préalable de python est conseillée, vous pouvez avoir un petit rappel de théorie sur mon site
                <a href="https://robertvandeneynde.be/parascolaire">de programmation pour débutants</a> :
            
            <ol>
                <li>Cliquez sur le petit fichier qui tient sur deux pages
                    <a href="https://robertvandeneynde.be/parascolaire/theorie1_egal_if_fr.html">theorie1</a>
                    ou bien regardez ou sa <a href="https://youtu.be/zJ-w2izNvg4">vidéo en bêta</a> !
                    
                    Ensuite, essayez de faire les exercices 0, 1, 2, 3, voire 4.
                    
                <li>Ensuite lisez le fichier
                    <a href="https://robertvandeneynde.be/parascolaire/theorie2_liste_while.html">theorie2</a>
                    qui tient aussi sur deux pages,
                    essayez de faire au moins l'exercice 5, mais vous pouvez tenter les 6, 7, 8, 9.
                    
                <li>Finalement si vous êtes chaud, lisez le fichier
                    
                    <a href="https://robertvandeneynde.be/parascolaire/theorie3_fonctions_et_objets.html">theorie3</a>
                    qui tient peut-être sur plus de deux pages.
                        
                <li>Et si vous êtes encore plus chaud, vous pouvez même lire les parties <em>Pour en savoir plus</em>
                    ou bien mes fichiers dont les noms commencent par <a href="https://robertvandeneynde.be/parascolaire/#progra">progra</a> !
            </ol>
            
            <nav class="external">
            
                <a href="https://robertvandeneynde.be/parascolaire">
                    Programmation pour débutants </a>
                
                <ul>
                  <li> <a href="https://robertvandeneynde.be/parascolaire/theorie1_egal_if_fr.html">
                    Théorie 1</a>
                
                  <li> <a href="https://youtu.be/zJ-w2izNvg4">
                    Vidéo de la théorie 1 (en bêta)</a>
                    
                    <ul>
                      <li> <a href="https://robertvandeneynde.be/parascolaire/exercice0_trier_deux_nombres.py.html">
                        Exercice 0 </a>
                        
                      <li> <a href="https://robertvandeneynde.be/parascolaire/exercice1_minute_suivante.py.html">
                        Exercice 1 </a>
                    
                      <li> <a href="https://robertvandeneynde.be/parascolaire/exercice2_minute_suivante_un_print.py.html">
                        Exercice 2 </a>
                    
                      <li> <a href="https://robertvandeneynde.be/parascolaire/exercice3_trier_trois_nombres.py.html">
                        Exercice 3 </a>
                    
                      <li> <a href="https://robertvandeneynde.be/parascolaire/exercice4_le_sept_parfait.py.html">
                        Exercice 4 (facultatif) </a>
                    </ul>
                  </li>
                    
                  <li> <a href="https://robertvandeneynde.be/parascolaire/theorie2_liste_while.html">
                    Théorie 2</a>
                    
                    <ul>
                        <li> <a href="https://robertvandeneynde.be/parascolaire/exercice5_max_list.py.html">
                            Exercice 5 </a>
                            
                        <li> <a href="https://robertvandeneynde.be/parascolaire/exercice6_in_list.py.html">
                            Exercice 6 (facultatif) </a>
                        
                        <li> <a href="https://robertvandeneynde.be/parascolaire/exercice7_filtre_des_grands.py.html">
                            Exercice 7 (facultatif) </a>
                        
                        <li> <a href="https://robertvandeneynde.be/parascolaire/exercice8_somme.py.html">
                            Exercice 8 (facultatif) </a>
                            
                        <li> <a href="https://robertvandeneynde.be/parascolaire/exercice9_doublons.py.html">
                            Exercice 9 (facultatif) </a>
                    </ul>
                  </li>
                
                  <li> <a href="https://robertvandeneynde.be/parascolaire/theorie3_fonctions_et_objets.html">Théorie 3</a>
                  <li> <a href="https://robertvandeneynde.be/parascolaire/#progra">Plus de programmation</a>
                  
                </ul>
            </nav>
        </section>
        
        <h2 id="{{site-statique|static-site}}">Un site statique</h2>
        
        <section name="{{site-statique|static-site}}">
            <p class="lang-switch"><a href="django.{{en|fr}}.html" lang="{{en|fr}}" hreflang="{{en|fr}}"><img style="vertical-align:middle; margin-right: 5px;" src="flag-{{en|fr}}.png"/>{{English here!|Français ici !}}</a>
            
            <button class="open-all-developpement">Cliquez ici pour faire apparaître toutes les corrections et annexes !</button>
            
            <p>Lors de mes présentations, j'ai parlé du protocole http, et de la communication entre client et serveur qui ressemblait à un envoi de lettres postales.
            Maintenant, place au code django !
            
            <p class="comment">Créez un projet django vide, si vous avez du mal, demandez à vos voisins !
                J'ai quelques machines virtuelles sous la main si vous voulez facilement vous lancer,
                ou bien vous pouvez simplement créer un compte sur <a href="https://pythonanywhere.com">pythonanywhere.com</a> que vous soyez sous Windows ou Mac.
                
            <!--
            <div class="developpement" symbol="startproject on pythonanywhere">
                <p>Ouvre l'onglet <em>Console</em>, et entrez les commandes suivantes :
                
                <pre><code class="bash">
                mkvirtualenv django2 --python=/usr/bin/python3.6
                pip install django
                python3 -m django startproject mysite
                mv mysite project
                cd project
                python manage.py startapp askme
                </code></pre>
                
                <p>Dans l'onglet <em>Files</em>, vous devriez avoir un dossier <code>project</code> qui contient un dossier <code>mysite</code> et <code>askme</code> !
                
                <p>Dans l'onglet <em>Web</em>, indiquez <code>/home/myusername/.virtualenv/django2</code> dans le champ <em>Virtualenv</em>.
                
                <p>Ensuite, créez un fichier dans votre home appelé <code>wsgi.py</code>, on aura donc en <code>/home/myusername/wsgi.py</code> :
                
                <pre><code class="py">
                    import os
                    import sys

                    path = os.path.expanduser('~/project')
                    if path not in sys.path:
                        sys.path.append(path)
                    os.environ['DJANGO_SETTINGS_MODULE'] = 'mysite.settings'
                    from django.core.wsgi import get_wsgi_application
                    from django.contrib.staticfiles.handlers import StaticFilesHandler
                    application = StaticFilesHandler(get_wsgi_application())
                </code></pre>
                
                <p>Et dans l'onglet <em>Web</em>, indiquez <code>/home/myusername/wsgi.py</code> dans le champ nommé <em>WSGI configuration file</em>.
                
                <p>Finalement, lancez le serveur dans l'onglet <em>Web</em>en cliquant sur <em>Reload</em>.
                    Veuillez noter qu'en bas de la plage, il y a un truc qui s'appelle <code>error.log</code>,
                    que vous pouvez lire si vous vous doutez que <em>Reload</em> a créé une erreur,
                    après avoir cliqué dessus, vous devrez aller tout en bas de la page pour avoir les messages les plus récents.
                    
                <p>Afin que les urls marchent, il faudra ouvrir le fichier <code>mysite/urls.py</code> et y ajouter des lignes pour qu'il soit comme ceci :
                
                <pre><code class="py">
                from django.contrib import admin
                from django.urls import include, path

                urlpatterns = [
                    path('admin/', admin.site.urls),
                    path('', include('appaskme.urls')),
                ]
                </code></pre>

            </div>
            -->
                
            <!--
            <div class="developpement" symbol="startproject on linux">
                <p>Si vous êtes nouveau sur linux, pas besoin de virtualenv, utilisez le <code>python3</code> déjà installé sur votre distribution :
                
                <pre><code class="bash">
                pip3 install Django==2.0
                python3 -m django startproject mysite
                mv mysite project
                cd project
                python3 manage.py startapp askme
                </code></pre>
                
                <p>Cela a créé un dossier <code>project</code> qui contient un dossier <code>mysite</code> et <code>askme</code> !
                
                <p>Pour lancer le serveur, <code>python3 manage.py runserver</code>, observez bien ce qui est affiché là-bas, ça peut être utile.
                
                <p>Finalement, je vous demande d'ouvrir le fichier <code>mysite/urls.py</code> et d'y ajouter des lignes pour qu'il soit comme ceci :
                
                <pre><code class="py">
                from django.contrib import admin
                from django.urls import include, path

                urlpatterns = [
                    path('admin/', admin.site.urls),
                    path('', include('appaskme.urls')),
                ]
                </code></pre>
            </div>
            -->
            
            <p class="comment">Essayez de faire les exercices. Ensuite, si vous n'arrivez pas, regardez la solution en cliquant sur les boutons !
            Si nous n'arrivez pas à faire un exercice, pas de panique, la correction est là pour vous aider et probablement que vous comprendrez mieux lors d'un exercice ultérieur.
            
            <p>Dernière petite remarque : Django est <strong>vaste</strong>, il permet souvent de faire une chose de <strong>beaucoup de manières différentes</strong>,
                ici je me concentre sur les fonctionnalités que je juge <strong>fondamentales</strong>, indispensables pour la création d'un site web.
            
            <!-- Concept d'enveloppe, headers, communication client serveur, poste = ip, address = addresse ip -->
            
            <h3 id="exerci{{c|s}}e-1">Exerci{{c|s}}e 1{{ |}}: Les urls et les vues</h3>
            
            <p>Lancez le serveur.
            
            <p class="comment">
                Pour faire cela sur pythonanywhere, c'est déjà configuré et vous devez juste cliquer sur <em>Reload</em> dans l'onglet <em>Web</em> de pythonanywhere.
            
            <!--
            <p class="comment">
                Si vous utilisez une machine virtuelle et Eclipse, allez dans Eclipse et faites <em>Run as > Django application</em>
                ou via le terminal comme un pro <code class="bash">python3 manage.py runserver</code>. -->
                
            <p>Que se passe-t-il quand je vais sur <code class="url">127.0.0.1:8000/</code> ?
                
            <p class="comment" style="line-height:2em;">Si vous êtes sur pythonanywhere, vous devrez plutôt aller sur <code class="bash contains-group">infosgr42.pythonanywhere.com/</code>
                en remplaçant bien <code class="bash contains-group">infosgr42</code> par votre propre nom d'utilisateur, du coup
                entrez votre nom d'utilisateur : <input type="int" placeholder="infosgr42" style="width:120px; text-align:center;" id="group_selector"/>
                puis cliquez sur <button id="group_selector_ok">Ok</button> pour mettre à jour la page.
                
                <span id="group_selector_saved" style="border: 1px solid #0c0; background: #090; color: white; padding: 5px; text-wrap:nowrap;">Page mise à jour pour {username} !</span>
            
            <p class="developpement little-box closable">
                Il est marqué <em>It works</em> et la petite fusée de Django est affichée.
            
            <p>Et quand je vais sur <code class="url">127.0.0.1:8000/hello</code> ?
            
            <p class="developpement little-box closable">
                Erreur 404, et on voit la liste des urls disponibles, il n'y a que <code>admin/</code>
            
            <h4>Première url</h4>
            <p>Faites une page à l'url <code class="url">/hello</code>, qui va afficher <em>Coucou les amis !</em>
            
            <p>Pour cela, vous devrez modifier (ou créer) le fichier <code>urls.py</code> qui se trouve dans le dossier <strong>de votre app</strong> (dossier <code>askme/</code>).
            <div class="developpement little-box closable" symbol="Créer un fichier sur pythonanywhere">
                <p>Pour créer un fichier dans pythonanywhere, naviguer dans le bon dossier, puis à droite où il est marqué <em>Enter new filename</em>, écrivez <code>urls.py</code> (attention, <strong>avec l'extension</strong> <code>.py</code>)
                et appuyez sur <kbd>Enter</kbd>.
                
                <figure class="half-size">
                    <img src="screenshot_pythonanywhere_newfile.png" />
                </figure>
                
                <p>Ensuite, vous n'avez qu'à cliquer sur le fichier et un éditeur de texte apparaîtra, n'oubliez pas de <strong>Sauver</strong> le fichier après modification en cliquant sur <em>Save</em>
                en haut à droite de l'écran.
                
                <p>Sur pythonanywhere, quand vous modfier un fichier de code, vous devez souvent <em>Reload</em> le serveur, allez dans l'onglet <em>Web</em> et cliquez sur le gros bouton <em>Reload</em>.
            </div>
            <p></p>
            
            <pre class="developpement" symbol="urls.py (django 2.0)"><code class="py">
            from django.urls import path

            from . import views

            urlpatterns = [
                path('hello', views.dire_bonjour),
            ]
            </code></pre>
            
            <!--
            <pre class="developpement" symbol="urls.py (django 1.11)"><code class="py">
            from django.conf.urls import url

            from . import views

            urlpatterns = [
                url(r'^hello$', views.dire_bonjour),
            ]
            </code></pre>
            -->
            
            <p>On dit donc que quand on va sur l'<strong>url</strong> <code>hello/</code>, <!-- because it doesn't begin with a slash, one could not write code class="url" -->
                on va dans <code>views.dire_bonjour</code>, il faut donc aller dans <code>views.py</code> et y définir <code>dire_bonjour</code>.
            
            <p>Vous devrez donc également modifier (ou créer) le fichier <code>views.py</code> qui se trouve dans le même dossier.
                Remarquez que certains projets utilisent un <strong>dossier</strong> <code>views/</code>, dans ce cas, suivez <a href="#dossier-views">ces instructions</a>,
                on y verra :
            
            <pre class="developpement" symbol="views.py"><code class="py">
            from django.http import HttpResponse
            
            def dire_bonjour(request):
                return HttpResponse("Coucou les amis !")
            </code></pre>
            
            <p class="comment">Attention à la version de django, ce tutoriel est sous django 2.0, mais certains tutoriels sont encore en 1.11 où déjà la première ligne de <code>urls.py</code>
                est différente.
            
            <div id="dossier-views"></div>
            <p class="comment">Si on a vraiment beaucoup d'urls, vous pouvez choisir de ne pas faire un
                <strong>fichier</strong> <code class="bash">views.py</code>
                mais d'avoir un <strong>dossier</strong> <code class="bash">views/</code>,
                dans ce cas vous devez créer un (ou plusieurs) fichier(s) <code class="bash">.py</code> dans le dossier <code class="bash">views/</code>,
                comme par exemple <code>base.py</code>, vous devrez alors écrire <code class="bash">urls.py</code> comme ceci  :
            
            <pre class="developpement" symbol="urls.py (django 2.0 avec dossier views)"><code class="py">
            from django.urls import path

            from . import views
            <mark>from .views import base</mark>

            urlpatterns = [
                path('hello', views<mark>.base</mark>.dire_bonjour),
            ]
            </code></pre>
            
            <pre class="developpement" symbol="views/base.py (django 2.0 avec dossier views)"><code class="py">
            from django.http import HttpResponse
            
            def dire_bonjour(request):
                return HttpResponse("Coucou les amis !")
            </code></pre>
            
            <p>Que se passe-t-il maintenant quand je vais sur <code class="url">/hello</code> ?
            
            <p class="developpement little-box closable">
                On voit <em>Coucou les amis !</em>
            
            <p>Et quand je vais sur <code class="url">/superapp</code> ?
            
            <p class="developpement little-box closable">
                Une erreur 404
            
            <h4>Une autre url</h4>
            
            <p>Je vous ai montré une url en exemple, donc mainteant à vous d'en faire une autre,
                j'aimerais que quand on va sur <code class="url">/cv</code>, on y voit :
                
            <ul>
                <li><em>Cv de René : Surfeur, programmeur mais humain avant tout</em></li>
            </ul>
            
            <pre class="developpement" symbol="urls.py (django 2.0 avec dossier views)"><code class="py">
            from django.urls import path

            from . import views
            <mark>from .views import base</mark>

            urlpatterns = [
                path('hello', views<mark>.base</mark>.dire_bonjour),
                <mark>path('cv', views.montrer_cv),</mark>
            ]
            </code></pre>
            <pre class="developpement" symbol="views.py"><code class="py">
            from django.http import HttpResponse
            
            def dire_bonjour(request):
                return HttpResponse("Coucou les amis !")
            
            <mark>def montrer_cv(request):</mark>
                <mark>return HttpResponse("Cv de René : Surfeur, programmeur mais humain avant tout")</mark>
            </code></pre>
            
            <p>Quand on va sur l'<strong>url</strong> <code>/cv</code>, on va dans la <strong>fonction</strong> <code>montrer_cv</code> qui se trouve dans <code>views</code>.
                Petit rappel, <code class="py">def</code> définit une fonction comme dit dans <a href="https://robertvandeneynde.be/parascolaire/theorie3_fonctions_et_objets.html">theorie3</a>.
            
            <p>Le fichier contient donc maintenant deux fonctions, <code>dire_bonjour</code> et <code>montrer_cv</code>, on peut en créer autant que l'on veut.
            
            <p>Remarquez que j'aurais également pu appeler mes fonctions <code class="py">hello</code> et <code class="py">cv</code>
                en écrivant <code style="white-space:nowrap" class="py">def hello(request)</code> et <code style="white-space:nowrap" class="py">def cv(request)</code> dans <code class="bash">views.py</code>
                pour que chaque fonction aie le même nom que son url, mais j'ai préféré faire la différence.
            
            <h3 id="exerci{{c|s}}e-2">Exerci{{c|s}}e 2{{ |}}: Du html !</h3>
            
            <p>Comment mettre par exemple <em>René</em> en <strong>gras</strong> ?
            
            <pre class="developpement" symbol="views.py"><code>
            from django.http import HttpResponse

            def dire_bonjour(request):
                return HttpResponse("Coucou les amis !")
        
            def montrer_cv(request):
                return HttpResponse("Cv de &lt;strong>René&lt;/strong>: Surfeur, programmeur mais humain avant tout")
            </code></pre>
            
            <p class="comment">Remarquez maintenant qu'il y a une différence entre ce qu'on a envoyé (le code html) et ce qui est affiché à l'utilisateur par le navigateur (la page).
                Faites un clic droit sur la page et cliquez sur <strong>Afficher la source</strong>, vous verrez le html qu'on a envoyé.
            
            <p class="comment">
                Pour afficher la source, sous Google Chrome ou Firefox, il existe le raccourci <kbd>Ctrl</kbd>+<kbd>U</kbd> ou <kbd>⌘ Cmd</kbd>+<kbd>U</kbd> sous Mac,
                si vous êtes sous <em>Safari</em> et que vous ne voulez pas télécharger Google Chrome,
                <a href="https://coolestguidesontheplanet.com/safari-web-developer-tools-show-dock-browser-window/">allez dans les options avancées</a>
                et activez <em>montrer l'url en entier</em> (tout en haut) et <em>montrer les outils de développement</em>
                (tout en bas) ce qui fera que vous pourrez y accéder avec un clic droit.
            
            <p>Et comment lister ses compétences dans une liste comme celle-ci :
            
            <ul>
                <li>Surfeur
                <li>Programmeur
                <li>Humain avant tout
            </ul>
            
            <pre class="developpement" symbol="views.py"><code class="py">
            def montrer_cv(request):
                return HttpResponse("Cv de &lt;strong>René&lt;/strong>: &lt;ul> &lt;li>Surfeur&lt;/li> &lt;li>Programmeur&lt;/li> &lt;li>Mais humain avant tout&lt;/li> &lt;/ul>")
            </code></pre>
            
            <h3 id="exerci{{c|s}}e-3">Exerci{{c|s}}e 3{{ |}}: Un template pour René</h3>
            
            <p>Cela devient un peu confus de mettre des données dans le code python, vous imaginez bien que tout un article de blog n'a rien à faire 
            dans un fichier python.
            Comment faire un document html séparé ?
            
            <pre class="developpement" symbol="views.py"><code class="py">
            from django<mark>.shortcuts</mark> import render
            
            def montrer_cv(request):
                return render(request, 'le_cv.html')
            </code></pre>
            
            <pre class="developpement" symbol="le_cv.html"><code class="html">
            Cv de &lt;strong>René&lt;/strong>
            &lt;ul>
                &lt;li>Surfeur&lt;/li>
                &lt;li>Programmeur&lt;/li>
                &lt;li>Mais humain avant tout&lt;/li>
            &lt;/ul>
            </code></pre>
            
            <p>Attention à ce que le fichier html soit dans le dossier <code>templates/</code> et veillez à ce que
            <code>INSTALLED_APP</code> dans <code>settings.py</code> contient bien <code class="py">'askme.apps.AskmeConfig'</code> :
            
            <pre class="developpement closable" symbol="settings.py"><code>
            ...
            
            INSTALLED_APP = [
                <mark>'askme.apps.AskmeConfig'</mark>,
                ...
            ]
            
            ...
            </code></pre>
            
            <p>Remarquez, qu'en html, on peut passer à la ligne autant que l'on veut et rajouter des espaces pour rendre le document plus clair.
            Si l'on veut passer à la ligne dans le document, on crée simplement un nouveau paragraphe avec <code class="html">&lt;p></code> fermé par <code class="html">&lt;/p></code>.
            
            <p>L'outil qui a fait du web une révolution, c'est le <strong>lien</strong>, faites un petit lien vers notre autre page à l'url <code class="url">/hello</code> !
            
            <pre class="developpement" symbol="le_cv.html"><code class="html">
            Allez voir &lt;a href="/hello">ici&lt;/a> ma super page 
            et j'espère que je vous ferai sourire !
            </code></pre>
            
            <h4 id="html-est-joli">Possibilités d'html</h4>
            
            <p>Afin que notre page soit plus jolie, on peut apprendre d'autres balises html, si vous 
                voulez garder un site peu joli mais passer directement au côté fontionnel <a href="#template-et-variables">passez cette section</a>,
                sinon voici un aperçu de ce qu'un 
                <a href="https://openclassrooms.com/courses/apprenez-a-creer-votre-site-web-avec-html5-et-css3/">
                    bon tutoriel html</a>
                    
                dans son 
                <a href="https://openclassrooms.com/courses/apprenez-a-creer-votre-site-web-avec-html5-et-css3/comment-fait-on-pour-creer-des-sites-web">
                    premier chapitre</a>
                    
                vous dira :
            
            <p>Il est plus structuré de mettre le tout dans une balise <code class="html">&lt;html></code>
                    qui contient une balise <code class="html">&lt;head></code> et <code class="html">&lt;body></code>,
                    de mettre des paragraphes <code class="html">&lt;p></code>
                    de telle sorte que le document soit maintenant :
            
            <pre class="developpement" symbol="le_cv.html"><code class="html">
            &lt;!DOCTYPE html>
            &lt;html>
                &lt;head>
                    &lt;meta charset="utf-8"/> &lt;!-- pour pouvoir entrer des accents et autres caractères sans erreurs -->
                    &lt;title>René le magnifique&lt;/title>
                &lt;/head>
                &lt;body>
                    &lt;p>Cv de &lt;strong>René&lt;/strong>&lt;/p>
                    &lt;p>Voici mes hobbys :&lt;/p>
                    &lt;ul>
                        &lt;li>Surfeur&lt;/li>
                        &lt;li>Programmeur&lt;/li>
                        &lt;li>Mais humain avant tout&lt;/li>
                    &lt;/ul>
                    &lt;p>&amp;copy; René&lt;/p> &lt;!-- n'importe quel caractère <a href="https://robertvandeneynde.be/blog/unicode/">unicode</a> ! -->
                &lt;/body>
            &lt;/html>
            </code></pre>
            
            <p>Où est passé le texte <em>René le magnifique</em> dans mon exemple ? Regardez bien partout !
            
            <p>Et comment faire une présentation avec des titres de niveau 1 et 2 ? Et des paragraphes ?
            
            <pre class="developpement" symbol="le_cv.html"><code class="html">
            &lt;html>
                &lt;head>
                    &lt;meta charset="utf-8"/> &lt;!-- pour éviter les erreurs d'accent -->
                    &lt;title>René le magnifique&lt;/title>
                &lt;/head>
                &lt;body>
                    &lt;h1>Cv de René&lt;/h1>
                    &lt;p>René est un expert depuis le début de sa vie.&lt;/p>
                    
                    &lt;!-- on peut passer à la ligne et mettre des commentaires -->
                    &lt;p>
                        Il a rencontré Chuck Norris
                        et a compté jusqu'à l'infini avec lui,
                        deux fois.
                    &lt;/p>
                    
                    &lt;h2>Compétences incroyables&lt;/h2>
                    &lt;ul>
                        &lt;li>Surfeur&lt;/li>
                        &lt;li>Programmeur&lt;/li>
                        &lt;li>Mais humain avant tout&lt;/li>
                    &lt;/ul>
                    
                    &lt;h2>Parcours international&lt;/h2>
                    &lt;p> René connaît le Cyrillique et aime beaucoup les 
                        lettres &lt;strong>и&lt;/strong> et &lt;strong>&amp;#x044E;&lt;/strong> &lt;/p> &lt;!-- U+044E ю CYRILLIC SMALL LETTER YU -->
                    &lt;p>Il adore également parler des angles avec des &amp;theta; et des φ&lt; en faisant 2&amp;times;90° = 180°/p>
                    &lt;!-- n'importe quel caractère <a href="https://robertvandeneynde.be/blog/unicode/">unicode</a> ! -->
                    
                    &lt;p>&amp;copy; René&lt;/p>
                &lt;/body>
            &lt;/html>
            </code></pre>
            
            <p class="comment">Toute cette structure peut être retrouvée en ouvrant les <em>outils de développement</em>,
                faites un clic droit puis <em>Inspecter</em> ou sous Google Chrome et Firefox <kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>I</kbd>.
                Vous pouvez ensuite balader votre souris pour voir les correspondances entre le html et les blocs.
            
            <div class="developpement little-box closable" contains-code="html" symbol="Omission de fermeture de balise...">
                <p>Certaines balises html comme <code>&lt;li></code> ou <code>&lt;p></code>
                    <a href="{{https://developer.mozilla.org/fr/docs/Web/HTML/Element/li|https://developer.mozilla.org/en-US/docs/Web/HTML/Element/li}}">ont le droit</a>
                    d'omettre leur tab de fin dans certaines situations très courantes.
                
                    On lira dans
                    <a href="{{https://developer.mozilla.org/fr/docs/Web/HTML/Element/li|https://developer.mozilla.org/en-US/docs/Web/HTML/Element/li}}">la référence</a>
                    de <code>&lt;li></code> :
                
                <p><em>
                    {{ La balise de fin peut être absente si l'élément est immédiatement suivi par un autre élément <code>&lt;li></code> ou s'il n'y a plus d'autre contenu dans son élément parent.
                    | The end tag can be omitted if the list item is immediately followed by another <code>&lt;li></code> element, or if there is no more content in its parent element. }}
                </em>
                
                <p>En d'autres mots,
                    si vous avez un <code>&lt;/li></code> directement suivi d'un <code>&lt;li></code> ou de la fermeture de liste comme <code>&lt;/ul></code>,
                    vous pouvez omettre le <code>&lt;/li></code>.
                
                <p>Ce qui fait que cette liste est du html tout à fait valide :
                
                <pre class="" symbol="le_cv.html"><code class="html">
                &lt;ul>
                    &lt;li>Surfeur
                    &lt;li>Programmeur
                    &lt;li>Mais humain avant tout
                &lt;/ul>
                </code></pre>
                
                <p>Ce qui ressemble vachement au résultat !
                
                <ul>
                    <li>Surfeur
                    <li>Programmeur
                    <li>Mais humain avant tout
                </ul>
                    
                <p>Pour <code>&lt;p></code>,
                    c'est <a href="{{https://developer.mozilla.org/fr/docs/Web/HTML/Element/p|https://developer.mozilla.org/en-US/docs/Web/HTML/Element/p}}">en gros la même chose</a>,
                    si vous avez un <code>&lt;/p></code> directement suivi d'un <code>&lt;p></code>,
                    vous pouvez omettre le <code>&lt;/p></code>, rendant ce code valide :
                    
                <pre class="" symbol="le_cv.html"><code class="html">
                &lt;h1>Cv de René&lt;/h1>
                
                &lt;p>René est un expert depuis le début de sa vie.
                
                &lt;p>Il a rencontré Chuck Norris
                   et a compté jusqu'à l'infini avec lui,
                   deux fois.
                
                &lt;p>Il a beaucoup de hobbies.
                </code></pre>
                    
                
                <p>Cependant, on recommande aux débutants de toujours fermer ses balises car ils trouvent ça généralement plus clair.
                
                <p>Quant aux balises ne devant pas être fermées comme <code>&lt;meta charset="utf-8"></code> ou <code>&lt;img src="hello.png"></code>,
                    on aime marquer un slash comme ceci <code>&lt;meta charset="utf-8"<mark> /</mark>></code>
                    ou <code>&lt;img src="hello.png"<mark> /</mark>></code>
                    pour rappeler aux lecteurs qu'il n'y aura pas de balise de fermeture,
                    ainsi si vous voyez une balise qui finit par <code>/></code>, vous savez qu'il n'y aura pas de balise fermante plus loin.
            </div>
            
            
            <p>Finalement, on aimerait que tous les <strong>paragraphes</strong> soient en <span style="color:blue">bleu</span>, on a besoin de CSS !
            
            <pre class="developpement" symbol="le_cv.html"><code class="html">
            &lt;html>
                &lt;head>
                    &lt;meta charset="utf-8"/>
                    &lt;title>René le magnifique&lt;/title>
                    &lt;style>
                    p {
                        color: blue;
                    }
                    &lt;/style>
                &lt;/head>
                &lt;body>
                    ...
                &lt;/body>
            &lt;/html>
            </code></pre>
            
            <p>Remarquez que vous pouvez nommer votre fichier html comme vous le voulez, même si c'est le même nom que les fonctions ou les urls.
            
            <p>Pour en savoir plus sur l'html et le css, direction le très bon
                <a href="https://openclassrooms.com/courses/apprenez-a-creer-votre-site-web-avec-html5-et-css3/comment-fait-on-pour-creer-des-sites-web">
                    tutoriel html et css
                </a>
                sur openclassrooms.
            
                En une ou deux heures vous aurez déjà de quoi faire un <strong>joli</strong> site web !
                En effet, avec beaucoup de css, René pourrait arriver à un cv comme <a href="https://robertvandeneynde.be/cv">celui-ci</a>.
            
            <nav class="external">
                <a href="https://openclassrooms.com/courses/apprenez-a-creer-votre-site-web-avec-html5-et-css3/">
                    Tutoriel html et css sur OpenClassrooms
                </a>
                
                <ol>
                    <li> <a href="https://openclassrooms.com/en/courses/1603881-apprenez-a-creer-votre-site-web-avec-html5-et-css3/1604192-comment-fait-on-pour-creer-des-sites-web">
                        Les bases de HTML5 </a>

                    <li> <a href="https://openclassrooms.com/en/courses/1603881-apprenez-a-creer-votre-site-web-avec-html5-et-css3/1605060-mettre-en-place-le-css">
                        Les joies de la mise en forme avec CSS </a>

                    <li> <a href="https://openclassrooms.com/en/courses/1603881-apprenez-a-creer-votre-site-web-avec-html5-et-css3/1605881-structurer-sa-page">
                        Mise en page du site </a>

                    <li> <a href="https://openclassrooms.com/en/courses/1603881-apprenez-a-creer-votre-site-web-avec-html5-et-css3/1606851-les-tableaux">
                        Fonctionnalités évoluées </a>

                    <li> <a href="https://openclassrooms.com/en/courses/1603881-apprenez-a-creer-votre-site-web-avec-html5-et-css3/1607901-envoyez-votre-site-sur-le-web">
                        Annexes </a>
                </ol>
            </nav>

            <p>D'autres tutoriels existent bien entendu, comme <a href="https://developer.mozilla.org/fr/Apprendre/Commencer_avec_le_web/Les_bases_HTML">celui de Mozilla</a>
            disponible en plein de langues.
            
            <p>Remarquez que si sur pythonanywhere
                vous utilisez les images,
                il faudra les uploader et ensuite configurer vos urls statiques, google est votre ami.
            
            <p class="comment">Petite remarque si vous <strong>googlez</strong> du html ou css,
                n'allez <strong style="color:red">pas</strong>
                sur le site <strong style="color:red">w3schools.com</strong>,
                la qualité y est <a href="#w3fools">médiocre</a>, il n'apparaît en premier dans la liste de Google que
                parce qu'il est très vieux et trop concis.
            
            <p class="comment">Préférez un autre résultat dans la liste, même si c'est le deuxième,
                ce sera probablement 
                <a href="https://developer.mozilla.org">le MDN</a>
                ou bien entendu
                <a href="https://stackoverflow.com">stackoverflow</a>.
                
                Je dis également en passant que <a href="https://duckduckgo.com">DuckDuckGo</a> 
                est en général meilleur que Google pour rapidement trouver une 
                réponse sur stackoverflow, et en plus il respecte votre vie privée.
                
            <p id="w3fools" class="developpement comment" symbol="Pourquoi w3schools est médiocre">
                Trop concis fait qu'en général oui, on a l'information qu'on cherche
                mais rien d'autre n'est expliqué, ce qui fait qu'on n'apprend quasi rien et vous reviendrez vite sur google avec une autre question.
                
                Mais surtout, le <strong>gros</strong>
                problème avec w3schools est que l'on pourrait croire que c'est un site officiel
                lié à <a href="https://w3.org">w3.org</a>
                qui est l'organisme qui régit les standards du web (plus officiel que ça, tu meurs)
                alors que non.
                
                En 2011, <a href="http://www.w3fools.com/">un site</a> a été écrit analysant la médiocrité de w3schools,
                qui du coup, s'est légèrement amélioré mais reste bien médiocre.
            
            <p>Avoir un joli site c'est bien, mais avoir un site <strong>fonctionnel</strong> c'est peut-être bien aussi !
                Rendez-vous dans la suite du tutoriel.
                
            <p class="comment">
                Un avantage des templates est de séparer le fond, la forme, et les données.
                Un designer pourra par exemple écrire un template html avec du joli css, et vous n'aurez qu'à l'inclure dans votre projet
                sans même devoir regarder le code source.
            
            <h3 id="template-et-variables">Un template django peut avoir des variables</h3>
            
            <p>Cependant, un template est plus qu'un simple fichier, il peut demander des <strong>variables</strong> !
            
            <pre class="developpement" symbol="le_cv.html"><code>
            &lt;p>Cv de &lt;strong>René&lt;/strong>&lt;/p>
            &lt;p>J'ai mangé <mark>&#123;&#123; x }}</mark> pommes dans ma vie&lt;/p>
            &lt;ul>
                &lt;li>Surfeur&lt;/li>
                &lt;li>Programmeur&lt;/li>
                &lt;li>Mais humain avant tout&lt;/li>
            &lt;/ul>
            </code></pre>
            
            <p>Quand on écrit le template, il nous manque une information, le créateur du template a simplement dit <em>J'ai mangé <strong>X</strong> pommes</em> où <strong>X</strong> est une variable.
                Pour indiquer qu'on a une variable dans le template et pas du simple texte, on l'entoure de double accolades,
                donc ici <code>&#123;&#123; x }}</code>.
            
            <p>Ensuite, il faudra bien entendu donner sa variable <code>x</code> au template :
            
            <pre class="developpement" symbol="views.py"><code class="py">
            from django.shortcuts import render
            
            def montrer_cv(request):
                return render(request, 'le_cv.html', {
                    <mark>"x": 52,</mark>
                })
            </code></pre>
            
            <p>La page affichée indiquera <em>J'ai mangé 52 pommes dans ma vie</em>,
                n'hésitez pas <strong>voir le code source</strong> de la page avec <kbd>Ctrl</kbd>+<kbd>U</kbd>
                pour voir que le browser n'est pas au courant qu'on utilise des templates.
            
            <p class="comment">Attentions aux majuscules, comme en python <code>'x' ≠ 'X'</code> !
            
            <p>Évidemment, on peut créer une <strong>variable python</strong>
            et puis l'envoyer au template :
            
            <pre class="developpement" symbol="views.py"><code class="py">
            def montrer_cv(request):
                <mark>a = 52</mark>
                return render(request, 'le_cv.html', {
                    "x": <mark>a</mark>,
                })
            </code></pre>
            
            <p>Python étant python, on peut bien sûr faire des calculs dessus :
            
            <pre class="developpement" symbol="views.py"><code class="py">
            def montrer_cv(request):
                a = 52
                b = 1 + a * 2
                return render(request, 'le_cv.html', {
                    "x": b,
                })
            </code></pre>
            
            <p>Le template peut même accepter du texte :
            
            <pre class="developpement" symbol="views.py"><code class="py">
            def montrer_cv(request):
                return render(request, 'le_cv.html', {
                    "x": "vraiment beaucoup de",
                })
            </code></pre>
            
            <p>Ou plusieurs variables :
            
            <pre class="developpement" symbol="views.py"><code class="py">
            def montrer_cv(request):
                a = 8
                b = 2
                return render(request, 'le_cv.html', {
                    "x": "vraiment beaucoup de",
                    "y": b,
                    "wow": a ** 2,
                })
            </code></pre>
            
            <pre class="developpement" symbol="le_cv.html"><code class="html">
            &lt;p>Cv de &lt;strong>René&lt;/strong>&lt;/p>
            &lt;p>J'ai mangé <mark>&#123;&#123; x }}</mark> pommes dans ma vie&lt;/p>
            &lt;ul>
                &lt;li>Surfeur, gagnant de <mark>&#123;&#123; y }}</mark> compétitions&lt;/li>
                &lt;li>Programmeur, avec un grand total de <mark>&#123;&#123; wow }}</mark> likes sur stackoverflow&lt;/li>
                &lt;li>Mais humain avant tout&lt;/li>
            &lt;/ul>
            </code></pre>
            
            <p>Le template peut accepter plein d'autre type de variables, mais nous verrons son
                utilité principale dans le chapitre suivant !
            
            <p class="comment">Pour en savoir plus sur les templates, je conseille surtout l'<strong>héritage</strong> avec <code>{% extends %}</code>
                qui est une très bonne façon d'organiser ses templates. Plus d'informations sur la <a>documentation officielle</a>.
            
            <h3 id="{{raccourcis|shortcuts}}">Raccourcis clavier</h3>

            <blockquote id="no-mouse">{{Sérieusement, qui a besoin d'une souris quand il édite du texte ?|Seriously, who needs a mouse when editing text?}} &mdash; <a href="https://robertvandeneynde.be/blog/quotes/index.{{fr|en}}.html#no-mouse">Robert Vanden Eynde</a></blockquote>
            <blockquote id="no-pad">{{La souris, c'est lent... Mais le pad ? C'est pire !|The mouse, that's slow... But trackpad? That's wooorse!}} &mdash; <a href="https://robertvandeneynde.be/blog/quotes/index.{{fr|en}}.html#no-pad">Robert Vanden Eynde</a></blockquote>
            
            <p>À partir du moment où vous écrivez beaucoup de texte, lisez au moins mon petit tableau des <a href="{{raccourcis|shortcuts}}.html">raccourcis basiques</a> qui marchent <strong>même sur facebook</strong> et
            <strong>même sous Mac</strong> !
            
            <nav class="external">
                <a href="{{raccourcis|shortcuts}}.html">{{ Raccourcis clavier essentiels | Essential keyboard shortcuts }}</a>
                <a class="flag" href="{{raccourcis|shortcuts}}.html"><img src="flag-{{fr|en}}.png" /></a>
                <a class="flag" href="{{shortcuts|raccourcis}}.html"><img src="flag-{{en|fr}}.png" /></a>
                
                <ol>
                    <li> <a href="{{raccourcis|shortcuts}}#{{touches|keys}}">{{Les touches|The keys}}</a>
                    <li> <a href="{{raccourcis|shortcuts}}#{{classiques|classics}}">{{Les classiques|The classics}}</a>
                    <li> <a href="{{raccourcis|shortcuts}}#text-basics">{{Sélectionner, supprimer et se déplacer|Select, delete and move}}</a>
                    <li> <a href="{{raccourcis|shortcuts}}#line-edit">{{Un code a des lignes|Codes have lines}}</a>
                    <li> <a href="{{raccourcis|shortcuts}}#browser">{{Navigateur internet|Web browser}}</a>
                </ol>
                
                <figure>
                    <a href="basics-of-editing-text-on-keyboard.{{fr|en}}.svg">
                        <img style="max-width:100%; width:535px" src="basics-of-editing-text-on-keyboard.{{fr|en}}.svg"/>
                    </a>
                </figure>
            </nav>
            
        </section>
        
        <h2 id="{{bdd|db}}">Lire la base de données via un modèle Django</h2>
        
        <section name="{{bdd|db}}">
            <button class="open-all-developpement">Cliquez ici pour faire apparaître toutes les corrections et annexes !</button>
            
            <p>Nous allons maintenant faire un site web dynamique, 
                le site web statique est un serveur qui fait toujours la même chose :
                
            <ul>
                <li>Attendre une requête http.
                <li>Lire l'url comme <code class="url">/hello</code>.
                <li>Voir s'il existe un fichier appelé <code>hello</code>.
                <li>Si le fichier n'existe pas, renvoyer une 404 Not Found (status = 404).
                <li>Sinon, renvoyer le contenu du fichier (status = 200).
            </ul>
            
            <p>Un site dynamique...
            <ul>
                <li>attendra toujours des requêtes http (car c'est toujours un serveur http),
                <li>lira toujours l'url (car c'est toujours un serveur http),
                <li><strong>mais</strong> à la place de <em>prendre simplement un fichier et le donner</em>,
                <li>il va appeler du <strong>code</strong> (ici du code écrit en <em>python</em>).
                <li>Le code permet de faire strictement tout et n'importe quoi (comme faire un calcul).
                <li>Et finalement, étant un serveur http, il renverra quand même une réponse texte (ou html) avec un status (200 ou 404 par exemple).
            </ul>
            
            <p>On dira donc que la différence est que la réponse sera <strong>générée</strong>.
            
            <p>Généralement, on lira du contenu dans une <strong>base de donnée</strong> et on renverra du html qui <strong>dépend</strong> du contenu de celle-ci.
            
            <h3 id="exerci{{c|s}}e-4">Exerci{{c|s}}e 4{{ |}}: Une question</h3>
            
            <p>Pour notre site de sondage, créez une <code class="py">class Question</code> qui a deux <em>attributs</em> :
            
            <ul>
                <li><code>nom</code>: le nom de la question, comme <em>Quel est votre fruit préféré ?</em>
                <li><code>repondants</code>: le nombre de personnes ayant répondu à cette question, qui sera initialement de zéro mais augmentera.
            </ul>
            
            <div class="developpement little-box closable" symbol="pour le projet marketplace">
            
            <p>Pour le projet économique type <em>marketplace</em>, vous pouvez vous entraîner en créant une classe <code>Question</code> comme décris dans le tutoriel,
                ou bien vous pouvez créer une classe <code>Listing</code> (ou <code>Offre</code>) qui contient les attributs demandés en cours, c'est à dire
                <code>montant_fixe</code> (un nombre),
                <code>montant_variable</code> (un nombre),
                <code>devise_fixe</code> (une Devise, comme <code>EUR</code>)
                et <code>devise_variable</code> (une autre Devise, comme <code>BTC</code>).
                
                En effet, une <code>Offre</code> se décrit en français comme <em>je propose un échange <strong>5</strong> <strong>BTC</strong> contre <strong>10</strong> <strong>EUR</strong></em>.
                Dans cet exemple on a <code class="py">montant_fixe = 5; montant_variable = 10; devise_fixe = "BTC"; devise_variable = "EUR"</code>.
            
            <p>
                Une Offre est également liée à un objet <strong>User</strong> (utilisateur) mais pour l'instant nous ne le mettrons pas,
                nous ferons ça dans la partie <a href="#bddr">Bases de données <em>relationnelles</em></a>.
                
            <p>
                Avec les <a href="#bddr">bases de données relationnelles</a>, les devises seront également des objets <strong>Devise</strong> mais pour l'instant nous pouvons simplement dire que les devises
                sont des chaînes de caractères comme <code class="py">"EUR"</code> (<em>string</em> ou <code>str</code> en python, <code>CharField</code> en django).
            
            </div>
            
            <p>On devra donc modifier le fichier <code>models.py</code> :</p>
                
            <pre class="developpement" symbol="models.py"><code class="py normal-comments">
            from django.db import models # on a besoin du concept django de <em>modèle</em>
            
            class Question(models.Model): # cette classe est un modèle django et non une simple classe Python
                nom = models.CharField(max_length=50) # cet attribut est du texte (<em>Character Field</em>)
                repondants = models.IntegerField() # cet attribut est un nombre entier
            </code></pre>
            
            <p>Ensuite, effectuez l'opération de <code>makemigrations</code> suivi de l'opération de <code>migrate</code>,
                et probablement qu'il y aura une erreur (voir <a href="#migrations_erreurs">ci-dessous</a>).
                
            <p class="comment">
                Si vous vous demandez quelle est la différence entre <code>makemigrations</code> et <code>migrate</code>, lisez ceci :
            
            <div id="makemigrations_vs_migrate"></div>
            <ul class="developpement" symbol="makemigrations vs migrate" >
                <li><code>makemigrations</code> va regarder les changements faits dans models.py et va créer un fichier python dans le dossier migrations, qui <em>décrit</em> les différences, en l'occurence ici, on crée une nouvelle table qui contient deux attributs.
                <li><code>migrate</code> modifie effectivement la base de données, en l'occurence ici va créer une nouvelle table, on verra plus tard ce qu'il peut arriver à ce moment-ci.
            </ul>
            
            <!--
            <p class="comment">Si vous utilisez une machine virtuelle avec Eclipse, faites clic droit dans Eclipse puis choissiez migrate ou makemigrations ou passez par le terminal
                en écrivant <code class="bash">python3 manage.py makemigrations</code>
                ou <code class="bash">python3 manage.py migrate</code>.
            -->
            
            <p class="comment">Sur pythonanywhere, vous devrez passer par la console, <a href="#virtualenv">activez le virtualenv</a> si ça n'est pas déjà fait,
                puis lancez cette commande :
                
            <pre><code class="bash">python manage.py makemigrations</code></pre>
            
            <p>De la même manière, pour faire l'opération de <em>migrate</em> on écrira bien sûr <code class="bash">python manage.py migrate</code>.
            
            
            <div id="migrations_erreurs"></div>
            <p>Voici toutes les erreurs qui peuvent arriver :
            
            <ul>
            
            
            <li>
            
            <p>Si vous avez l'erreur <code>can't open file 'manage.py': No such file or directory</code>, c'est que vous n'êtes pas dans le bon <strong>dossier</strong> et probablement qu'un petit <code>cd project</code>
            résoudra le problème :
            
            <div class="developpement little-box closable" contains-code="bash" symbol="cd : changer de dossier en bash">
                <p class="comment">
                    Sur pythonanywhere, on va utiliser des <strong>consoles linux</strong> (aussi appelés <strong>terminal</strong>, <strong>shell</strong> ou <strong>sh</strong> ou <strong>bash</strong> ou <strong>invite de commande</strong>),
                    car ça permet non seulement d'avoir l'air d'un pro mais surtout car ça permet de nous simplifier la vie une fois qu'on y est habitué.
                
                <p class="comment">
                    Le compte gratuit de pythonanywhere que vous avez permet d'ouvrir uniquement 2 consoles, dans l'onglet <em>Console</em> du site, vous voyez la liste des consoles ouvertes,
                    vous pouvez cliquer dessus pour y accéder, cliquez sur la petite croix pour fermer (<em>kill</em>) la console que vous voulez.
                
                <p>Quand vous lancez une console, vous êtes dans votre dossier <strong>home</strong>,
                    c'est le dossier principal de tout utilisateur linux,
                    quand vous allez dans l'onglet Files, c'est le dossier que vous voyez,
                    en console linux, on l'appelle tout simple <em>home</em>, <code>$HOME</code> ou encore <code>~</code>.
                
                <p>Chaque utilisateur linux a son petit dossier home, qui se trouve dans <code class="contains-group bash">/home/username</code>, sur pythonanywhere votre nom d'utilisateur est <code class="contains-group bash">infosgr42</code> donc votre home se
                trouve dans <code>/home/</code>.
                
                <p>En lançant une console linux, on nous voyons l'heure et un petit symbole <code>$</code> :
                
                <pre><code class="bash contains-group">
                14:00 ~ $
                </code></pre>
                
                <p>Pour savoir où vous êtes, tappez <code>pwd</code> (<strong>P</strong>rint <strong>W</strong>orking <strong>D</strong>irectory)
                
                <pre><code class="bash contains-group">
                14:01 ~ $ pwd
                /home/infosgr42/
                </code></pre>
                
                <p>Pour voir les fichiers qu'il y a dans votre dossier en cours, tappez <code>ls</code> (<strong>l</strong>i<strong>s</strong>ter les fichiers, ou <strong>l</strong>ets <strong>s</strong>ee) :
                
                <pre><code>
                14:02 ~ $ ls
                README.txt  project  wsgi.py  
                </code></pre>
                
                <p>Nous avons donc un fichier <code>README.txt</code>, un dossier <code>project</code>, et un fichier <code>wsgi.py</code>, ce qui correspond bien à 
                la réalité :
                
                <figure class="half-size">
                    <img src="screenshot_pythonanywhere_all_files.png" />
                </figure>
                
                <p class="comment">Remarquez qu'en linux, un fichier qui commence par un <strong>point</strong> est considéré comme <strong>caché</strong>,
                    c'est pourquoi <code>ls</code> ne les montre pas,
                    mais vous pouvez quand même les voir en effectuant <code>ls -a</code>.
                
                <p class="comment">
                    Pour avoir un affichage plus joli en couleurs, tappez <code>ls x--color</code>, vous y verrez les <strong>dossiers</strong> en bleu.
                    Il y a moyen que tous vos <code>ls</code> soient en couleurs en écrivant <code>alias ls='ls --color'</code>.
                
                <p>Pour changer de dossier, en allant par exemple dans le dossier <code>project/</code> tappez <code>cd project</code> (<code>cd</code> comme <strong>c</strong>hanger <strong>d</strong>ossier).
                
                <pre><code>
                14:03 ~ $ cd project
                14:04 ~/project $ 
                </code></pre>
                
                <p>Remarquez que la console vous rappelle que vous êtes dans le dossier <code>~/project</code>, ce qui veut dire le dossier <code>project</code> dans votre <code>home</code>.
                
                <p>Pour aller dans votre home, tappez juste <code>cd</code> :
                
                <pre><code>
                14:05 ~/project $ cd
                14:06 ~ $ 
                </code></pre>
                
                <p>Pour les intéressés, je conseille le <a href="https://openclassrooms.com/courses/reprenez-le-controle-a-l-aide-de-linux/la-console-ca-se-mange">tutoriel linux</a> sur openclassrooms.
            </div>
            
            </li>
            <li>
            
            <p>Si vous avez une erreur liée à la version de python ou version de django, comme par exemple à la ligne <code class="py">from exc</code>, il y a un souci de virtualenv :
            
            <div id="virtualenv"></div>
            <div class="developpement little-box closable" contains-code="bash" symbol="virtualenv">
                <p>Beaucoup d'installations python utilisent le concept de <code>virtualenv</code> qui permet de gérer des versions de python, sur python anywhere par défaut,
                on a python <strong>2.7</strong> ou python <strong>3.6</strong> muni de django <strong>1.11</strong>, or on veut <strong>django 2.0</strong>,
                on va donc créer un <em>virtualenv</em> avec python 3.6 et django 2.0, nous allons l'appeler <code>django2</code>.
                
                <p class="comment">Sur pythonanywhere, on va utiliser une <strong>console linux</strong> (aussi appelée <strong>terminal</strong>, <strong>shell</strong>, <strong>sh</strong> , <strong>bash</strong> ou <strong>invite de commande</strong>),
                car ça permet non seulement d'avoir l'air d'un pro mais surtout car ça permet de nous simplifier la vie une fois qu'on y est habitué.
                Le compte gratuit que vous avez permet d'ouvrir uniquement 2 consoles, dans l'onglet <em>Console</em> du site, vous voyez la liste des consoles ouvertes,
                vous pouvez cliquer dessus pour y accéder, cliquez sur la petite croix pour fermer (<em>kill</em>) la console que vous voulez.
                
                <p class="comment">Pour lancer une console, allez dans l'onglet Web, descendez un peu, et cliquez sur <em>lancer une console dans ce virtualenv</em>,
                    ou bien réutilisez une console déjà lancée via la liste dans l'onglet <em>Console</em>.
                
                <p>Dans votre console, pour savoir si vous êtes dans le virtualenv, lancez la commande suivante :
                
                <pre><code>which python</code></pre>
                
                <p>Si vous voyez <code>/usr/bin/python</code> c'est que vous n'êtes <strong>pas</strong> dans le virtualenv.
                    Si vous voyez quelque chose qui contient <code>.virtualenv</code> vous êtes dedans.
                    
                <p>Pour activer un virtualenv sur pythonanywhere, il faut d'abord le créer, lancez cette commande :
                
                <pre><code>
                    mkvirtualenv django2 --python=/usr/bin/python3.6
                </code></pre>
                
                <p>Cela va créer votre virtualenv, ensuite il faut l'activer :
                
                <pre><code class="bash">
                    workon django2
                </code></pre>
                
                <p>Par la suite, si vous voyez que vous n'êtes pas dans le virtualenv (car <code>which python</code> vaut <code>/usr/bin/python</code>),
                    vous pouvez juste l'activer avec <code>workon django2</code>.
                
                <p>Une fois dans le virtualenv, la commande <code>python</code> pourra être utilisée correctement
                    vérifiez que vous avez bien python 3.6 en tappant <code>python --version</code> et vérifiez que vous avez bien django version 2 en tappant <code>python -m django --version</code>.
                    Il existe aussi d'autres comandes utiles comme <code>pip</code> ou <code>django-admin</code> que nous n'utiliserons pas pour notre tutoriel.
                
                <h4>Indice de virtualenv</h4>
                
                <p>Dans votre console, si le texte affiché est comme une de ces trois lignes-ci :
                
                <pre><code class="bash">
                    12:00 ~ $
                    12:00 ~/dossier $
                    user@host ~/dossier $
                </code></pre>
                
                <p>... c'est que vous n'êtes <strong>pas</strong> dans le virtualenv, il faut avoir une ligne comme celles-ci :
                
                <pre><code class="bash">
                    (django2) 12:00 ~ $
                    (django2) 12:00 ~/dossier $
                    (django2) user@host ~/dossier $
                </code></pre>
                
                <p>Si la ligne commence par un nom entre parenthèses, c'est que vous êtes <strong>probablement</strong> dans le bon virtualenv, seul <code class=bash>which python</code> pourra vous le dire pour sûr.
                
                <p>Dans les exemples ici j'étais dans le virtualenv appelé <code>django2</code>.
            </div>
            
            </li>
            <li>
                
            <p>Erreurs de python : Probablement que vous avez fait une erreur de Syntaxe ou une autre erreur <strong>python</strong>,
                dans ce cas, lisez bien le <strong>fichier</strong> et le <strong>numéro de ligne</strong>, par exemple,
                essayez de faire une faute de frappe et d'écrire <code>CarField</code> à la place de <code>CharField</code> et l'opération vous dira
                <em>il y a une erreur dans le fichier <code>models.py</code> à la ligne <code>5</code></em> par exemple.
                
            </li>
            <li>
            <p>Si sur pythonanywhere vous avez une opération <em>Access denied</em>, vérifiez ces deux choses :
        
            <div id="access_denied_mysql_pythonanywhere"></div>
            <div class="developpement" symbol="Access denied avec mysql">
            
            <ol>
            <li>
            <p>Dans le fichier <code>settings.py</code> (<code>~/project/mysite/settings.py</code>), vérifiez près de la ligne <code class="py">DATABASES =</code> : </li>
            
            <pre><code class="py">
            DATABASES = {
                'default': {
                    'ENGINE': 'django.db.backends.mysql',
                    'NAME': '<span class="contains-group hljs-string">infosgr42$default</span>',
                    'USER': '<span class="contains-group hljs-string">infosgr42</span>',
                    'PASSWORD': 'supersecret',
                    'HOST': '<span class="contains-group hljs-string">infosgr42.mysql.pythonanywhere-services.com</span>',
                }
            }
            </code></pre>
            
            <p>Vous remplacerez bien sûr votre numéro de groupe dans <code>infosgr42</code>.
            
            </li>
            <li>
                Dans l'onglet <em>Databases</em> de pythonanywhere, mettez le même mot de passe (comme <code>supersecret</code>),
                n'hésitez pas à le mettre deux fois pour être sûr qu'il est bien mis.</li>
            </ol>
            
            </div>
            
            <li>
            
            <p>Si ce n'est pas votre première migration, que la console vous pose des questions et que vous n'arrivez pas à y répondre, vous pouvez
                <strong>supprimer les migrations</strong> existantes, puis <strong>supprimer la base de donnée</strong> et en créer
                une nouvelle, <strong style="color:red">attention, toutes les tables seront supprimées</strong> (mais pas vos fichiers <code>.py</code>).
                
            <div class="developpement little-box closable" symbol="supprimer la base de donnée">
            <ol>
                <li>
                
                <p>Si l'on vous pose des questions lors de makemigrations et que vous n'arrivez vraiment pas à répondre,
                vous pouvez <strong>supprimer les migrations</strong> et allant dans le dossier <code>~/project/funnycoin/migrations/</code> et en supprimant tous les fichiers <code>.py</code> :
                
                <figure class="half-size">
                    <img src="screenshot_pythonanywhere_files_migrations.png" />
                </figure>
                
                <p>Dans le screenshot, on cliquera sur la petite corbeille à côté du fichier <code>0001_initial.py</code>.
                
                <li>
                
                <p>Ensuite, on va <strong>supprimer la base de donnée</strong> et en créer une nouvelle du même nom,
                    <strong style="color:red">attention, toutes les tables seront supprimées</strong>
                    (mais pas vos fichiers <code>.py</code>).
                
                <figure class="half-size">
                    <img src="screenshot_pythonanywhere_database_list.png" />
                </figure>
                
                <li>Dans l'onglet database, à côté de la base de donnée <code class="contains-group bash">infosgr42$default</code>,
                    cliquez dessus pour y ouvrire une console mysql (si votre limite de console est atteinte,
                    allez dans l'onglet <em>Console</em> et fermez en une), et entrez la <strong>commande de la mort</strong> :
                    
                <pre><code class="contains-group sql">
                drop database infosgr42$default;
                </code></pre>
                
                <p>Avec le point-virgule bien entendu.
                
                Je dis commande de la mort car dans la vraie vie c'est une très mauvaise idée de supprimer toutes les donnée
                de notre site web.
                
                Ensuite vous pouvez tapper <code>exit;</code> pour fermer la console (ou aller dans l'onglet <em>Console</em> et fermer la console mysql).
                
                <li>Recréez la base de données, allez dans l'onglet <em>Databases</em> et là où est marqué
                <em>enter new database name</em>, vous indiquez <code>default</code> et puis cliquez sur <em>Create</em>.
                
                Cela va recréer une base de donnée <code class="contains-group bash">infosgr42$default</code>,
                vérifiez bien que c'est celle-là <a href="#access_denied_mysql_pythonanywhere">que vous avez indiqué</a> dans <code>settings.py</code>
                
                <li>Toutes vos tables sont supprimées, donc vous pouvez faire <code>makemigrations</code> et <code>migrate</code>
                    transquillement.
                    
                    Vu que toutes vos tables sont supprimées, vous devez recréer un superuser pour accéder à l'admin.
            </ol>
            </div>
            
            </li>
            </ul>
            
            
            <p>L'opération <code>makemigrations</code> sans erreurs ressemble à ceci :
            
            <pre class="developpement" symbol="python manage.py makemigrations"><code class="text">
            $ python manage.py makemigrations
            Migrations for 'askme':
            polls/migrations/0001_initial.py:
                - Create model Question
            </code></pre>

            
            <p>L'opération <code>migrate</code> sans erreurs contient une liste de plein de <em>OK</em> comme ceci :
            
            <pre class="developpement" symbol="python manage.py migrate" ><code class="text">
            $ python manage.py migrate
            Operations to perform:
                Apply all migrations: admin, auth, contenttypes, sessions, askme
            Running migrations:
                Applying contenttypes.0001_initial... OK
                Applying auth.0001_initial... OK
                Applying admin.0001_initial... OK
                Applying admin.0002_logentry_remove_auto_add... OK
                Applying contenttypes.0002_remove_content_type_name... OK
                Applying auth.0002_alter_permission_name_max_length... OK
                Applying auth.0003_alter_user_email_max_length... OK
                Applying auth.0004_alter_user_username_opts... OK
                Applying auth.0005_alter_user_last_login_null... OK
                Applying auth.0006_require_contenttypes_0002... OK
                Applying auth.0007_alter_validators_add_error_messages... OK
                Applying auth.0008_alter_user_username_max_length... OK
                Applying auth.0009_alter_user_last_name_max_length... OK
                Applying sessions.0001_initial... OK
                Applying askme.0001_initial... OK
            </code></pre>
            
            <p>Vous avez donc une <strong>base de données</strong> qui s'est créée !
            
            <p>Une manière simple de voir le contenu de cette base de donnée, est d'activer l'admin :
            <!--
            <p class="comment">
                Si vous avez laissez la configuration par défaut, c'est le petit fichier fichier <code class="bash">db.sqlite3</code>.
            
                Vous y verrez le contenu de la base de données ! Remarquez que la création de notre modèle <code>Question</code>
                correspond bien à la table <code>askme_question</code>.
                
                Allez dans la table en question, et <strong>créez y quelques questions</strong>
                    (en cliquant sur <em>Nouvel enregistrement</em>).
                    
            <p class="comment">Comment ouvrir ce fichier sqlite ?
                Clic droit dessus
                > Open With
                > Other Program
                > tappez <em>sqlitebrowser</em>
                > sélectionnez <em>DB Browser for sqlite</em>
                > cochez la case <em>toujours utiliser ce programme</em>
                > OK.
                
            <p>Il est également plus agréable <a href="#django.contrib.admin">d'activer l'admin</a> pour modifer cette base de données, mais ce n'est pas du tout obligatoire.
            -->
            
            <!--
            <p class="comment">Sur pythonanywhere, on peut choisir d'utiliser mysql,
                qui est un moteur plus élaboré de bases de données,
                et donc il n'est donc pas aussi facile de voir le contenu de la base de donnée,
                mais en <a href="#django.contrib.admin">activant l'admin</a>
                vous pourrez voir vos modèles, il y a également moyen de configurer votre projet pour utiliser sqlite
                et le fichier <code class="bash">db.sqlite3</code>
                sera alors téléchargeable puis lisible avec le programme <a href="http://sqlitebrowser.org/">sqlitebrowser</a>.
            -->
            
            <div id="django.contrib.admin"></div>
            <div class="developpement little-box closable" symbol="Activer l'admin de django">
                
                <p>Afin d'activer l'admin de django,
                    créez un superuser avec la commande <code>python manage.py createsuperuser</code>
                    avec par exemple un username comme <code>pikachu</code>,
                    un email comme <code>pikachu@pokemon.com</code>,
                    un mot de passe comme <code>hellohello</code> (oui ça n'écrit pas, ayez confiance).
                    
                <p class="comment">
                    La raison pour laquelle sur linux on n'affiche pas les mots de passe quand on les tappe,
                    c'est parce que on est très parano, en effet, quelqu'un pourrait <strong>compter le nombre de caractères</strong>
                    et aurait donc une information sur notre mot de passe.
                
                <p>Vous pouvez aller sur <code class="url">/admin</code> et vous connecter (avec <code>pikachu</code>).
                    Là dedans, vous pouvez créer des <code>User</code> (comme <code>rondoudou</code> et <code>tortank</code>).
                
                <p>Ensuite pour avoir vos propres modèles,
                    modifier le fichier <code>admin.py</code> et vérifier
                    dans <code>settings.py</code>
                    que vous avez bien <code>'askme.apps.AskmeConfig'</code>
                    dans <code>INSTALLED_APP</code>
                    et que <code class="py">class AskmeConfig</code> est bien dans le fichier <code>apps.py</code>.
                
                <p>Et surtout que le fichier <code>admin.py</code> ressemble à ça pour notre app <code>askme</code> :
                
                <pre symbol="admin.py"><code>
                from django.contrib import admin
                
                from . import models
                
                admin.site.register(models.Question)
                # rajoutez vos autres modèles ici pour les rendre disponibles dans l'admin.
                </code></pre>
                
                <!--
                <p>Vous pourriez aussi tout simplement suivre le <a href="https://docs.djangoproject.com/fr/2.0/intro/tutorial02/#introducing-the-django-admin">tutoriel officiel</a>,
                attention, sur pythonanywhere, vous ne devez pas faire la partie <em>lancer le serveur de développement</em>
                car ça correspond juste à cliquer sur <em>Reload</em> dans l'onglet <em>Web</em>.
                -->
            </div>  
            
            <!--
            <div class="developpement little-box closable" symbol="(Facultatif) Comment configurer le projet pour utiliser sqlite">
                <p>Dans le fichier settings, recherchez la ligne <code>DATABASES = {...}</code>, mettez toutes ces lignes en commentaire 
                en y insérant un hashtag <code>#</code> au début des lignes, puis remplacez ça par :
                
                <pre><code class="py">
                DATABASES = {
                    "default": {
                        'ENGINE': 'django.db.backends.sqlite3',
                        'NAME': os.path.join(BASE_DIR, 'db.sqlite3'),
                    }
                }
                </pre></code>
                
                <p>Vous devrez relancer <code>makemigrations</code> et <code>migrate</code> après.
            </div>
            -->
            
            <h3 id="what-is-a-db">Qu'est-ce qu'une base de donnée ?</h3>
            
            <p>Vous voyez donc qu'une <strong>base de données</strong>, c'est <strong>comme un Excel</strong>,
            plusieurs tableaux de valeurs, que ce soit via l'admin ou sqlite, <strong>créez quelques questions</strong> et vous aurez quelque chose comme ceci :
            
            <table>
                <thead>
                    <tr>
                        <th colspan="100">Table Question</th>
                    </tr>
                </thead>
                
                <tr>
                    <th>nom</th>
                    <th>repondants</th>
                </tr>
                
                <tr>
                    <td>Quel est votre fruit préféré ?</td>
                    <td>32</td>
                </tr>
                <tr>
                    <td>Aimez vous le basket ?</td>
                    <td>25</td>
                </tr>
                <tr>
                    <td>L'impédance d'un condensateur ?</td>
                    <td>100</td>
                </tr>
            </table>
            
            <p>Cependant, vous pouvez également voir que <strong>Django crée un id</strong> pour toutes les tables que l'on crée, la vraie table sera donc plutôt comme ceci :
            
            <div class="developpement little-box closable" symbol="id et primary key">
            <table>
                <thead>
                    <tr>
                        <th colspan="100">Table Question</th>
                    </tr>
                </thead>
                
                <tr>
                    <th>id</th>
                    <th>nom</th>
                    <th>repondants</th>
                </tr>
                
                <tr>
                    <td>1</td>
                    <td>Quel est votre fruit préféré ?</td>
                    <td>32</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>Aimez vous le basket ?</td>
                    <td>25</td>
                </tr>
                <tr>
                    <td>7</td>
                    <td>L'impédance d'un condensateur ?</td>
                    <td>100</td>
                </tr>
            </table>
            
            <p>Un <code>id</code> (identifiant) est un attribut <strong>unique</strong> qui permet d'identifier un objet, un attribut unique ça s'appelle une <strong>key</strong> (clé)
            et l'<code>id</code> est tellement important qu'on dira même que c'est une <strong>primary key</strong> (clé primaire).
            
            Remarquez qu'il est très possible que les id ne se suivent pas, par exemple parce que les questions 3 à 6 ont été supprimées de la base de donnée.
            </div>
            
            <p class="comment">Cependant, une base de donnée présente des avantages par rapport à un Excel, comme pouvoir être lue facilement depuis un code,
            ou vérifier certains tests, nous verrons ça plus tard.
            
            <p>Ce qui m'amène à faire un petit tableau de terminologie de bases de données :
            
            <table>
            <tr> <th>SQL</th>     <th>Django</th>   <th>Excel</th>   <th><a href="https://en.wikipedia.org/wiki/Relation_(database)">Db</a></th> </tr>
            <tr> <td>Table</td>   <td>Modèle</td>   <td>Feuille</td> <td>Relation</td> </tr>
            <tr> <td>Colonne</td> <td>Attribut</td> <td>Colonne</td> <td>Attribut</td> </tr>
            <tr> <td>Ligne</td>   <td>Objet</td>    <td>Ligne</td>   <td>Tuple</td> </tr>
            </table>
            
            <p>Remarquez également que les <em>modèles django</em> sont des
                <a href="https://robertvandeneynde.be/parascolaire/theorie3_fonctions_et_objets.html">classes Python</a>
                donc j'utiliserai souvent le mot <em>classe</em> pour <em>modèle</em> quand c'est sous entendu que c'est bien un modèle et pas une simple classe Python.
            
            <p>En voyant la liste des tables, vous avez vu que django utilise des tables pour son usage interne,
                comme par exemple, une classe <code>User</code> qui gère les password et les login de manière sécurisées, on l'utilisera à la fin de ce tutoriel.
                
            <p class="comment">On préférera donc <a href="#django.contrib.auth.models.User">utiliser cette classe</a> <code>User</code> toute faite de django plutôt que de la recoder sois-même,
                ça nous évitera de se faire hacker et d'apprendre beaucoup de bonnes pratiques de sécurité, comme le <em>hash</em> des passwords, les <em>rainbow table</em> et autres joyeusetés.
            
            <p>Finalement, remarquez que <strong>tout modèle django a un attribut id</strong>,
                et que cet attribut s'appelle également <strong>pk</strong>
                comme <strong>p</strong>rimary <strong>k</strong>ey,
                c'est un nombre qui sera garantit être unique.
            
            <p class="comment">Cette garantie d'être unique est un des exemples
                pour lequel une base de données, c'est plus qu'un Excel.
            
            <p>Nous avions activé l'admin pour rajouter facilement des objets,
                il est également possible de directement modifier le fichier <code>db.sqlite3</code> (si vous êtes)
                ou de faire du <code>sql</code> directement dans mysql (si vous êtes sous mysql),
                donc il n'est pas <em>obligatoire</em> de passer par l'admin, c'est juste très pratique.
            
            <p><code>admin</code> est une application django créée qui ne fait que modifier la base de données, on peut donc s'en passer.
            
            <p class="comment">J'utiliserai le terme <em>db</em> (<em>database</em>) ou <em>bdd</em> (base de données)
                car ce concept est récurrent et <em>base de données</em> c'est long à dire.
            
            <p>Après ce petit discours sur les bases de données, revenons un peu au code !
            
            <h3 id="exerci{{c|s}}e-5">Exerci{{c|s}}e 5{{ |}}: Une page de détail d'une question</h3>
            
            <p>Comme annoncé au début du chapitre, dans un site dynamique,
                on lira du contenu dans une <strong>base de donnée</strong> et on renverra du html qui <strong>dépend</strong> du contenu de celle-ci.
                
            <p>Essayons donc de lire une question et de l'afficher sur notre site :
            
            <ol>
                <li>Pour lire dans une base de données, on utilisera <code>Question.objects.get()</code> pour avoir une question, <code>Question</code> devra être importé, vu qu'il est dans le fichier <code>models.py</code> et pas <code>views.py</code>
                <li>Ensuite, on a reçu l'objet de la base de données, et on le garde près de nous dans une <strong>variable</strong>.
                <li>Finalement on passe la variable au template, qui attend un <strong>paramètre</strong>.
                <li>Le template pourra donc lire l'objet question qu'on lui donne, et écrire du contenu dynamique via <code>&#123;&#123; q.nom }}</code>
                par exemple pour le nom de la question.
            </ol>
            
            <p>Nous allons donc créer une nouvelle page à l'url <code class="url">/detail</code> !
            
            <pre class="developpement" symbol="urls.py (django 2.0)"><code class="py">
            urlpatterns = [
                path('hello', views.dire_bonjour), 
                path('cv', views.montrer_cv),      
                <mark>path('detail', views.donner_une_question),</mark> 
            ]
            </code></pre>
            
            <!--
            <pre class="developpement" symbol="urls.py (django 1.11)"><code class="py">
            urlpatterns = [
                url(r'^hello$', views.dire_bonjour), 
                url(r'^cv$', views.montrer_cv),      
                <mark>url(r'^detail$', views.donner_une_question),</mark>
            ]
            </code></pre>
            -->
            
            <p>Notre template aimerait recevoir un paramètre pour pouvoir écrire le nom de la question
                et le nombre de répondants, écrire des templates étant long et fatigant, il choisit de nommer le paramètre <code>q</code>
                (mais il aurait pu l'appeler autrement).
        
            <pre class="developpement" symbol="templates/detail.html"><code class="html">
            &lt;h1>Détails d'une question&lt;/h1>
            &lt;h2>Titre : &lt;em>&#123;&#123; q.nom }}&lt;/em>&lt;/h2>
            &lt;p>Cette question a accumulé un total de &#123;&#123; q.repondants }} répondants.&lt;/p>
            </code></pre>
            
            <p>Les templates sont des artistes, ils ne se satisfieront pas d'avoir un affichage peu attractif,
            ils mélangeront nos donnnées avec du joli html pour avoir un affichage agréable à regarder.
            
            <p class="comment">Le titre sera en bleu ciel, un point c'est tout &mdash; Un template un peu insistant lors d'un business meeting.
            
            <p>Ce template veut donc une question qu'il appelle <code>q</code>,
            mais nous, le serveur, on va devoir aller demander à la base de donnée cette information,
            nous utiliserons <code>Question.objects.get()</code> comme traduction en code de <em>hello base de donnée, donne-moi <strong>une</strong> question s'il-te-plaît</em>.
            
            <pre class="developpement" symbol="views.py"><code class="py">
            def donner_une_question(request):
                x = Question.objects.get() # x est un objet de type Question (x est une Question)
                ...
            </code></pre>
            
            <p>Nous gardons cette information <em>près de nous</em> dans une <strong>variable</strong>,
            rappelez-vous qu'écrire <code>x = ...</code>
            crée une variable python nommée <code>x</code>, ce choix de nom est bien entendu arbitraire.
            
            <p>Cette variable est un objet de type <code>Question</code>,
                on peut donc écrire <code>x.nom</code> et <code>x.repondants</code> pour lire ses attributs.
            
            <p>Finalement, on doit donc...
            
            <ul>
                <li>donner notre variable <code>a</code>,
                <li>au template <code>detail.html</code>,
                <li>qui l'appellera <code>q</code>.
            </ul>
            
            <pre class="developpement" symbol="views.py"><code class="py">
            def donner_une_question(request):
                x = Question.objects.get() # x est un objet de type Question (x est une Question)
                return render(request, "detail.html", {
                    "q": x,
                })
            </code></pre>
            
            <p>Allez maintenant dans le navigateur, et observez le résultat !
            Il y a un souci (voire deux en fait), mais lequel ?
            
            <div class="developpement little-box closable" symbol="name 'Question' is not defined: import">
                Dans le code, on a écrit <code>Question</code>, mais on est dans le fichier <code>views.py</code> et <code class="py">class Question</code>
                est définie dans le fichier <code>models.py</code>, on doit donc l'<strong>importer</strong> :
                
                <pre><code class="py">
                <mark>from .models import Question</mark> # . veut dire même dossier
                
                def donner_une_question(request):
                    x = Question.objects.get()
                    return render(request, "detail.html", {
                        "q": x,
                    })
                </code></pre>
                
                <p>Si vous aviez un <strong>dossier</strong> <code>views/</code>, vous devrez écrire deux points plutôt :
                
                <pre><code class="py">
                <mark>from ..models import Question</mark> # .. veut dire dossier parent
                </code></pre>
            </div>
            
            <p class="developpement" symbol="MultipleValueReturn">
            On demande à la base de données <strong>une</strong> question mais celle-ci nous répond
            qu'il existe plusieurs questions, et donc ne sait pas laquelle choisir !
            On doit être plus précis dans notre requête.
            </p>
            
            <p>Quand vous avez une erreur, <strong>ne vous précipitez pas dans le code</strong> pour la résoudre,
            lisez la description de l'erreur et descendez pour voir quelle ligne l'a causée.
            
            <p>On voit donc que l'erreur est dûe à la ligne <code class="py">x = Question.objects.get()</code>,
            en effet, on doit être plus précis dans notre <code>.get()</code>.
            Demandons par exemple à avoir la question dont l'id vaut 1.
            
            <pre class="developpement" symbol="views.py"><code class="py">
            def donner_une_question(request):
                x = Question.objects.get(<mark>id=1</mark>)
                return render(request, "detail.html", {
                    "q": x,
                })
            </code></pre>
            
            <p>Et là, devant vos yeux ébahis, nous voyons la description de la question numéro 1 et son nombre de répondants.
            Changez le 1 en 2, et vous aurez une autre question, nous avons un site web <strong>dynamique</strong> !
            
            <p>Remarquez que <em>Afficher la source</em> nous montre bien le html <strong>généré</strong>,
                le browser a bien reçu le html <strong>généré</strong>, il n'est pas du tout au courant de notre
                communication entre nous et la base de données et entre nous et le template.
            
            <p>On peut également demander la question dont le nombre de répondants vaut 42.
            
            <pre class="developpement" symbol="views.py"><code class="py">
            def donner_une_question(request):
                x = Question.objects.get(repondants=42)
                return render(request, "detail.html", {
                    "q": x,
                })
            </code></pre>
            
            <p class="comment">
                Que se passe-t-il si aucune question avec 42 répondant n'existe ?
                Et s'il y a en a plus d'une ?
                
            <p>Finalement, remarquez que vu que nous sommes en python, on peut faire ce que l'on veut, comme des <code>if</code>
            ou des <code>while</code>.
            
            <p>Essayez d'écrire cette condition: <strong>si</strong> le nombre de répondants est nul, renvoyer la réponse <em>cette question n'est <strong>pas</strong> intéressante</em>,
            <strong>sinon</strong>, renvoyez la question formattée par le template.
            
            <pre class="developpement" symbol="views.py"><code class="py">
            def donner_une_question(request):
                a = Question.objects.get(id=1)
                if a.repondants == 0:
                    return HttpResponse("Cette question n'est &lt;strong>pas&lt;/strong> intéressante")
                return render(request, "detail.html", {
                    "q": a,
                })
            </code></pre>
            
            <pre class="developpement" symbol="views.py (autre solution)"><code class="py">
            def donner_une_question(request):
                x = Question.objects.get(id=1)
                if a.repondants == 0:
                    return HttpResponse("Cette question n'est &lt;strong>pas&lt;/strong> intéressante")
                else:
                    return render(request, "detail.html", {
                        "q": x,
                    })
            </code></pre>
            
            <h3 id="exerci{{c|s}}e-6">Exerci{{c|s}}e 6{{ |}}: Lire la requête</h3>
            <p>Devoir changer le code source n'est pas bien pratique,
            ça serait bien si <strong>l'utilisateur</strong> pouvait tout simplement
            nous demander le numéro de la question qu'il veut pour que nous ne devions pas changer notre code source à chaque fois.
            
            <p>C'est là que le paramètre <code>request</code> entre en jeu.
            
            <p>Revenons à la discussion http entre le client et nous, le serveur.
            Le client nous envoie juste une url, <code class="url">/detail</code>, ça serait s'il pouvait dire quelque chose 
            de plus précis du genre, <em>le détail de la question numéro 1</em>, ce qui se traduira en url par :
            
            <pre><code class="url">/detail?numero=1</code></pre>
            
            <p>Le client nous demande donc un certain <code>numero</code>, allons-y et essayons de lire ce numéro,
            et de le mettre <em>près de nous</em> dans une <strong>variable</strong>, disons <strong>n</strong>
            (comme ça on pourra jouer avec, faire des <code class="py">if</code>, des <code class="py">while</code> ou des maths).
            
            <pre class="developpement" symbol="views.py"><code class="py">
            def donner_une_question(request):
                <mark>n = request.GET['numero']</mark>
                x = Question.objects.get(id=1)
                return render(request, "detail.html", {
                    "q": x,
                })
            </code></pre>
            
            <p class="comment">Les paramètres <code>GET</code> sont souvent utiliser pour les recherches,
                essayez d'aller sur <a href="https://google.be/search?q=django">google.be/search?q=django</a> et vous voyez que google utilise <code class="py">request.GET['q']</code> !
            
            <p class="comment">Pourquoi <code>GET</code> ? Car quand on va sur une page en écrivant directement l'url ou en cliquant sur un lien,
            on fait une requête http de type <code>GET</code>, cela peut se voir dans les outils de développeurs de votre navigateur (<kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>I</kbd>)
            à l'endroit où l'on voit les informations http, nous verrons plus tard qu'elle s'oppose à la méthode <code>POST</code>.
            
            <p>Essayez d'aller sur <code class="url">/detail?numero=1</code> ou <code class="url">/detail?numero=2</code> et que voyez-vous ?
            Notre code donne toujours la question numéro 1 et non celle qu'on donne en paramètre... Modifions le code !
            
            <pre class="developpement" symbol="views.py"><code class="py">
            def donner_une_question(request):
                n = request.GET['numero']
                x = Question.objects.get(<mark>id=n</mark>)
                return render(request, "detail.html", {
                    "q": x,
                })
            </code></pre>
            
            <p>Les deux urls <code class="url">/detail?numero=1</code> ou <code class="url">/detail?numero=2</code>
            affichent maintenant deux résultats différents, on a donc vraiment un site <strong>dynamique</strong> !
            
            <p>Exercice : Sur la page d'accueil
                (disons l'url <code class="url">/accueil</code> ou même l'url vide, <code class="url">/</code>),
                créez un lien html qui dira <em>viens voir ma <a>super question</a></em> et quand on cliquera sur le lien,
                on arrivera sur la page que l'on vient de créer, qui affiche la question numéro, disons, 4.
            
            <p class="developpement" symbol="Pas de correction">Pas de correction.
            
            <h4 id="does-not-exist">L'exception <code>DoesNotExist</code> quand il n'y a pas d'objet correspondant</h4>
            
            <p>Maintenant, que donne l'url <code class="url">/detail?numero=68</code> ?
            
            <p class="developpement">Nous n'avons pas de question numéro 68, django nous informe cela avec une erreur (<code>.get()</code> ne trouve pas l'élément).</p>
            
            <p>Peut-être que ce cas peut être géré différemment en <strong>capturant l'exception</strong> (voir <a href="progra_exceptions.py.html">théorie de python</a>).
            
            <pre class="developpement" symbol="views.py"><code class="py">
            from django.http import HttpResponseNotFound
            
            def donner_une_question(request):
                n = request.GET['numero']
                <mark>try:</mark>
                    x = Question.objects.get(id=n)
                <mark>except:</mark>
                    <mark>return HttpResponseNotFound("Pas de question ici !")</mark>
                return render(request, "detail.html", {
                    "q": x,
                })
            </code></pre>
            
            <p class="comment">Notez que dans un code structuré on préférera être plus précis sur le type de l'exception, pour éviter ce que l'on peut appeler des <a href="http://www.dodgycoder.net/2011/11/yoda-conditions-pokemon-exception.html">exceptions pokémon</a> :
            
            <pre class="developpement" symbol="views.py (facultatif mais fort conseillé)"><code class="py">
            from django.http import HttpResponseNotFound
            
            def donner_une_question(request):
                n = request.GET['numero']
                try:
                    x = Question.objects.get(id=n)
                except <mark>Question.DoesNotExist</mark>:
                    return HttpResponseNotFound("Pas de question ici !")
                return render(request, "detail.html", {
                    "q": a,
                })
            </code></pre>
            
            <p class="comment">Remarquez que Django préfère utiliser des noms plutôt que des <a href="https://en.wikipedia.org/wiki/List_of_HTTP_status_codes">numéros officiels http (status code)</a>.
                Ainsi on écrira <code>HttpResponseNotFound</code> pour la 404, <code>HttpResponse</code> pour la 200,
                et plus tard nous verrons également  <code>HttpResponseBadRequest</code> pour la 400
                et <code>HttpResponseRedirect</code> pour la 301.
            
            <p>Cependant maintenant, notre ancienne url <code class="url">/detail</code> (tout court) ne marche plus.
            Peut-être que certains utilisateurs étaient très content que nous renvoyions la première question dans ce cas.
            
            <h4>Détecter la présence d'un paramètre</h4>
            
            <p>Comment détecter la différence entre <code class="url">/detail</code> et <code class="url">/detail?reponse=2</code> ?
            
            <pre class="developpement" symbol="views.py"><code class="py">
            def donner_une_question(request):
                <mark>if 'numero' in request.GET</mark>:
                    n = request.GET['numero']
                else:
                    n = 1 # question par défaut
                x = Question.objects.get(id=n)
                return render(request, "detail.html", {
                    "q": x,
                })
            </code></pre>
            
            <p>Finalement, l'utilisateur veut peut-être être plus précis, et demander deux choses en même temps via une requête comme :
            
            <pre><code class="url">/detail?reponses=20&amp;categorie=SPORT</code></pre>
            
            <p>Cela veut dire que nous aurons <strong>deux</strong> paramètres disponibles,
            respectivement <code class="py">request.GET['reponses']</code>
            et <code class="py">request.GET['categorie']</code>.
            
            <p>Créez un <strong>nouvel attribut</strong> dans les questions, <code>categorie</code>, cet attribut devrait valoir exactement 
            un choix parmi <code>SPORT</code>, <code>CULTURE</code>, ou <code>SCIENCES</code>.
            
            <p>En modifiant <code>models.py</code>, vous voyez que <code>migrate</code> se plaint, pourquoi ?
            
            <div class="developpement little-box closable" symbol="migrate et l'ajout d'un nouvel attribut">
                <p>Indice : Que se passe-t-il dans Excel quand on rajoute une nouvelle colonne ?
                    Les anciennes questions vont avoir quoi commme valeur pour cette colonne ?
                    Cela casse notre contrainte de <code class="py">categorie in ("SPORT", "CULTURE", "SCIENCES")</code> !
                
                <p>Afin d'avoir une migration, logique on a deux solutions, soit de dire que lors de la migration on donne une valeur par défaut
                    comme <code class="py">"SPORT"</code>
                    ou bien on va dans <code>models.py</code> et l'on rajoute <code class="py">default="SPORT"</code> pour 
                    l'attribut <code>categorie</code>.
                
                <p>Cela dit que lorsqu'on crée une <code>Question</code> à l'avenir, si l'on ne spécifie rien,
                    la catégorie sera <code>"SPORT"</code>.
                    
                <pre><code class="py">
                # models.py avec default
                
                categorie = models.CharField(max_length=10, default="SPORT")
                </code></pre>
            
            </div>

            <p>Dans de pareilles requêtes (donne moi les question de sport dont le nombre de répondants vaut 20), nous devrons donc gérer plus d'une question,
            <strong>une seule variable</strong> ne sera plus utile
            et nous aurons besoin de <strong>listes</strong> ! Direction <a href="#exerci{{c|s}}e-7">la section suivante</a> !
            
            <h4 id="django-clean-urls">{{Plus de django : Urls épurées et url nommées|More django: clean urls and named urls}}</h4>
            <p>Des urls comme <code class="url">/detail?numero=12345</code> ce n'est parfois pas très élégant, avec Django, il est facile de faire <code class="url">/detail/12345</code>, 
            la <a href="https://docs.djangoproject.com/fr/2.0/topics/http/urls/">documentation officielle</a> est très bien mais voici un aperçu des fonctionnalités les plus utiles.
            
            <p>Nous comparons l'url <code class="url">/detail?numero=12345</code> :
            
            <pre class="developpement" symbol="urls.py"><code>
            path('detail', views.donner_une_question),
            </code></pre>
            
            <pre class="developpement" symbol="views.py"><code>
            def donner_une_question(request):
                numero = request.GET['numero']
                ...
            </code></pre>
            
            <p>À l'url <code class="url">/detail/12345</code> :

            <pre class="developpement" symbol="urls.py"><code>
            path('detail/&lt;numero>', views.donner_une_question),
            </code></pre>
            
            <pre class="developpement" symbol="views.py"><code>
            def donner_une_question(request, numero):
                ...
            </code></pre>
            
            <p>Une autre abstraction proposée par django est de <strong>nommer ses urls</strong> :
            
            <pre class="developpement" symbol="urls.py"><code>
            path('homepage/', views.dire_bonjour, <mark>name='page-home-basic'</mark>),
            </code></pre>
            
            <p>Le nom (ici <code>page-home-basic</code>) est arbitraire mais peut être le même que la vraie url (ici <code>homepage/</code>).
            
            <p>Cela permet de séparer les vraies urls, disponibles aux utilisateurs du site, de notre gestion interne, dispnible uniquement aux programmeurs du site.</p>
            
            <p>Dans un template, on utilise alors le tag <code class="django">&#123;% url %}</code>, acceptant un nom d'url :
            
            <pre class="developpement" symbol="template.html"><code class="django">
            &lt;p>Allez voir &lt;a href=<mark>"&#123;% url 'page-home-basic' %}"</mark>>ma belle page&lt;/a>, une merveille !&lt;/p>
            </code></pre>
            
            <p>Qui sera traduit en une vraie url :
            
            <pre class="developpement" symbol="template.html"><code>
            &lt;p>Allez voir &lt;a href=<mark>"/homepage/"</mark>>ma belle page&lt;/a>, une merveille !&lt;/p>
            </code></pre>
            
            <p>Si l'url contient des paramètres comme ici :
            
            <pre class="developpement" symbol="urls.py"><code>
            path('detail/&lt;numero>', views.donner_une_question, name='detail-question'),
            </code></pre>
            
            <p>On pourra les donner depuis une vue dans le template de deux manières :
            
            <pre class="developpement" symbol="views.py"><code>
            def f(request):
                return render(request, 'template.html', {
                    'x': 5,
                })
            </code></pre>
            
            <pre class="developpement" symbol="template.html"><code class="django">
            &lt;a href=<mark>"&#123;% url 'detail-question' x %}"</mark>>lien&lt;/a> &lt;!-- paramètre positionel, non conseillé --&gt;
            &lt;a href=<mark>"&#123;% url 'detail-question' numero=x %}"</mark>>lien&lt;/a> &lt;!-- paramètre nommé, conseillés --&gt;
            </code></pre>
            
            <!--
            <p>Pour mettre des paramètres <code>GET</code>, utilisez <code>| urlencode</code> :
            
            <pre class="developpement" symbol="template.html"><code>
            &lt;a href="&#123;/detail">lien&lt/a> &lt;!-- paramètres positionels, non conseillé --&gt;
            </code></pre>
            -->
            
            <p>Dans une vue, certaines fonctions de raccourci comme <code>redirect</code> accepte aussi bien un nom d'url plutôt qu'une vraie url :
            
            <pre class="developpement" symbol="views.py"><code>
            from django.shortcuts import redirect
            
            def f(request):
                return redirect('page-home-basic')
            </code></pre>
            
            <p>En python, pour faire la conversion depuis un nom vers une vraie url, il existe la fonction <code>reverse</code>.
            
            <pre class="developpement" symbol="views.py"><code>
            from django.urls import reverse
            
            def f(request):
                a = reverse('page-home-basic')
                # a == '/homepage/'
                ...
            </code></pre>
            
            <p>Plus d'information sur la <a href="https://docs.djangoproject.com/en/2.0/ref/urlresolvers/">documentation officielle</a>.
            
            <h3 id="exerci{{c|s}}e-7">Exerci{{c|s}}e 7{{ |}}: Listes et boucles dans le template</h3>
            
            <p>Créons maintenant une url <code class="url">/summary</code>,
                qui contiendra toutes les questions affichées dans une belle liste !
                
            <pre class="developpement" symbol="urls.py"><code>
            urlpatterns = [
                ...,
                path('summary', views.donne_les_questions),
            ]
            </code></pre>
            
            <p>Nous aurons besoin de deux nouvelles compétences :
            
            <ol>
                <li>Comment demander des listes à la base de données ?
                    On verra <code>.all()</code> 
                    et dans le chapitre suivant <code>.filter()</code>, <code>.order_by()</code>
                    et l'opération de <em>limit</em> via <code>[i:j]</code> ou <code>slice</code>.
                    
                <li>Comment un template peut-il afficher une liste ?
            </ol>
            
            <p>Pour demander à la base de donnée la liste de tous les objets d'un certain modèle,
                on utilise <a href="https://docs.djangoproject.com/fr/2.0/topics/db/queries/#retrieving-all-objects"><code class="py">.objects.all()</code></a>,
                qui nous donne la liste de <code>tous</code> les objets du modèle demandé.
            
            <pre class="developpement" symbol="views.py"><code class="py">
            def donne_les_questions(request):
                A = Question.objects.all() # A est une liste d'objets de type Question
                return render(request, "liste_de_question.html", {
                    "L": A,
                })
            </code></pre>
            
            <p>Nous faisons donc une requête à la base de donnée (une <em>query</em>) pour avoir notre liste,
            et nous la passons à un nouveau template qui sera capable de l'afficher.
            
            <p>Maintenant, le template reçoit une liste, et il aimerait bien afficher un par un les éléments de cette liste,
                en <strong>langage de template django</strong>, il existe un <strong>tag</strong> 
                <code>for</code> qui s'utilise comme dans 
                <code class="django">&#123;% for variable in list %} ... &#123;% <strong>endfor</strong> %}</code>.
                
            <p>Comment sera notre nouveau template qui accepte une liste <code>L</code> ?
            
            <pre class="developpement" symbol="liste_de_question.html"><code class="html">
            &lt;h1>Questions disponibles&lt;/h1>
            {% for q in L %}
                &lt;h2>Question: &#123;&#123; q.nom }}&lt;/h2>
                &lt;p>Répondants: &#123;&#123; q.repondants }}&lt;/p>
            {% endfor %}
            </code></pre>
            
            <p>Testez maintenant cette nouvelle url !
            On y voit toutes les questions affichées dans un certain ordre.
            
            <p>Peut-être les balises html <code class="html">&lt;ul></code> et <code class="html">&lt;li></code> seront plus adaptés à notre affichage en liste ?
            
            <pre class="developpement" symbol="liste_de_question.html"><code class="html">
            &lt;h1>Questions disponibles&lt;/h1>
            &lt;ul>
            {% for q in L %}
                &lt;li>&#123;&#123; q.nom }} totalisant &#123;&#123; q.repondants }}&lt;/li>
            {% endfor %}
            &lt;/ul>
            </code></pre>
            
            <p>Ce <code>for</code> en langage de template django est bien entendu lié au <code class="py">for</code>
            en python, voici ci-dessous un petit rappel sur les boucles.
            
            <div class="developpement little-box closable" symbol="Petit rappel de theorie2 sur les boucles while et for">
            <p>En <a href="theorie1_egal_if_fr.html">python</a> sans django, comment faisiez vous pour afficher tous les éléments d'une liste ?
            En utilisant <code>print()</code> essayez d'afficher les noms de toutes les questions à l'écran, le chapitre des <strong>boucles</strong> sera utile.
            
            <pre class="developpement" symbol="views.py (avec while)"><code class="py">
            def donne_les_questions(request):
                A = Question.objects.all().order_by('-repondants')
                
                i = 0
                while i &lt; len(A):
                    q = A[i]
                    print(q.nom, q.repondants)
                    i += 1
                
                return render(request, "liste_de_question.html", {
                    "L": A,
                })
            </code></pre>
            
            <p>Cependant, cette itération peut être simplifiée drastiquement avec <code>for</code> :
            
            <pre class="developpement" symbol="views.py (avec for)"><code class="py">
            def donne_les_questions(request):
                A = Question.objects.all().order_by('-repondants')
                
                for q in A:
                    print(q.nom, q.repondants)
                
                return render(request, "liste_de_question.html", {
                    "L": A,
                })
            </code></pre>
            
            <p class="comment">De plus, utiliser <strong>for</strong> dans ce cas-ci est accompagné d'un boost de performances.
            </div>
            
            <p>On affiche maintenant une liste, mais on aimerait peut-être changé l'ordre d'affichage, trier les questions par répondants,
                ou prendre uniquement les grosses questions,
                ou juste celle qui sont ouvertes,
                ou juste les 5 dernières crées,
                ou plein d'autres opérations.
            
            <h3 id="exerci{{c|s}}e-8">Exerci{{c|s}}e 8{{ |}}: Manipuler des listes</h3>
            
            <h4>Opération de <a href="https://docs.djangoproject.com/{{fr|en}}/2.0/topics/db/queries/#retrieving-specific-objects-with-filters">filter</a></h4>
            
            <p>Dans une nouvelle url <code class="url">/nonrepondues</code>, demandons à Django
                toutes les questions <strong>sans répondants</strong>, c'est à dire
                toutes les questions dont le nombre de répondants est égal à zéro,
                on utilisera donc <code>filter</code>,
                on reçoit donc une <strong>liste</strong>.
                
            <pre class="developpement" symbol="urls.py (django 2.0)"><code class="py">
            urlpatterns = [
                ...,
                path('nonrepondues', views.pas_de_repondants),
            ]
            </code></pre>
            
            <pre class="developpement" symbol="views.py"><code class="py normal-comments">
            def pas_de_repondants(request):
                A = Question.objects.<mark>filter(repondants=0)</mark> # A est une liste, la liste des questions avec 0 répondant
                return render(request, "liste_de_question.html", {
                    "L": A, # on donne A au template "liste_de_question.html" qui accepte une liste de question "L"
                })
            </code></pre>
            
            <p>Remarquez que je pourrais renommer la variable <code>A</code>.
            
            <!--
            <pre class="developpement" symbol="urls.py (django 1.11)"><code class="py">
            urlpatterns = [
                ...,
                url(r'^nonrepondues$', views.pas_de_repondants),
            ]
            </code></pre>
            -->
            
            <p>Django permet aussi de faire des requêtes contenant des comparaisons, <em>donne moi la liste des questions avec <strong>moins de 10</strong> répondants</em>
            ou en abbrégé <code>où repondants &lt; 10</code> se traduira en django <code class="py">.filter(repondants__lt=10)</code> (<strong>l</strong>ess <strong>t</strong>han).
            
            <pre class="developpement" symbol="views.py"><code class="py">
            def pas_de_repondants(request):
                A = Question.objects.filter(repondants<mark>__lt</mark>=10)
                return render(request, "liste_de_question.html", {
                    "L": A,
                })
            </code></pre>
            
            <p>Cela va donc afficher les questions ayant moins de 10 répondants, mais on ne sait pas prédire dans quel ordre.
            
            <p>Souvenez-vous bien de ceci :
            
            <ul>
                <li>dans une <strong>base de donnnées</strong>,
                <li>les <strong>lignes</strong>,
                <li>n'ont <strong>pas d'ordre</strong>.
            </ul>
            
            <p>Et donc quand vous faites des requêtes ambigües comme <em>la liste des questions où repondants &lt; 10</em>
            vous devez <strong>toujours</strong> ajouter un <strong>ordre</strong>.
            Cela se fait via <strong>order_by</strong>.
            
            <h4>Opération <em>order_by</em></h4>
            
            <p>Comment par exemple les trier par <code>id</code> ?
            
            <pre class="developpement" symbol="views.py"><code class="py">
            def pas_de_repondants(request):
                A = Question.objects.filter(repondants__lt=10).order_by(<mark>'id'</mark>) # guillemets !
                return render(request, "liste_de_question.html", {
                    "L": A,
                })
            </code></pre>
            
            <p>La liste sera donc triée par <code>id</code>,
                et si l'on ne spécifie rien, ça sera l'ordre <strong>croissant</strong>.
                Prendre le premier élément de cette liste sera donc l'élément avec l'<code>id</code> le plus petit.
                Cela nous donne probablement les questions par ordre de création car les nouvelles questions ont un <code>id</code> plus grand.
            
            <p>Les bases de données peuvent également ordonner dans l'ordre décroissant,
                ce qui se fait en django via le symbole <strong>&minus;</strong> avant le nom de l'attribut.
                
            <pre class="developpement" symbol="views.py"><code class="py">
            def pas_de_repondants(request):
                A = Question.objects.filter(repondants__lt=10).order_by('<mark>-</mark>id')
                return render(request, "liste_de_question.html", {
                    "L": A,
                })
            </code></pre>
            
            <p>La liste sera donc triée par ordre <strong>décroissant</strong> d'<code>id</code>.
                Prendre le premier élément de cette liste sera donc l'élément avec l'<code>id</code> le plus grand.
                
            <p>Remarquez que si l'on ne met pas de condition, on obtiendra simplement <strong>tous</strong> les éléments de la base de donnnée.
            
            <pre class="developpement" symbol="views.py"><code class="py">
            def pas_de_repondants(request):
                A = Question.objects.filter<mark>()</mark>.order_by('-id')
                return render(request, "liste_de_question.html", {
                    "L": A,
                })
            </code></pre>
            
            <p>Et quand <code>filter</code> n'a pas d'argument comme ici, il existe en fait un raccourci plus parlant, <code>all()</code>
                (<code>all</code> n'est en fait qu'un raccourci pour un <code>filter</code> vide !).
            
            <pre class="developpement" symbol="views.py"><code class="py">
            def pas_de_repondants(request):
                A = Question.objects<mark>.all</mark>().order_by('-id')
                return render(request, "liste_de_question.html", {
                    "L": A,
                })
            </code></pre>
            
            <p>Si ça nous chante, on pourrait trier les questions par répondants, ou par nom ce qui utilisera l'ordre alphabétique car <code>nom</code> est un <code>CharField</code>.
            
            <h4>Opération de <a href="https://docs.djangoproject.com/{{fr|en}}/2.0/topics/db/queries/#limiting-querysets">limit</a></h4>
            
            <p>On peut demander uniquement une <strong>partie</strong> de la liste,
                par exemple le premier élément,
                <a href="https://robertvandeneynde.be/parascolaire/theorie2_liste_while.html">vous savez</a>
                qu'en python, le premier élément d'une liste est <strong>à l'indice zéro</strong>.
                
            <p>Nous allons utiliser ceci pour par exemple afficher la question avec le <strong>moins</strong> de répondants.
                Nous réutiliserons notre tempalte de l'exercice 5 qui accepte <strong>une seule</strong> question.
            
            <pre class="developpement" symbol="views.py"><code class="py">
            def pas_de_repondants(request):
                A = Question.objects.all().order_by('repondants') # A est une liste d'objets de type Question (une liste de Question)
                b = A<mark>[0]</mark> # b est un objet de type Question (la première Question de la liste) (b est une Question)
                return render(request, "<mark>detail.html</mark>", {
                    "q": b,
                })
            </code></pre>
            
            <p class="comment">Remarquez que django propose aussi <code>A.first()</code> à la place de <code>A[0]</code> ce qui sera peut-être plus clair ici.
                Cependant, <code>A[0]</code> lance une exception si <code>A</code> est vide, alors que <code>.first()</code> renvoie <code>None</code>.
            
            <p>On peut également utiliser la syntaxe <code>A[i:j]</code> pour demander une sous-liste de la liste initiale,
            voici par exemple comment afficher les <strong>cinq</strong> questions avec le plus de répondants, on
            utilisera donc le template qui accepte une <strong>liste</strong> :
            
            
            <pre class="developpement" symbol="views.py"><code class="py">
            def pas_de_repondants(request):
                A = Question.objects<mark>.all</mark>().order_by('-id')
                return render(request, "<mark>liste_de_question.html</mark>", {
                    "L": <mark>A[0:5]</mark>,
                })
            </code></pre>
            
            <p>Dans la liste, on demande les questions d'indice <strong>0</strong> jusque <strong>5</strong> <em>non compris</em>, donc les <strong>5</strong> premières.
                Remarquez que quand on commence au début, on peut omettre le zéro et écrire <code>A[:5]</code> se qui se lit <em>les 5 premiers éléments de A</em>.
            
            <p class="comment">
                Il existe aussi une syntaxe plus verbeuse :
                
            <ul class="comment">
                <li><code class="py">A[0:5]</code> peut s'écrire <code class="py">A[slice(0,5)]</code>.
                <li><code class="py">A[:5]</code> peut s'écrire <code class="py">A[slice(5)]</code>
                ou <code class="py">A[slice(None, 5)]</code>.
            </ul>
                
            <p>Comment créer un nouveau template qui contient <strong>deux</strong> variables ?
            Disons <code>p</code> et <code>q</code>, où <code>p</code> représente la question avec le plus de répondant, et <code>q</code> celle avec le moins ?
            
            <pre class="developpement" symbol="views.py"><code class="py">
            def questions_extremes(request):
                q1 = Question.objects.all().order_by('repondants')[0]
                q2 = Question.objects.all().order_by('-repondants')[0]
                return render(request, "deux_questions.html", {
                    "p": q1,
                    "q": q2,
                })
            </code></pre>
            <pre class="developpement" symbol="deux_questions.html"><code class="html">
            &lt;h1>Première question&lt;/h1>
            &lt;h2>Titre : &lt;em>&#123;&#123; p.nom }}&lt;/em>&lt;/h2>
            &lt;p>Cette question a accumulé un total de &#123;&#123; p.repondants }} répondants.&lt;/p>
            
            &lt;h1>Dernière question&lt;/h1>
            &lt;h2>Titre : &lt;em>&#123;&#123; q.nom }}&lt;/em>&lt;/h2>
            &lt;p>Cette question a accumulé un total de &#123;&#123; q.repondants }} répondants.&lt;/p>
            </code></pre>
            
            <p>Le template aimerait également une troisième variable, qu'il appelle <strong>somme</strong>,
            elle contient la somme des répondants des deux questions
            (indice : python a l'opérateur <code>+</code> pour additionner deux variables).
            
            <pre class="developpement" symbol="views.py"><code class="py">
            def questions_extremes(request):
                q1 = Question.objects.all().order_by('repondants')[0]
                q2 = Question.objects.all().order_by('-repondants')[0]
                x = q1.repondants
                y = q2.repondants
                s = x + y
                return render(request, "deux_questions.html", {
                    "p": q1,
                    "q": q2,
                    "somme": s
                })
            </code></pre>
            <pre class="developpement" symbol="views.py (plus synthétique)"><code class="py">
            def questions_extremes(request):
                q1 = Question.objects.all().order_by('-repondants')[0]
                q2 = Question.objects.all().order_by('repondants')[0]
                return render(request, "deux_questions.html", {
                    "p": q1,
                    "q": q2,
                    "somme": q1.repondants + q2.repondants
                })
            </code></pre>
            <pre class="developpement" symbol="deux_questions.html"><code class="html">
            &lt;p>
                Les questions
                &lt;em>&#123;&#123; p.nom }}&lt;/em> et &lt;em>&#123;&#123; q.nom }}&lt;/em>
                totalisent ensemble &lt;strong>&#123;&#123; somme }}&lt;/strong> votes !
            &lt;/p>
            </code></pre>
            
            <p>Nous pouvons bien-sûr faire la <strong>moyenne</strong> ou une autre opération mathématique.
            
            <p>Sur la page d'accueil, mettez un lien <em>voir notre plus grosse question !</em> qui redirigera vers une page ayant le plus de répondants !
            
            <pre class="developpement" symbol="accueil.html"><code>
                &lt;p>Venez voir notre &lt;a href="/plus_grosse_question">plus grosse questions&lt;/a> !&lt;/p>
            </code></pre>
            <pre class="developpement" symbol="urls.py"><code class="py">
            urlpatterns = [
                ...,
                path('plus_grosse_question', views.plus_grosse_question),
            ]
            </code></pre>
            <pre class="developpement" symbol="views.py"><code>
            def plus_grosse_question(request):
                q = Question.objects.all().order_by('-repondants')[0]
                return render(request, 'detail.html', {
                    "q": q,
                })
            </code></pre>
            
            <p class="comment">Et là, notre ami le template a décidé de nommer sa variable <strong>somme</strong>, tant de 
                rationalité dans le cerveau de notre artiste que j'en étais étonné, je ne vois qu'une seule raison 
                logique à ce changement de comportement : je suis sûr qu'il sort depuis peu
                avec une ingénieure ! &mdash;
                Discussion à la machine à café après la business meeting</p>
            
            <p>(Désolé pour mes blagues, il est tard et je ris facilement).
            
            <h4>Pour en savoir plus</h4>
            
            <p>Plus d'information dans la <a href="https://docs.djangoproject.com/{{fr|en}}/2.0/topics/db/queries/">documentation officielle</a>.
            
            <h3 id="exercices-sur-les-boucles">Exercices</h3>
            <p>Exercice, en python pur, comment afficher toutes les questions, mais si le nombre de répondants est nul, alors on affichera plutot <em>question pas intéressante</em> à la place du nom.
            
            <pre class="developpement" symbol="views.py"><code class="py">
            def donne_les_questions(request):
                toutes_les_questions = Question.objects.all().order_by('-repondants')
                
                for q in toutes_les_questions:
                    if q.repondants == 0:
                        print("Pas intéressante")
                    else:
                        print(q.nom, q.repondants)
                
                return render(request, "liste_de_question.html", {
                    "L": toutes_les_questions,
                })
            </code></pre>
            
            <p>Remarquez que le tag <code>{% if condition %}{% endif %}</code> existe, il est moins puissant que celui de python, mais peut parfois bien aider comme des cas comme ici.
            
            <pre class="developpement" symbol="liste_de_question.html"><code class="django">
            &lt;h1>Questions disponibles&lt;/h1>
            {% for q in L %}
                {% if q.repondants == 0 %}
                    &lt;h2>Question: &#123;&#123; q.nom }}&lt;/h2>
                    &lt;p>Répondants: &#123;&#123; q.repondants }}&lt;/p>
                {% else %}
                    &lt;h2>Questions pas intéressante...&lt;/h2>
                {% endif %}
            {% endfor %}
            </code></pre>
            
            <p>Et on pourrait même ne pas les afficher :
            
            <pre class="developpement" symbol="liste_de_question.html"><code class="django">
            &lt;h1>Questions disponibles&lt;/h1>
            {% for q in L %}
                {% if q.repondants == 0 %}
                &lt;h2>Question: &#123;&#123; q.nom }}&lt;/h2>
                &lt;p>Répondants: &#123;&#123; q.repondants }}&lt;/p>
                {% endif %}
            {% endfor %}
            </code></pre>
            
            <p>Ou tout simplement les exclure de la liste (django un peu plus <em>avancé</em>) :
            
            <pre class="developpement" symbol="views.py"><code class="py">
            def donne_les_questions(request):
                toutes_les_questions = Question.objects.all().order_by('-repondants')<mark>.exclude(repondants=0)</mark>
                return render(request, "liste_de_question.html", {
                    "L": toutes_les_questions,
                })
            </code></pre>
            
            <p>Comment afficher la liste des questions, mais en mettant en rouge les questions dont le nombre de répondants est plus petit que <strong>10</strong> ?
            
            <p class="developpement" symbol="correction à venir !">correction à venir !
            
            <p>Comment faire pour que ce paramètre est choisissable dans l'url via <code>request.GET</code> ?
            
            <p class="developpement" symbol="correction à venir !">correction à venir !
            
            <p>Comment faire pour afficher les 3 questions avec le plus de répondants ?
            
            <p class="developpement" symbol="correction à venir !">correction à venir !
            
            <p>Raccourci: peut également faire des slicing sur une liste, comme <code>L[:3]</code> pour les trois premiers d'une liste.
            
            <p class="developpement" symbol="correction à venir !">correction à venir !
            
            <p>Faire une nouvelle url, disons <code class="url">/shortlist</code> qui va afficher la liste des questions 
            avec juste le nom, mais ce nom est un <strong>lien</strong> qui va vers la vue détaillée, <code class="url">/detail?numero=5</code> par exemple.
            
            <pre class="developpement" symbol="petite_liste.html"><code>
                &lt;ul>
                &#123;% for q in L %}
                    &lt;li>
                        &#123;&#123; q.nom }}
                        (plus d'infos &lt;a href="/details?numero=&#123;&#123; q.id }}">ici&lt;/a>).
                    &lt;/li>
                &#123;% endfor %}
                &lt;/ul>
            </code></pre>
            
            <p class="comment">Remarquez
                qu'ici le paramètre que l'on remplace est juste un nombre entier,
                il n'y a donc pas de soucis,
                mais en toute généralité, on devra utiliser <code>urlencode</code> pour faire ce genre d'opérations :
                
            <pre class="developpement" symbol="petite_liste.html avec urlencode"><code>
                &lt;ul>
                &#123;% for q in L %}
                    &lt;li>
                        &#123;&#123; q.nom }}
                        (plus d'infos &lt;a href="/details?numero=&#123;&#123; q.id <mark>| urlencode</mark> }}">ici&lt;/a>).
                    &lt;/li>
                &#123;% endfor %}
                &lt;/ul>
            </code></pre>
            
            <p>Affichez la catégorie de la question, mais pas en majuscule (google: mettre en minuscule dans un django template),
            et accompagnez également une petite description de la catégorie du style <em>Cette question est culturelle, elle parle de bla bla bla</em>.
            
            <p class="developpement" symbol="correction à venir !">correction à venir !
            
            <!-- <p>limit : only 3 last, only n last → GET parameter n
            <p>filter by a new attribute fcatégorie (validate!), mode, sport, info, phys
            <p>makemigrations, and error when migrate ! (why ?)
            <p>filter by répondants > 50
            <p>On homepage, a link to n=1 -->
            <!-- limit, filter, order by, all() is just a special case -->
            <!-- .count() et .exists() optimisations -->
            
            <!-- for in the templates -->
            
            <h3 id="exerci{{c|s}}e-9">Exerci{{c|s}}e 9{{ |}}: Les dates</h3>
            <p>Un nouveau type d'attribut est le type <code>DateTimeField</code>, il permet de stocker une <em>date et heure</em>,
            très pratique lors de la création d'un site web !
            
            <p>Créez un attribut <code>date_de_fin</code> qui indiquera la date de fin du sondage.
            
            <p class="developpement" symbol="correction à venir !">correction à venir !
            
            <p class="comment">Pure curiosité, comment cet attribut est-il représenté dans la base de donnée ?
            <p class="developpement" symbol="Solution">Par une chaîne de caractère de la forme <code>2000-12-31T08:30:10</code>
            
            <p>Afficher une page qui affiche les questions qui vont bientôt se fermer !
            C'est à dire que vous aurez besoin de connaître le temps actuel (google <code>timezone.now()</code>).
            Indice : Deux dates python peuvent être comparées via <code>&lt;</code>.
            
            <p class="developpement" symbol="correction à venir !">correction à venir !
            
            <p>Comment avoir les questions qui se sont finies il y a moins de 1 semaine ? (google <code>.filter(...)</code>).
            
            <p>Comment afficher une date dans un template au format belge 31/12/2018 ? (google !)

            <!-- <p>Python de base from datetime import datetime, timedelta, date, time, datetime.strftime, datetime.strptime -->
            <!-- <p>Petite note sur les timezone et DST (fuseaux horaires et heures d'été) UTC vs Greenwhich -->
            <!-- <p>Django et les timezone: timezone.now(), use of pytz, date in filter -->
            <!-- https://docs.djangoproject.com/en/1.11/ref/templates/builtins/#date -->
            
        </section>
        
        <h2 id="form">Les formulaires pour envoyer des données au serveur</h2>
        
        <section name="form">
            <button class="open-all-developpement">Cliquez ici pour faire apparaître toutes les corrections et annexes !</button>
            
            <h3 id="exerci{{c|s}}e-10">Exerci{{c|s}}e 10{{ |}}: Poster un formulaire</h3>
            
            <h4>Le formulaire à remplir</h4>
                <p class="comment">Imaginez... la vraie vie :
                    Vous êtes à la commune (la mairie pour nos amis français), et vous voulez leur apporter des informations,
                    disons que vous avez un nouveau né à déclarer.
                    
                    Vous arrivez à l'accueil et là vous voyez <strong>Au guichet A12, service des naissances</strong>,
                    vous êtes donc parti pour le guichet A12... Qui vous donne, un <strong>formulaire</strong>.

                <p>Créer une page statique <code class="url">/formulaire_creation_question</code> qui contient un formulaire !
                    Il y aura deux attributs, le nom, et la catégorie.
                    
                    Mettez également un petit lien sur la page d'accueil pour que les utilisateurs puissent facilement le trouver.
                
                <pre class="developpement" symbol="urls.py"><code class="py">
                    urlpatterns = [
                        ...
                        path('formulaire_creation_question', views.formulaire_creation_question),
                    ]
                </code></pre>
                <pre class="developpement" symbol="views.py"><code class="py">
                    def formulaire_creation_question(request):
                        return render(request, 'question_form.html')
                    </code></pre>
                <pre class="developpement" symbol="accueil.html"><code class="html">
                    &lt;p>Venez &lt;a href="/formulaire_creation_question">ici&lt;/a> pour créer une question !&lt;/p>
                </code></pre>
                <pre class="developpement" symbol="question_form.html"><code class="html">
                    &lt;form> &lt;!-- à remplir au prochain point -->
                        &lt;!-- à remplir au prochain point -->
                    &lt;/form>
                </code></pre>
                
            <h4>Le contenu du formulaire : <code>&lt;input/></code></h4>
                <p>Le formulaire contient des <code class="html">&lt;input type="text" /></code>
                    ce sont les champs qui vont êtres affichés :</p>
                    
                <!--
                vous devez également indiquer vers quelle url on ira quand on clique sur le bouton <em>Envoyer</em>,
                    créez donc une <strong>autre</strong> url qui va être capable de créer une question !
                    Disons <code class="url">/create_question</code>.</p>
                -->
                
                <pre class="developpement" symbol="question_form.html"><code class="html">
                    &lt;form method="GET" action="/inconnu"> &lt;!-- on ne sait pas encore quoi mettre dans action -->
                        &lt;p>Titre de la question : &lt;input type="text" name="le_nom" />&lt;/p>
                        &lt;p>Sa catégorie : &lt;input type="text" name="la_categorie" />&lt;/p>
                    &lt;/form>
                </code></pre>
                
                <p>L'utilisateur sera donc invité à rentrer deux données, essayez la nouvelle url et admirez le formulaire !
                
                <form class="developpement" symbol="Solution" method="GET">
                    <p>Titre de la question : <input type="text" name="le_nom" /></p>
                    <p>Sa catégorie : <input type="text" name="la_categorie" /></p>
                    <p><input disabled type="submit" />
                </form>
                
                <p>Que se passe-t-il quand on clique sur <em>Envoyer</em> après avoir rempli les deux informations, disons <em>Aimez-vous la pizza ?</em> et <em>SPORT</em> ?
                
                <p class="developpement" symbol="Solution">
                    On arrive sur l'url <code class="url">/inconnu?le_nom=Aimez-vous+la+pizza+?&amp;la_categorie=SPORT</code>
            
            <h4>La cible du formulaire : L'url de traitement de l'information</h4>
                <p class="comment">La vraie vie, suite : Vous avez maintenant rempli votre formulaire à la commune (<span style="text-decoration: line-through;">la mairie</span>),
                    et au dessus vous voyez <strong>Veuillez rendre ce formulaire au guichet B42</strong>
                    en effet, le guichet B42 est spécialisé dans la modification des dossiers des citoyens, pas dans la remise de formulaire.
                    Le guichet B42 c'est pas le A12, voyons.
            
                <p>On arrive donc sur une autre url, qui contient des paramètres <code>GET</code> !
                    On peut donc faire une url dont le but sera de <strong>créer une question</strong>.
                    
                <pre class="developpement" symbol="question_form.html"><code class="html">
                    &lt;form method="GET" action="<mark>/creer_une_question</mark>"> 
                        &lt;p>Titre de la question : &lt;input type="text" name="le_nom" />&lt;/p>
                        &lt;p>Sa catégorie : &lt;input type="text" name="la_categorie" />&lt;/p>
                        &lt;p><mark>&lt;input type="submit" /></mark>&lt;/p>
                    &lt;/form>
                </code></pre>
                <pre class="developpement" symbol="urls.py"><code class="py">
                    urlpatterns = [
                        ...
                        path('creer_une_question', views.creer_une_question),
                    ]
                </code></pre>
                <pre class="developpement" symbol="views.py"><code class="py">
                    def creer_une_question(request):
                        a = request.GET['le_nom']
                        b = request.GET['la_categorie']
                        print('On veut créer une question dont le nom est', a, 'et la catégorie', b)
                        return HttpResponse('Création réussie !')
                </code></pre>
                
                <p>On fera donc bien la différence entre la page statique qui donne le formulaire et indique où aller après,
                    et la deuxième url qui fait effectivement l'action, qui ici est de modifier la base de données.
                
                <p class="comment">Si on omet l'attribut <code>action</code>, html 5 nous dit que c'est l'url en cours qui est utilisée, celle qui nous a donné le formulaire,
                    peu pratique si l'on a plusieurs formulaires sur la même page.
            
            <h3 id="exerci{{c|s}}e-11">Exerci{{c|s}}e 11{{ |}}: Modifier la base de donnée</h3>
                <p>Pour créer un objet dans la base de données, rien de plus simple, <strong>créez un objet Python</strong> comme <code>q = Question()</code>, mettez ses attributs
                    (le nombre de répondants commence à 0), puis appelez <code>q.save()</code> qui va sauvegarder l'objet dans la base de donnée.
                
                <pre class="developpement" symbol="views.py"><code class="py">
                    def creer_une_question(request):
                        a = request.GET['le_nom']
                        b = request.GET['la_categorie']
                        <mark>q = Question() </mark> # 1) on crée un objet
                        <mark>q.nom = a</mark>       # 2) on lui met ses attributs
                        <mark>q.categorie = b</mark>
                        <mark>q.repondants = 0</mark>
                        <mark>q.save()</mark>        # 3) on le sauve dans la base de donnée
                        return HttpResponse('Création réussie !')
                </code></pre>
                
                <p>Django permet également un petit raccourci pour rapidement mettre des données dans un nouvel objet :
                
                <pre class="developpement" symbol="views.py"><code class="py">
                    def creer_une_question(request):
                        a = request.GET['le_nom']
                        b = request.GET['la_categorie']
                        
                        <mark>q = Question(nom=a, categorie=b, repondants=0)</mark>
                        <mark>q.save()</mark>
                        
                        return HttpResponse('Création réussie !')
                </code></pre>
                
                <p>Et Django contient même <span class="developpement" symbol="un autre raccourci"><code>Question.objects.create(nom=a, categorie=b, repondants=0)</code></span> qui fait les trois opérations en un coup
                    afin que l'on ne doivent même pas appeler <code>.save()</code> mais rappelez vous surtout de la première manière qui sépare bien les 3 étapes.
                    
                <p>Essayez de remplir le formulaire, et vérifiez que l'objet a bien été créé dans la base de donnée !
            
                <p>Chaque input aura un nom (<code>name</code> dans le html), c'est ce nom qui sera accessible dans django dans le paramètre de la requête.
                    Essayez d'appeler simplement vos deux <code>input</code> <code class="html">name="premier"</code> et <code class="html">name="deuxieme"</code>,
                    que devez vous changer dans le code python quand vous renommez ces deux <code>input</code> ?
                    
                <div class="developpement little-box closable" symbol="default dans models.py">
                <p>
                    Ici on a explicitement dû mettre <code class="py">repondants = 0</code> 
                    lors de la création de la question,
                    il est également possible de modifier <code>models.py</code>
                    pour dire que l'attribut repondants a une valeur par défaut de 0
                    
                <pre><code class="py">
                # models.py
                
                class Question(models.Model):
                    nom = models.CharField(max_length=50)
                    categorie = models.CharField(max_length=10)
                    repondants = models.IntegerField(<mark>default=0</mark>)
                </code></pre>
                
                <p>Du coup, on ne doit pas l'indiquer dans la vue :
                
                <pre><code class="py">
                # views.py
                
                def creer_une_question(request):
                    a = request.GET['le_nom']
                    b = request.GET['la_categorie']
                    
                    q = Question(nom=a, categorie=b) # repondants prendra la valeur par défaut
                    q.save()
                    
                    return HttpResponse('Création réussie !')
                </code></pre>
                </div>
            
            <h3 id="exerci{{c|s}}e-12">Exerci{{c|s}}e 12{{ |}}: Redirection avec http 301</h3>
                <p>Quand la donnée a été sauvegardée, on doit bien entendu renvoyer une réponse, par exemple <em>Création réussie</em>,
                mais peut être que si tout se passe bien, on aimerait aller sur une autre page. On peut utiliser si l'on veut une 
                Http 301 Redirect :
                
                <pre class="developpement" symbol="views.py"><code class="py">
                <mark>from django.http import HttpResponseRedirect</mark>
                
                def creer_une_question(request):
                    a = request.GET['le_nom']
                    b = request.GET['la_categorie']
                    q = Question(nom=a, categorie=b)
                    q.save()
                    <mark>return HttpResponseRedirect('/accueil')</mark>
                </code></pre>
                
                <p class="comment">Dans les outils de développement, Ctrl+Shift+I, onglet réseau on voit que l'on a d'abord été sur la première url qui nous donne le formulaire,
                    puis sur <code class="url">/creer_une_question</code>
                    qui nous renvoie status = 301 (Redirect) pour dire <em>tout s'est bien passé, mais maintenant va sur une autre url !</em>
                    et puis nous arrivons sur <code class="url">/accueil</code> qui nous renvoie status = 200 (OK) avec la page d'accueil.
                
            <h3 id="exerci{{c|s}}e-13">Exerci{{c|s}}e 13{{ |}}: Validation</h3>
                <p>Attention, la catégorie doit bien être une des 3 valeurs autorisées, <code>SPORT</code>, <code>SCIENCES</code>, <code>CULTURE</code>, le serveur doit vérifier cela !
                
                <p>Cette étape est une sorte de sécurité des données et est appelée <strong>Validation</strong>,
                    de la sorte, on n'acceptera pas n'importe quoi dans la base de donnée !
                    
                <p class="comment">
                    Je peux citer plein d'autres exemples classiques de validation
                    comme vérifier que si l'on attend un nombre on a bien reçu un nombre ou
                    que si un utilisateur fait une transaction impliquant de l'argent, il a bien assez d'argent sur son compte.
                    
                <p>Si l'utilisateur a écrit n'importe quoi, on fera une erreur 400 Bad Request
                accompagnée d'un petit message sympatique.
                Erreur 400 veut dire par convention, <em>erreur du client</em>
                en effet, ce gentil utilisateur, il a écrit <em>banane</em> dans le champs catégorie, quel distrait...
                
                <pre class="developpement" symbol="views.py"><code class="py">
                    def creer_une_question(request):
                        a = request.GET['le_nom']
                        b = request.GET['la_categorie']
                        
                        a = a.upper() # on convertit en majuscules
                        
                        if a == 'SPORT' or a == 'CULTURE' or a == 'SCIENCES':
                            q = Question(nom=a, categorie=b)
                            q.save()
                            return HttpResponseRedirect('/accueil')
                        else:
                            return HttpResponseBadRequest('La catégorie doit être une des catégories valides !')
                </code></pre>
                
                <p>Essayez de créer une question ayant une catégorie hors des choix possibles,
                    vous verrez maintenant un petit message d'erreur et devrez cliquer sur le bouton Retour de votre navigateur...
                
                <p>Nous verrons plus tard comment aider notre utilisateur en améliorant son <strong>interface</strong> pour qu'il ne puisse plus faire d'erreur par distraction.
                
                <div class="developpement little-box closable" symbol="simplification de code !">
                    <p>En s'amusant un peu avec les <a href="progra_equivalences.html">équivalences</a>, on peut réécrire le code précédent différemment, si on préfère :
                    
                    <pre class="developpement" symbol="views.py"><code class="py">
                        def creer_une_question(request):
                            a = request.GET['le_nom']
                            b = request.GET['la_categorie']
                            
                            b = b.upper() # on convertit en majuscules
                            
                            if not(b == 'SPORT' or b == 'CULTURE' or b == 'SCIENCES'):
                                return HttpResponseBadRequest('La catégorie doit être une des catégories valides !')
                            else:
                                q = Question(nom=a, categorie=b)
                                q.save()
                                return HttpResponseRedirect('/accueil')
                    </code></pre>
                    
                    <p>C'est une inversion de condition.
                    
                    <p>ou :
                    
                    <pre class="developpement" symbol="views.py"><code class="py">
                        def creer_une_question(request):
                            a = request.GET['le_nom']
                            b = request.GET['la_categorie']
                            
                            b = b.lower() # on convertit en majuscules
                            
                            if not(b == 'SPORT' or b == 'CULTURE' or b == 'SCIENCES'):
                                return HttpResponseBadRequest('La catégorie doit être une des catégories valides !')
                            
                            q = Question(nom=a, categorie=b)
                            q.save()
                            return HttpResponseRedirect('/accueil')
                    </code></pre>
                    
                    <p>C'est utiliser la propriété du return.
                    
                    <p>Finalement la condition
                    
                    <pre><code class="py">not(b == 'SPORT' or b == 'CULTURE' or b == 'SCIENCES')</code></pre>
                    <p>peut être réécrite via les lois de logique (lois de De Morgan) en
                    
                    <pre><code class="py">b != 'SPORT' and b != 'CULTURE' and b != 'SCIENCES'</code></pre>
                    <p>ou bien en
                    
                    <pre><code class="py">b not in ('SPORT', 'CULTURE', 'SCIENCES')</code></pre>
                    <p>si l'on connaît plus de python car l'on sait que
                        <code class="py">a == 1 or a == 2</code>
                        est équivalent à
                        <code class="py">a in (1, 2)</code>
                </div>
            
            <h4>Exercices de validation</h4>
                <p>Rajoutez une autre validation, on aimerait que le nom de la question soit d'au moins 10 caractères.
                
                <pre class="developpement" symbol="views.py"><code class="py">
                    def creer_une_question(request):
                        a = request.GET['le_nom']
                        b = request.GET['la_categorie']
                        
                        b = b.lower() # on convertit en minuscule
                        
                        if len(a) &lt; 10:
                            return HttpResponseBadRequest("Veuillez entrer une plus longue question s'il vous plaît.")
                            
                        if b == 'sport' or b == 'culture' or b == 'sciences':
                            q = Question(nom=a, categorie=b)
                            q.save()
                            return HttpResponseRedirect('/accueil')
                        else:
                            return HttpResponseBadRequest('La catégorie doit être une des catégories valides !')
                </code></pre>
                
                <p>On peut faire absoulment tout ce que l'on veut vu qu'on est dans du code python !
                    Essayez par exemple de n'accepter que les questions qui finissent par un point d'interrogation.
                    
                <pre class="developpement" symbol="views.py"><code class="py">
                # à venir !
                </code></pre>
                    
                <p>Ou bien d'en rajouter un s'il n'y en n'a pas.
                
                <pre class="developpement" symbol="views.py"><code class="py">
                # à venir !
                </code></pre>
            
            <!-- Every input element, that have a name, are sent -->
            <!--
            <p>Form: create a question, you need two attributes, name, and type.
            <p>Test the type !
            <p>New view that does "create_question" vs "create_question_form", two urls
            -->
            <!-- (5 minutes, form) -->
            
            <!--
            <h3 id="exerci{{c|s}}e-11">Exerci{{c|s}}e 10{{ |}}: Redirections avec http 301</h3>
            <p>Quand le formulaire Redirect
            (2 minutes)
            <p>→ ctrl shift I, 301
            -->

            <h3 id="exerci{{c|s}}e-14">(Facultatif) Exerci{{c|s}}e 14{{ |}}: Encore plus d'<code>input</code> html</h3>
            
            <p>Il serait plus facile pour l'utilisateur d'utiliser un menu déroulant (html <code>&lt;select></code>) comme ceci :
            <p>
                Catégorie : <select name="la_categorie">
                    <option value="SPORT">Sport</option>
                    <option value="CULTURE">Culture</option>
                    <option value="SCIENCES">Sciences</option>
                </select>
            <p class="developpement" symbol="Solution">À venir !
            
            <p>Attention, la validation doit toujours se faire, ici on améliore juste l'expérience utilisateur, mais le serveur peut toujours 
                recevoir des données incorrectes comme <code>la_categorie=blabla</code>.
                
            <p>Rajoutons un attribut au modèle Question : la description.
                On utilisera l'élément html <code>&lt;textarea></code> pour remplir cela.
                Pendant la migration, toutes les Question déjà créées auront une description vide.
                
            <p>Un autre élément html sympatique, c'est la checkbox, rajouter un <code class="html">&lt;input type="checkbox"></code>.
                Pour notre application, on peut simplement demander d'accepter les conditions générales, renvoyant une erreur 400 si la case n'est pas cochée.
            
            <p>Une fois le formulaire remplit, observez l'url générée, quelle est la différence entre un formulaire où la checkbox est cochée ou non ?
                
            <p class="developpement" symbol="Solution">
                Si la case est cochée, le code <code>'name' in request.GET</code> sera <code>True</code>, sinon il sera false.
                
                On aura l'url <code class="url">?la_categorie=SPORT&amp;name=on</code> contre 
                <code class="url">?la_categorie=SPORT</code> sans l'attribut.
                
                Remarquez que ce <code>on</code> peut être changé en indiquant <code>&lt;input value="coucou"></code>
            
            <p>Les checkbox peuvent également donner une liste de choix, mettez plusieurs checkbox avec le même <code>name</code>.
            Elles peuvent alors avoir un attribut value qui va être envoyé ou non.
            On pourra y accéder en faisant <code class="py">request.GET.getlist('name')</code>
            
            <h3 id="exerci{{c|s}}e-15">(Facultatif) Exerci{{c|s}}e 15{{ |}}: method <code>POST</code> vs <code>GET</code></h3>
            <p class="comment">Ça serait quand même plus simple si ces deux guichets étaient au même endroit.
            
            <div class="developpement" symbol="Brouillon">
            <p>Cette section est en cours d'écriture, donc si vous êtes arrivés jusque ici en guidances, venez me voir (Robert Vanden Eynde sur facebook) et je vous raconterai l'essentiel !
            
            <p>How to merge the two views ? (Not mandatory to do so, one can choose to always have two different urls).
            <!-- (3 min, merge) -->
            <ul>
                <li>One could do <em>if the form has some missing field, return the form, else process the data</em>
                <li>→ method=POST vs GET, POST is more logical than GET for most forms.
                <li>GET doesn't modify the database, POST does (that's just a convention).
                <li>POST hides the data from the URL, url are often shared and sometimes written
                    (parameters may contain sensitive data, and accidentally be sent to a friend)
                    but you can see it in Ctrl+Shift+I (still sent in the enveloppe)
                    or <code>print(request.POST)</code>.
                    Google <em>difference between POST and GET in website architecture</em>
                <li>POST enables file upload (google <em>how to upload files</em>).
                    → html <code>enctype="multipart/form-data"</code>
                    → django <code>request.FILES</code>
                <li>POST in django has a security called <em>csrf</em> enabled by default,
                    when writing a <code class="html">&lt;form></code> with <code class="html">method="POST"</code>
                    one must include <code class="html">{% crsf_token %}</code> in the form.
            </ul>
            
            <p>→ If you want to merge the two views, use <code>if request.method == 'POST':</code>, the user explicitly says <em>I want to modify the db</em>.
                <em>I want to post something</em>. And not only <em>I want to GET something</em>.
            <!-- (2 min, using post) -->
            </div>
            
            <h3 id="django.forms">Django forms, le tout en un !</h3>
            
            <p>Django met à disposition une classe <code>Form</code>, que l'on importe via <code class="py">from django import forms</code>,
            cela permet de faire <em>automatiquement</em> les trois étapes qu'on a fait avant, à condition de savoir les utiliser :
            
            <ol>
                <li>Création d'un formulaire en html, <code class="html">&lt;form></code>, <code class="html">&lt;input/></code> et companie).
                <li>Lecture de la requête POST et le lien avec le modèle (<code>request.POST</code>, <code>q = Question()</code> et les <code>q.nom = ...</code>).
                <li>Validation simple (vérifier que les données soient bien des <code>int</code>, que <code>type</code> soit bien <code>CULTURE</code>, <code>SPORT</code> ou <code>SCIENCES</code>, ou encore des validations plus compliquées).
            </ol>
            
            <p>Ce tutoriel n'en parle pas car pour les débutants c'est autant d'efforts d'utiliser les <code>django.forms</code> que de coder un formulaire html.
            Plus d'infos sur internet comme par exemple 
                <a href="https://docs.djangoproject.com/{{fr|en}}/2.0/topics/forms/">ici</a> ({{disponible en français et anglais|available in French or English}}) ou
                <a href="https://tutorial.djangogirls.org/{{fr|en}}/django_forms/">là</a>.
            
            <p><code>django.forms</code> nous permet de ne pas réinventer la roue et de réutiliser des éléments classiques de gestion de
                formulaire, mais cependant dans des cas plus complexes, on devra quand même coder.
                Par exemple, une validation du style <em>vérifier qu'un rendez-vous n'entre pas en collision avec d'autres rendez-vous</em>
                est une tâche de validation assez facile à coder mais difficile à exprimer en terme de <code>django.forms</code>.
            
            <p>Comme degré d'abstraction suivant, on a <code>ModelForm</code>, qui permet de générer automatiquement un formulaire depuis un modèle,
                plus d'informations sur la <a href="https://docs.djangoproject.com/{{fr|en}}/2.0/topics/forms/modelforms/">documentation officielle</a>.
            
            <h3 id="exerci{{c|s}}e-16">Exerci{{c|s}}e 16{{ |}}: Questions à choix multiples dans la base de données</h3>
            <p>On aimerait maintenant que nos questions soient des Questions à Choix Multiples (QCM).
                C'est à dire que l'on indique des choix possibles pour chaque Question.
                Comme par exemple :
            
            <p><em>Quel est le pays le plus grand en superficie ?</em>
            <ul>
                <li>Belgique
                <li>France
                <li>Brésil
            </ul>
            
            <p>Comment indiquer ces différents choix dans la base de données ?
                Comment feriez vous en Excel ?
            
            <p>En excel vous feriez peut-être trois colonnes <code>choix1</code>, <code>choix2</code>, <code>choix3</code>,
            ainsi que trois colonnes contenant le nombre de votes
                Ça peut paraître stupide mais on verra plus tard avec les bases de données relationnelles comment avoir une meilleure solution.
            
            <table class="developpement" symbol="Aperçu de la table excel">
                <thead>
                    <tr>
                        <th colspan="100">Table Question</th>
                    </tr>
                </thead>
                
                <tr>
                    <th>nom</th>
                    <th>repondants</th>
                    
                    <th>choix1</th>
                    <th>choix2</th>
                    <th>choix3</th>
                    
                    <th>votes1</th>
                    <th>votes2</th>
                    <th>votes3</th>
                </tr>
                
                <tr>
                    <td>Quel est votre fruit préféré ?</td>
                    <td>32</td>
                    
                    <td>Les pommes</td>
                    <td>Les bananes</td>
                    <td>Les oranges</td>
                    
                    <td>15</td>
                    <td>12</td>
                    <td>5</td>
                </tr>
                
                <tr>
                    <td>Aimez vous le basket ?</td>
                    <td>25</td>
                    
                    <td>Oui</td>
                    <td>Non</td>
                    <td>Peut-être</td>
                    
                    <td>20</td>
                    <td>5</td>
                    <td>0</td>
                </tr>
                <tr>
                    <td>L'impédance d'un condensateur ?</td>
                    <td>75</td>
                    
                    <td>1/jωC</td>
                    <td>jωL</td>
                    <td>jωC</td>
                    <td>25</td>
                    <td>25</td>
                    <td>25</td>
                </tr>
            </table>
            
            <table class="developpement" symbol="Avec un autre ordre des colonnes">
                <thead>
                    <tr>
                        <th colspan="100">Table Question</th>
                    </tr>
                </thead>
                
                <tr>
                    <th>nom</th>
                    <th>repondants</th>
                    <th>choix1</th>
                    <th>votes1</th>
                    
                    <th>choix2</th>
                    <th>votes2</th>
                    
                    <th>choix3</th>
                    <th>votes3</th>
                </tr>
                
                <tr>
                    <td>Quel est votre fruit préféré ?</td>
                    <td>32</td>
                    
                    <td>Les pommes</td>
                    <td>15</td>
                    
                    <td>Les bananes</td>
                    <td>12</td>
                    
                    <td>Les oranges</td>
                    <td>5</td>
                </tr>
                
                <tr>
                    <td>Aimez vous le basket ?</td>
                    <td>25</td>
                    
                    <td>Oui</td>
                    <td>20</td>
                    
                    <td>Non</td>
                    <td>5</td>
                    
                    <td>Peut-être</td>
                    <td>0</td>
                </tr>
                <tr>
                    <td>L'impédance d'un condensateur ?</td>
                    <td>75</td>
                    
                    <td>1/jωC</td>
                    <td>25</td>
                    
                    <td>jωL</td>
                    <td>25</td>
                    
                    <td>jωC</td>
                    <td>25</td>
                </tr>
            </table>
            
            <p>Crééez ces six colonnes dans notre modèle Django.
            
            <pre class="developpement" symbol="models.py"><code>
                class Question(Model):
                    ...
                    choix1 = CharField(max_length=50)
                    choix2 = CharField(max_length=50)
                    choix3 = CharField(max_length=50)
                    votes1 = IntegerField(default=0)
                    votes2 = IntegerField(default=0)
                    votes3 = IntegerField(default=0)
            </code></pre>
            
            <p>Remarquez que j'ai utilisé le paramètre <code class="py">default=0</code> pour dire que lorsque l'on crée une question, si l'on ne spécifie rien, la valeur vaudra zéro.
            
            <p>Après avoir fait la migration en mettant une valeur vide pour les choix, parcourez la base de données pour ajouter des choix possibles à toutes vos questions créées.
                
            <p>Dans notre formulaire de création de question, on devra maintenant ajouter ces trois champs.
            
            <pre class="developpement" symbol=".html"><code>
                À venir
            </code></pre>
            <pre class="developpement" symbol="views.py"><code>
                À venir
            </code></pre>
            
            <!-- <p>How to have different possible answers stored in the db ? -->
            <!-- <p>What would you do on an Excel ? -->
            <!-- <p>→ Columns answer1, answer2, answer3, count1, count2, count3 -->
            <!-- <p>→ It sounds stupid, we'll get to that later (chapter relational databases). -->
            <!-- (3 min) Create the 3 columns with the stupid 1 2 3 names. -->
            
            <h3 id="exerci{{c|s}}e-17">Exerci{{c|s}}e 17{{ |}}: QCM le &lt;form></h3>
            
            <p>On est prêt maintenant à faire un <strong>formulaire de réponse</strong>,
            c'est à dire une page où les utilisateurs pourront répondre à nos questions !
            
            <p>Créez une nouvelle url et afficher les trois choix possibles, pour que l'utilisateur puisse répondre,
                dans un premier temps vous pouvez juste faire un <code class="html">&lt;input type="text"></code> qui
                va contenir 1, 2 ou 3 en fonction du choix voulu (ou un <code class="html">&lt;input type="number"></code> va déjà forcer l'utilisateur à écrire un nombre).
            
            <pre class="developpement" symbol="urls.py"><code>
                À venir
            </code></pre>
            <pre class="developpement" symbol="formulaire_reponse.html"><code>
                À venir
            </code></pre>
            
            <p>Puis créez une url qui va traiter les données, elle va rajouter le vote et augmenter le nombre de répondants de 1.
            
            <pre class="developpement" symbol="urls.py"><code>
                À venir
            </code></pre>
            <pre class="developpement" symbol="views.py"><code>
                À venir
            </code></pre>
            
            <p>Remarquez maintenant que nous avons presque fait le tour des 4 opérations possibles sur une base de donnée :
                <strong>CRUD</strong> (<strong>C</strong>reate, <strong>R</strong>ead, <strong>U</strong>pdate, <strong>D</strong>elete).
            
            <ul>
                <li>On peut <strong>créer</strong> des questions,
                <li>les <strong>lire</strong> pour les afficher sur une page de détail ou sur une page de liste,
                <li>les <strong>modifier</strong> pour compter les votes,
                <li>et il nous manque une manière de les <strong>supprimer</strong> de la base de données.
            </ul>
                
            <p class="comment">Cependant il devient de plus en plus rare qu'on supprime des données car ça permet de faire des statistiques.
                On préférera rajoter un attribut disant que la donnée n'existe plus et puis on ne l'affichera simplement pas dans la liste.
            
            <p>Finalement, peut-être que l'utilisateur trouvera plus utile d'avoir un <code class="html">&lt;input type="radio"></code> comme ceci :
            
            <ul>
                <form>
                <li><input type="radio" name="choix" />Choix 1
                <li><input type="radio" name="choix" />Choix 2
                <li><input type="radio" name="choix" />Choix 3
                </form>
            </ul>
            
            <pre class="developpement" symbol="urls.py"><code>
                À venir
            </code></pre>
            <pre class="developpement" symbol="formulaire_reponse.html"><code>
                À venir
            </code></pre>
            
            <!--
            <p>Form with a single attribute : num answer (people just write 1, 2 or 3 to choose).
            <p>→ A form that will modify the database, the 4 bases of the database: CRUD (Create, Read, Update and Delete).
                Update means modify.
            -->
            <!-- 5 minutes: implement the Answer stuff -->
            
            <!--
            <h3 id="exerci{{c|s}}e-18">Exerci{{c|s}}e 18{{ |}}: Html bonus radio</h3>
            <p>Change html, type=radio
            -->
            
            <h4>Exercices</h4>
            <p>Maintenant que l'on peut répondre aux questions, vous pouvez faire des vues plus intéressantes,
                comme par exemple afficher les questions en triant par nombre de répondants ou autre critères.
            
            <p class="developpement" symbol="Solution">À venir
            
            <!-- <p>Order by répondants don't forget to +1 ! -->
            <p>Vous pouvez également faire une nouvelle page <code class="url">show_answers?numero=4</code>
                qui montrera les résulats du sondage.
                
            <p class="developpement" symbol="Solution">À venir
            
            <p>Pourquoi pas les trier par votes ? Nous verrons qu'avec les bases de données relationnelles, ce sera plus facile.
            
            <p>Actuellement, on montre les résulats du sondage à tout le monde,
                nous avions rajouter un attribut <code>date_de_fin</code>,
                prenez en compte cet attribut dans toutes les vues :
            <ul>
                <li>À la création, demander combien de jours le sondage est ouvert.
                <li>Lorsqu'on répond, vérifier que l'on est bien dans les temps.
                <li>Lorsqu'on affiche une question, montrer les résulats du sondage uniquement si la date de fin est passée.
                <li>On pourrait faire des redirections, si l'on est dans les temps, rediriger vers le formulaire pour répondre.
            </ul>
            <p class="developpement" symbol="Solution">À venir
        </section>
        
        <h2 id="{{bddr|rdb}}">Les bases de données... <em>relationnelles</em></h2>
        
        <section name="{{bddr|rdb}}">
            <button class="open-all-developpement">Cliquez ici pour faire apparaître toutes les corrections et annexes !</button>
            
            <h3 id="exerci{{c|s}}e-18">Exerci{{c|s}}e 18{{ |}}: Foreign key, <em>{{fait le café|the holy grale}}</em></h3>
            <!-- <p class="comment">Cette section est un draft, elle sera modifiée pour être plus compréhensible par les débutants plus tard mais peut déjà être utilisé. -->
            
            <p>Niveau code, on va maintenant créer <strong>plusieurs tables</strong>
                qui vont être liées avec des <code>ForeignKey</code> !
                Par exemple, dans un QCM, chaque <code>Question</code> a une liste de choix, et chaque choix aura un nombre de votes comptabilisés, qui au début vaudra 0.
            
            <pre class="developpement" symbol="models.py"><code>
            class Question(models.Model):
                nom = models.CharField(max_length=50)
                repondants = models.IntegerField()
                
            class Choix(models.Model):
                question = models.ForeignKey(Question)
                texte = models.CharField(max_length=50)
                votes = models.IntegerField(default=0)
            </code></pre>
            
            <p>Si <code class="py">class Choix</code> est définie avant <code class="py">class Question</code>, on devra mettre <code>Question</code> entre guillemets dans la définition :
            
            <pre class="developpement" symbol="models.py"><code>
            class Choix(models.Model):
                question = models.ForeignKey(<mark>"Question"</mark>)
                texte = models.CharField(max_length=50)
                votes = models.IntegerField(default=0)
            
            class Question(models.Model):
                ...
            </code></pre>
            
            <p>Remarquez que j'aurais pu donner un autre nom, comme <code>origine = ForeignKey(Question)</code>
            on parlerait alors de l'<em>origine</em> d'un choix (qui serait une <code>Question</code>),
            j'insiste sur le fait que l'attribut ne doit en aucun cas avoir le même nom que la classe qu'il référencie,
            c'est juste que pour beaucoup de relations, ce choix est naturel.
            
            <p>Grâce aux relations, on aura une base de donnée comme ceci en Excel :
            
            <table>
                <thead>
                    <tr>
                        <th colspan="100">Table Question</th>
                    </tr>
                </thead>
                
                <tr>
                    <th>id</th>
                    <th>nom</th>
                    <th>repondants</th>
                </tr>
                
                <tr>
                    <td>1</td>
                    <td>Quel est votre fruit préféré ?</td>
                    <td>32</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>Aimez vous le basket ?</td>
                    <td>25</td>
                </tr>
                <tr>
                    <td>7</td>
                    <td>L'impédance d'un condensateur ?</td>
                    <td>100</td>
                </tr>
            </table>
            
            <p></p>
            <table>
                <thead>
                    <tr>
                        <th colspan="100">Table Choix</th>
                    </tr>
                </thead>
                
                <tr>
                    <th>question</th>
                    <th>texte</th>
                    <th>votes</th>
                </tr>
                
                <tr>
                    <td>1</td>
                    <td>Les pommes</td>
                    <td>15</td>
                </tr>
                <tr>
                    <td>1</td>
                    <td>Les bananes</td>
                    <td>12</td>
                </tr>
                <tr>
                    <td>1</td>
                    <td>Les oranges</td>
                    <td>5</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>Oui</td>
                    <td>20</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>Non</td>
                    <td>5</td>
                </tr>
                <tr>
                    <td>7</td>
                    <td>1/jωC</td>
                    <td>25</td>
                </tr>
                <tr>
                    <td>7</td>
                    <td>jωL</td>
                    <td>25</td>
                </tr>
                <tr>
                    <td>7</td>
                    <td>jωC</td>
                    <td>25</td>
                </tr>
                <tr>
                    <td>7</td>
                    <td>1/jωL</td>
                    <td>25</td>
                </tr>
            </table>
            
            <p>Et rappelez vous que <strong>Django crée toujours un id</strong> donc la vraie table <code>Choix</code> ressemblera plutôt à ceci :
            
            <table class="developpement" symbol="Table Choix (avec id)">
                <thead>
                    <tr>
                        <th colspan="100">Table Choix</th>
                    </tr>
                </thead>
                
                <tr>
                    <th>id</th>
                    <th>question</th>
                    <th>texte</th>
                    <th>votes</th>
                </tr>
                
                <tr>
                    <td>1</td>
                    <td>1</td>
                    <td>Les pommes</td>
                    <td>15</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>1</td>
                    <td>Les bananes</td>
                    <td>12</td>
                </tr>
                <tr>
                    <td>3</td>
                    <td>1</td>
                    <td>Les oranges</td>
                    <td>5</td>
                </tr>
                <tr>
                    <td>4</td>
                    <td>2</td>
                    <td>Oui</td>
                    <td>20</td>
                </tr>
                <tr>
                    <td>5</td>
                    <td>2</td>
                    <td>Non</td>
                    <td>5</td>
                </tr>
                <tr>
                    <td>11</td>
                    <td>7</td>
                    <td>1/jωC</td>
                    <td>25</td>
                </tr>
                <tr>
                    <td>12</td>
                    <td>7</td>
                    <td>jωL</td>
                    <td>25</td>
                </tr>
                <tr>
                    <td>13</td>
                    <td>7</td>
                    <td>jωC</td>
                    <td>25</td>
                </tr>
                <tr>
                    <td>14</td>
                    <td>7</td>
                    <td>1/jωL</td>
                    <td>25</td>
                </tr>
            </table>
            
            <p>Encore une fois, les id ne sont pas nécessairement consécutifs, par exemple, si l'on a supprimé les questions de 3 à 6.
            <p></p>
            
            <p>Lancez mainteant les <a href="#makemigrations_vs_migrate">opérations de migrations</a> et que voyez vous ?
            
            <p class="developpement"><code>makemigrations</code> se plaint car il manque un paramètre <code>on_delete</code>.
            
            <p>En effet, il manque un attribut <code>on_delete</code>, l'explication est très simple. <strong>Que se passe-t-il si je supprime une Question</strong> ?
            
            <ul>
                <li><code>CASCADE</code> : Tous les choix de la question seront supprimés !</li>
                <li><code>PROTECT</code> : On ne peut pas faire ça si la question a des choix ! Il faut <strong>d'abord</strong> supprimer les choix un à un et <strong>puis</strong> la question pourra être supprimé.</li>
                <li><code>SET_NULL</code> : Les choix de la question supprimée auront mainteant une valeur spéciale <em>ce choix n'a pas de question</em>,
                on dira en SQL que <code class="sql">question_id = NULL</code> ou en python que <code class="py">question = None</code>,
                vous devrez alors rajouter <code class="py">null=True</code> dans la définition.
                <li><code>SET_DEFAULT</code> : Les choix de la question supprimée auront mainteant la valeur par défaut de l'attribut,
                vous devrez alors rajouter <code class="py">default=</code> dans la définition.
            </ul>
            
            <p>En fonction de la situation, on choisira plutôt l'une ou l'autre, ici pour les questions ça me semble logique que l'on veut <code>CASCADE</code> :
            
            <pre class="developpement" symbol="models.py"><code>
            class Choix(models.Model):
                question = models.ForeignKey(Question, <mark>on_delete=models.CASCADE</mark>)
                texte = models.CharField(max_length=50)
                votes = models.IntegerField(default=0)
            </code></pre>
            
            <h4>Utilisation de la relation en python</h4>
            
            <p>Ensuite on peut créer cette relation de manière naturelle :
            
            <pre class="developpement" symbol=".py (créer des objets avec ForeignKey)"><code>
            q = Question()
            q.nom = "Quel est votre fruit préféré ?"
            q.save()
            
            c = Choix()
            c.question = q
            c.texte = "Les bananes"
            c.save()
            
            c = Choix()
            c.question = q
            c.texte = "Les pommes"
            c.save()
            
            c = Choix()
            c.question = q
            c.texte = "Les oranges"
            c.save()
            </code></pre>
            
            <p>Et puis l'utiliser en faisant :
            
            <pre class="developpement" symbol=".py (lire des objets avec ForeignKey)"><code>
            c = Choix.objects.get(id=5)
            q = c<mark>.question</mark>
            print(q.nom, q.repondants)
            print(c.question.nom, c.question.repondants)
            </code></pre>
            
            <p>Comment feriez vous pour obtenir <em>la liste des choix d'une question ?</em>
            
            <pre class="developpement" symbol=".py"><code>
            q = Question.objects.get(id=5)
            L = Choix.objects.filter(question=q)
            </code></pre>
            
            <p>Afin de simplifier ce code, django a également le concept de <em>relation inverse</em> liée au <a href="#related_name"><code>related_name</code></a>,
            par défaut quand l'on lie deux classes, une relation inverse est crée avec le nom de l'autre classe :
            
            <pre class="developpement" symbol=".py (relation inverse choix_set)"><code class="py">
            q = Question.objects.get(id=5)
            L = q.choix_set.all()
            </code></pre>
            
            <p>Ce nom <code>choix_set</code> veut dire <em>l'ensemble des Choix liés à cette Question</em>.
            On peut le suppprimer indiquant <code class="py">related_name='+'</code> dans la définition de la <code>ForeignKey</code>
            ou lui donner un autre nom en écrivant par exemple <code class="py">related_name='liste_choix'</code> qui nous permettera d'écrire :
            <code>q.liste_choix</code>.
            
            <p>Nous verrons que ce <code>related_name</code> devient <a href="#related_name">logiquement obligatoire</a> quand on a plusieurs relations sur les mêmes tables.
            
            <p>Vous pouvez maintenant modifier toutes les vues pour s'adapter à cette nouvelle structure !
                Cela permet d'avoir facilement un nombre différent de choix possibles pour chaque question,
                d'afficher facilement les choix avec une boucle et de
                trier facilement les choix par votes.
                
            <!-- <p>Reponse object ! Base de données relationnelles ! How would you do that in excel ? -->
            <!-- <p>Reponse(name, text, votes) Open sqlite, create some -->
            <!-- <p>Change design: reponse_pk -->
            <!-- <p>How to have the list of all reponse, that belongs to a question 4 ? (filter !) -->
            
            <!-- <p>We have a <span style="color:red">1</span> to <span style="color:blue">N</span> relation because,
                1 Reponse is linked to <span style="color:red">1</span> Question,
                but 1 Question is linked to <span style="color:blue">N</span> Reponse. -->
            <!-- 5 minutes: Reponse Object, Foreign key -->
            
            <div id="django.contrib.auth.models.User"></div>
            <h3 id="exerci{{c|s}}e-19">Exerci{{c|s}}e 19{{ |}}: Login, User, cookies, sessions et réutilisation de code</h3>
            
            <p>Tout site a besoin de gérer des utilisateurs, heureusement vous ne devez pas coder vous même une <code class="py">class User</code> car il est plus malin (et plus <em>secure</em>) d'utiliser du code déjà fait.
            
            <p>Si nous voulons dire qu'une question a un créateur (un <code>User</code>), on réutilisera la <code class="py">class User</code> venant de <code>django.contrib.auth.models</code> :
            
            <pre><code class="py">
            from django.db import models
            <mark>from django.contrib.auth.models import User</mark>
            
            class Question(models.Model):
                nom = models.CharField(max_length=50)
                repondants = models.IntegerField()
                <mark>createur = models.ForeignKey(User, on_delete=models.CASCADE)</mark>
            </code></pre>
            
            <p>La <code class="py">class User</code> contient un attribut obligatoire <code>username</code> utilisé pour la connection ainsi que des attributs classiques comme <code>first_name</code>,
            <code>last_name</code>, <code>email</code> ou encore <code>date_joined</code>.
            
            <p>Pour faire un login, on lira <a href="https://docs.djangoproject.com/fr/2.0/topics/auth/">la documentation officielle</a>,
            spécialement la partie qui parle de <a href="https://docs.djangoproject.com/fr/2.0/topics/auth/default/#auth-web-requests">login et logout</a>.

            <p>À partir d'ici, cette section est en cours d'écriture, donc si vous êtes arrivés jusque ici en guidances, venez me voir (Robert Vanden Eynde sur facebook) et je vous raconterai l'essentiel !
            
            <div class="developpement" symbol="Cette section est un Brouillon">
            <p>Pour le login, il faut réutiliser du code fait par d'autres : <code>django.auth.User</code></h3>
            <p>Users, login, cookies, hashpassword → use code from others ! Here <code>django.contrib.auth</code> (look at <a href="https://github.com/django/django/blob/master/django/contrib/auth/models.py#L288">source code</a>, almost a super simple class)
            <p>Create users from the admin, or <code>class User</code> (<code class="py">from django.contrib.auth.models import User</code>)
            <p>Cookie, django does use auth cookies. See source code.
            <p>Cookies in the browser : look at ctrl shift I, private browsing
            <p>New user form, username, email, (send email saying hello !), password is hashed !
            (See db, or shell), verify there is a <code>@</code> in the email.
            <!-- 5 minutes: new user form -->
            </div>
            
            <h3 id="exerci{{c|s}}e-20">Exerci{{c|s}}e 20{{ |}}: Profile, Foreign key to other class</h3>
            <div class="developpement" symbol="Cette section est un Brouillon">
            <p>Profile : Foreign key to User, add stuffs like, phone number, color preferences, anything relevant to your app.
            <p>Boolean, creator, can create questions, or builtin is_staff, can connect to the admin.
            <!-- 3 minutes: foreign key for Profile -->
            <p>→ There is also this programming concept called Inheritance (Héritage),
                that will just create a foreign key but new attributes are available without <code>.profile</code>. 
            </div>
            
            <h3 id="exerci{{c|s}}e-21">Exerci{{c|s}}e 21{{ |}}: N to N relations</h3>
            <div class="developpement" symbol="Cette section est un Brouillon">
            <p>The relation <em>User has answered Question</em>, or <em>Answered</em> is a N to N relation !
                1 User has answered N Question.
                And 1 Question can be modified by N Users.
                Or 1 Question has a list of modifiers.
                And 1 User has a list of Questions she can modify.
            <p>How would you do that in Excel ?
            <!-- 3 minutes, N to N relation -->
            </div>
            
            <h3 id="exerci{{c|s}}e-22">Exerci{{c|s}}e 22{{ |}}: N to N relations through a model</h3>
            <div class="developpement" symbol="Cette section est un Brouillon">
            <p>N to N relationship are not <em>fundamental</em> because they are just two N-1 1-N relations.
                Indeed, when we say <em>we have a N to N relationship Answered between Users and Questions</em> or
                <em>A user has a list of (answered) Questions and a Question has a list of (answered) Users</em>...
                Is a shortcut for saying <em>A user has a list of Answer, an Answer has one Question</em> and 
                <em>A Question has a list of Answers, an Answer has one User</em>.
            <p>N to N relationship <strong>through</strong> model (here Answer).
            <p>Can add arbitrary stuffs like <em>this user has answered this question... on this date</em>.
            <!-- 3 minutes, through -->
            </div>
            
            <div id="related_name"></div>
            <h3 id="exerci{{c|s}}e-23">Exerci{{c|s}}e 23{{ |}}: related_name, multiple FK and self FK</h3>
            
            <p>{{Imaginons qu'on a des modèles comme ceux-ci :|Given models like this :}}
            
            <pre><code class="py">
                class {{Etudiant|Student}}(Model):
                    ...
                    
                class Message(Model):
                    {{etudiant|student}} = ForeignKey(Student)
                    likes = IntegerField()
            </code></pre>
            
            <p>
                {{Comment faire pour obtenir tous les messages d'un certain étudiant <code>s</code> ?
                | How to get all the messages of a selected student <code>s</code> ? }}
                {{ Ou juste ceux qui ont au moins 10 likes ?
                | Or only the ones that had at least 10 likes ?}} 
            
            <pre><code class="py">
                s = {{Etudiant|Student}}.objects.get(id=5)
                Message.objects.filter({{etudiant|student}}=5) # {{tous|all}}
                Message.objects.filter({{etudiant|student}}=5).filter(likes__gte=10) # {{au moins|at least}} 10 likes
            </code></pre>
            
            <p>{{Django nous permet également d'utiliser la relation inverse, en utilisant <code>s.message_set</code> :
                |Django also allow us to use reverse relationship, using <code>s.message_set</code> : }}
            
            <pre><code class="py">
                s = {{Etudiant|Student}}.objects.get(id=5)
                s.message_set.all() # {{tous|all}}
                s.message_set.filter(likes__gte=10) # {{au moins|at least}} 10 likes
            </code></pre>
            
            <p>{{Ce que nous pourrions traduire par <em>Donne moi l'ensemble des messages de cet étudiant</em>.
                | That would be translated to <em>Give me the set of all the messages of that student</em>. }}
            
            <p>{{Django a choisit le nom <code>message_set</code> par défaut en se basant sur le nom de la <code class="py">class Message</code>,
                <em>set</em> se traduit par <em>ensemble</em> en français, <code>message_set</code> se traduit donc par <em>l'ensemble des messages</em>.
                | Django chose the name <code>message_set</code> as a default name based on the name of the <code class="py">class Message</code>. }}
            
            <p>{{Si l'on ne veut pas que cette <em>relation inverse</em> soit créée, on peut écrire <code class="py">related_name='+'</code> dans le modèle.
                | If one doesn't want this <em>reverse relationship</em> to be created, one can write <code class="py">related_name='+'</code> in the model. }}
            
            <pre><code class="py">
                class Message(Model):
                    {{etudiant|student}} = ForeignKey({{Etudiant|Student}}, <mark>related_name='+'</mark>)
                    likes = IntegerField()
            </code></pre>
            
            <p>{{Dans ce cas|In that case}} <code>s.message_set</code> {{lancerait une exception|would raise an exception}}.
            
            <p>{{Si l'on veut changer le nom de cette <em>relation inverse</em>, on peut écrire <code class="py">related_name='...'</code> dans le modèle.
                | If one want to change the name of this <em>reverse relationship</em>, one can write <code class="py">related_name='...'</code> in the model. }}
            
            <pre><code class="py">
                class Message(Model):
                    {{etudiant|student}} = ForeignKey({{Etudiant|Student}}, <mark>related_name='{{liste_message|message_list}}'</mark>)
                    likes = IntegerField()
            </code></pre>
            
            <p>{{ On lira :
                | We'll read : }}
                
            <ol>
                {{
                <li><strong>Un</strong> <code>Message</code> a un <code>etudiant</code> qui est un <code>Etudiant</code>.
                <li><strong>Un</strong> <code>Etudiant</code> a une <code>liste_message</code> qui sont des <code>Message</code>.
                |
                <li><strong>One</strong> <code>Message</code> has a <code>student</code> who is a <code>Student</code>.
                <li><strong>One</strong> <code>Student</code> has a <code>message_list</code> containing <code>Message</code>.
                }}
            </ol>
            
            <p>{{Cette relation peut ensuite être utilisée :|This relation can then be used :}}
            
            <pre><code class="py">
                s = {{Etudiant|Student}}.objects.get(id=5)
                s<mark>.{{liste_message|message_list}}</mark>.filter(likes__gte=10)
            </code></pre>
            
            <p>{{ Si l'on veut utiliser plusieurs fois une relation entre les mêmes modèles, comme ici :
                | If one uses multiple times a relation between the same models, like here : }}
            
            <pre><code class="py">
                class {{Etudiant|Student}}(Model):
                    ...
                
                class Message(Model):
                    {{envoyeur|sender}} = ForeignKey({{Etudiant|Student}})
                    {{receveur|receiver}} = ForeignKey({{Etudiant|Student}})
            </code></pre>
            
            <p>{{Django se plaindra, car ça n'aurait pas beaucoup de sens de demander <em>Donne moi tous les messages de cet étudiant</em>.
                | Django will complain, because what would it mean <em>Give the set of all messages of that student</em>. }}
                
                {{Qu'est ce que <code>message_set</code> voudrait dire sur un étudiant ?
                Tous les messages qu'il a envoyé, qu'il a reçu, ou les deux ?
                | What would <code>message_set</code> mean on a student ?
                All the messages he sent, he received, or both? }}
            
            <p>{{ Dans ce cas on devra alors mettre les deux relations à <code>related_name='+'</code> ou bien les nommer comme par exemple :
                | In that case one would have to set both the relations <code>related_name='+'</code> or some names like : }}
            
            <pre><code class="py">
                class {{Etudiant|Student}}(Model):
                    ...
                
                class Message(Model):
                    {{envoyeur|sender}} = ForeignKey({{Etudiant|Student}}, related_name='{{liste_message_en_envoyeur|message_list_as_sender}}')
                    {{receveur|receiver}} = ForeignKey({{Etudiant|Student}}, related_name='{{liste_message_en_receiver|message_list_as_receiver}}')
            </code></pre>
            
            <p>On lira donc :
            
            <ol>
                {{
                <li><strong>Un</strong> <code>Message</code> a un <code>envoyeur</code> qui est un <code>Etudiant</code>.
                <li><strong>Un</strong> <code>Etudiant</code> a une <code>liste_message_en_envoyeur</code> sont des <code>Message</code>.
                |
                <li><strong>One</strong> <code>Message</code> has a <code>sender</code> who is a <code>Student</code>.
                <li><strong>One</strong> <code>Student</code> has a <code>message_list_as_sender</code> containing <code>Message</code>.
                }}
            </ol>
            
            <p>{{On pourrait alors écrire :|One could then write :}}
            
            <pre><code class="py">
                s = {{Etudiant|Student}}.objects.get(id=5)
                
                A = Message.objects.filter({{envoyeur|sender}}=s)
                A = s.{{liste_message_en_envoyeur|message_list_as_sender}}.all() # {{raccourci|shortcut}}
                
                B = Message.objects.filter({{receveur|receiver}}=s)
                B = s.{{liste_message_en_receiver|message_list_as_receiver}}.all() # {{raccourci|shortcut}}
            </code></pre>
            
            {{ <p class="comments">En anglais j'aurais choisi <code>message_list_as_sender</code> et <code>message_list_as_receiver</code>. | }}
            
            <p class="comments">
                {{ Remarquons que dans notre contexte, <code class="py">'messages_envoyés'</code> serait peut être un meilleur
                nom que <code class="py">'liste_message_en_envoyeur'</code>.
                | Let's notice that in our context, <code class="py">'messages_sent'</code> could be 
                a better name than <code class="py">'message_list_as_sender'</code>. }}
            
            <p>{{ Finalement, imaginons que l'on veut une <code>ForeignKey</code>
                  de la classe vers <strong>la même classe</strong> ?
                | Finally, what if we want a <code>ForeignKey</code>
                  from the class to <strong>the same class</strong> ? }}
                
                {{ Par exemple, chaque <code>Etudiant</code> peut avoir (ou non) un <code>tuteur</code>, qui est également un <code>Etudiant</code>.
                On doit alors utiliser la définition des <code>ForeignKey</code> avec les guillemets :
                | For example, each Student may (or may not) have a <code>tutor</code>, who is also a <code>Student</code>.
                One must use the quoted version of the <code>ForeignKey</code> : }}
            
            <pre><code class="py">
                class {{Etudiant|Student}}(Model):
                    {{tuteur|tutor}} = ForeignKey('{{Etudiant|Student}}', null=True)
            </code></pre>
            
            <p>{{ Pour des raisons évidentes, l'attribut doit être <em>nullable</em> (<code class="py">null=True</code>),
                  ce qui veut dire ici qu'il est possible qu'un étudiant n'aie pas de tuteur (on dira alors en python que <code class="py">tuteur is None</code>, et en sql on dira que <code class="sql">tuteur is NULL</code>).
                | For obvious reasons, the attribute must be nullable (<code class="py">null=True</code>),
                  which means here that it's possible for a student to not have any tutor (we'll then say in python that <code class="py">tutor is None</code>), and in sql we'll say that <code class="sql">tuteur is NULL</code>). }}
            
            <p>
            {{ Dans ce cas, il existe aussi un raccourci, <code class="py">'self'</code> :
            | In that case, there is also a shortcut, <code class="py">'self'</code> : }}
            
            <pre><code class="py">
                class {{Etudiant|Student}}(Model):
                    {{tuteur|tutor}} = ForeignKey('self', null=True)
            </code></pre>
            
            <h3 id="exerci{{c|s}}e-24">Exerci{{c|s}}e 24{{ |}}: Cookies et sessions</h3>
            
            <p>Le login de django utilise des <em>cookies</em> et des <em>sessions</em>, cette section expliquera en détail ce que sont ces deux concepts.
            
            <div class="developpement" symbol="Cette section est un Brouillon">
            </div>
            
        </section>
    </div>
    </body>
</html>
