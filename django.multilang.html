<!DOCTYPE html>
<html lang="{{fr|en}}">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" /> 
        <link href="django.png" rel="icon" type="image/png" />
        <title>Apprenez à programmer un site web avec Django !</title>
        
        <meta property="og:image" content="https://robertvandeneynde.be/parascolaire/django.png" />
        <meta property="og:description" content="Apprenez à programmer un site web avec Django" />
        <!-- <meta property="og:url" content="" /> -->
        <meta property="og:title" content="Apprenez à programmer un site web avec Django" />
        <meta property="og:type"   content="article" /> 
        
        <link rel="stylesheet" type="text/css" href="base.css" />
        <script src="https://code.jquery.com/jquery-2.1.4.js"></script>
        <script src="animations.js"></script>
        <script src="utils.js"></script>
        <script src="slides.js"></script>
        <style>
            body {
                background: url('diamond.jpg');
                background-size: 400px;
            }
            img:not(.free), pre {
                max-width: 100%;
            }
            pre {
                overflow-x: auto;
                border: 1px solid #ccc;
            }
            figcaption:not(.mandatory) {
                display: none;
            }
            p > code {
                display: inline;
            }
            :not(pre) > code {
                border: 1px solid #ccc;
                display: inline-block;
                padding: 2px;
            }
            table {
                border-collapse: collapse;
            }
            table td, table th {
                border: 1px solid #ddd;
                padding: 5px;
            }
            kbd {
                border: 1px solid #ccc;
                display: inline-block;
                padding: 2px;
                font-family: serif;
                border-radius: 5px;
                background: white;
            }
            table.shortcuts > tbody > tr > td:first-child {
                text-align: center;
                min-width: 160px;
            }
            table.shortcuts em {
                font-style: normal;
            }
            tr {
                background-color: rgb(252, 252, 255);
            }
            tr.interesting-row {
                background: rgb(255, 251, 221); /* rgb(255, 250, 240); */
            }
            .slide.next {
                cursor: pointer;
            }
            p.comment {
                font-style: italic;
                margin-left: 20px;
            }
        </style>
        
        <link id="stylesheet" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/default.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/highlight.min.js"></script>
        <script>
        $(function(){
            var DEFAULT_SYMBOL = '{{Solution|Solution}}';
            $('.developpement').each(function(){
                var self = $(this)
                var state = true
                self.hide().before(
                    $('<button>').text(
                        (self.attr('symbol') == 'iff' ? '⇔' : self.attr('symbol') != null ? self.attr('symbol') : DEFAULT_SYMBOL)
                        + ' ... '
                        + (self.attr('symbolpost') == 'iff' ? '⇔' : self.attr('symbolpost') != null ? self.attr('symbolpost') : '')
                    ).click(function(){
                        $(this).hide()
                        self.fadeIn(1500)
                    })
                )
            })
        });
        </script>
        <script>
            $(function(){
                utils.dedentPreCode()
                var COMMENT_ELEM = [
                    ['py', ['# ', '']],
                    ['html', ['&lt;!-- ', ' -->']],
                ]
                
                function forEachComment(callback) {
                    for(var i = 0; i < COMMENT_ELEM.length; i++)
                        callback(COMMENT_ELEM[i][0], COMMENT_ELEM[i][1])
                }
                
                $('pre.developpement').each(function(){
                    var pre = $(this)
                    var code = pre.find('code')
                    
                    if(! code.attr('class')) {
                        forEachComment(function(k, l) {
                            if(pre.attr('symbol').indexOf('.' + k) != -1)
                                code.addClass(k)
                        })
                    }
                    
                    forEachComment(function(k, l) {
                        if(code.hasClass(k))
                            code.html(l[0] + pre.attr('symbol') + l[1] + '\n\n' + $(code).html())
                    })
                })
                
                hljs.initHighlightingOnLoad()
                // $('p > code[class]').each(function(i, block) {
                //     hljs.highlightBlock(block);
                // });
                utils.makeTitleLinks()
                utils.smoothLinks()
                
                function replaceUrls(hostname) {
                    $('code.url').each(function(){
                        if(! $(this).data('base-url')) {
                            var path = $(this).text()
                            $(this).data('base-url', path)
                            $(this).wrap('<a>')
                        } else {
                            var path = $(this).data('base-url')
                        }
                        
                        if(path.indexOf('127.0.0.1:8000') != -1) {
                            var url = path.replace('127.0.0.1:8000', hostname)
                            $(this).text(url);
                        } else {
                            var url = hostname + path
                        }
                        
                        $(this).parent().attr('href', 'http://' + url)
                    })
                }
                
                replaceUrls('127.0.0.1:8000')
                
                $('#group_selector_ok').click(function() {
                    var s = $('#group_selector').val()
                    var m = /^infosgr(\d+)$/.exec(s.toLowerCase().trim()) || /^(\d+)$/.exec(s.toLowerCase().trim())
                    if(!m)
                        alert('Veuillez indiquer un numéro')
                    var n = parseInt(m[1])
                    replaceUrls('infosgr' + n + '.pythonanywhere.com')
                    
                    $('#group_selector_saved').text( $('#group_selector_saved').text().replace('{n}', n) ).show()
                    
                    setTimeout(function(){
                        $('#group_selector_saved').fadeOut();
                    }, 3000);
                })
                
                $('#group_selector').on('keyup', function(ev){
                    if(ev.keyCode == 13) {
                        $('#group_selector_ok').trigger('click')
                        ev.target.blur()
                    }
                })
                
                $('#group_selector_saved').hide()
                
                $('#group_selector_saved').click(function(){
                    $(this).fadeOut()
                })
            })
        </script>
    </head>
    <body class="algos">
    <div id="wrapper">
        <h1><!-- class="nocontent"
            --><a class="homeicon" href="index.html"></a><!--
            --><span class="text">Apprenez à programmer un site web avec Django</span><!--
        --></h1>
        <section>
            <p>Dans ce tutoriel, nous ferons un site de sondage, appelé <code>askme</code>, c'est une version simplifiée du <a href="https://docs.djangoproject.com/en/2.0/intro/tutorial01/">tutoriel django officiel</a>.</p>
            <ul>
                <li>Créer une question.</li>
                <li>Voir la liste des questions et cliquer dessus pour la voir en détail.</li>
                <li>Avoir les réponses possibles à une question en cas de choix multiple.</li>
                <li>Répondre à une question.</li>
                <li>Voir les résultats d'une question.</li>
                <li>Bien séparer les questions par <em>catégories</em> (Sport, Sciences, Culture).</li>
                <li>Ne voir que les résultats quand la date de fin est passée.</li>
                <li>Limiter la création des questions aux administrateurs.</li>
            </ul>
            <p>Une petite connaissance préalable de python est conseillée, vous pouvez avoir un petit rappel de théorie sur mon site
                <a href="https://robertvandeneynde.be/parascolaire">de programmation pour débutants</a> :
            
            <ol>
                <li>Cliquez sur le petit fichier
                    <a href="https://robertvandeneynde.be/parascolaire/theorie1_egal_if_fr.html">
                        theorie1
                    </a>
                    qui tient sur deux pages, ou sa <a href="https://robertvandeneynde.be/clipedia/structure-variables-conditions.mp4">vidéo en bêta</a> !
                    
                    Essayez de faire les exercices 0, 1, 2, 3, voire 4.
                    
                <li>Ensuite lisez le fichier
                    <a href="https://robertvandeneynde.be/parascolaire/theorie2_liste_while.html">
                        theorie2
                    </a> qui tient aussi sur deux pages,
                    
                    essayez de faire au moins l'exercice 5, mais vous pouvez tenter les 6, 7, 8, 9.
                    
                <li>Finalement si vous êtes chaud, lisez le fichier
                    
                    <a href="https://robertvandeneynde.be/parascolaire/theorie3_fonctions_et_objets.html">
                        theorie3
                    </a> qui tient peut-être sur plus de deux pages.
                        
                <li>Et si vous êtes encore plus chaud, vous pouvez même lire les parties <em>Pour en savoir plus</em>
                    ou bien mes fichiers dont les noms commencent par <a href="https://robertvandeneynde.be/parascolaire/#progra">progra</a> !
            </ol>
        </section>
        
        <nav>
            <a href="django.{{en|fr}}.html"><img src="flag-{{en|fr}}.png" /></a>
        </nav>
        
        <nav>
            <a href="#site-statique">Site statique</a>
            <a href="#bdd">Lire une base de données</a>
            <a href="#form">Formulaires</a>
            <a href="#bddr">Bases de données <em>relationnelles</em></a>
        </nav>
        
        <h2 id="site-statique">Un site statique</h2>
        
        <section name="site-statique">
        
            <p class="lang-switch"><a href="django.{{en|fr}}.html" lang="{{en|fr}}" hreflang="{{en|fr}}"><img style="vertical-align:middle; margin-right: 5px;" src="flag-{{en|fr}}.png"/>{{English here!|Français ici !}}</a>
            
            <p>Bienvenue dans le tutoriel django, voici une liste d'exercice à faire pour bien comprendre les concepts de base de django !
            
            <p class="comment">Les paragraphes en italique indiquent une information complémentaire non nécessaire pour la compréhesion du cours et la réussite du stage, bien entendu, ça peut toujours aider.
            
            <p>Lors de mes présentations, j'ai parlé du protocole http, et de la communication entre client et serveur qui ressemblait à un envoi de lettres postales.
            Maintenant, place au code django !
            
            <p class="comment">Créez un projet django vide, si vous avez du mal, demandez à vos voisins,
                si vous êtes à Solvay, j'ai les mot de passes des machines virtuelles de décembre si vous les avez oubliés.
            
            <p class="comment">Essayez de faire les exercices. Ensuite, si vous n'arrivez pas, regardez la solution en cliquant sur les boutons !
            Si nous n'arrivez pas à faire un exercice, pas de panique, la correction est là pour vous aider et probablement que vous comprendrez mieux lors d'un exercice ultérieur.
            
            <p>Dernière petite remarque : Django est <strong>vaste</strong>, il permet souvent de faire une chose de <strong>beaucoup de manières différentes</strong>,
                ici je me concentre sur les fonctionnalités que je juge <strong>fondamentales</strong>, indispensables pour la création d'un site web.
            
            <!-- Concept d'enveloppe, headers, communication client serveur, poste = ip, address = addresse ip -->
            
            <h3 id="exerci{{c|s}}e-1">Exerci{{c|s}}e 1{{ |}}: Les urls et les vues</h3>
            
            <p>Lancez le serveur.
            
            <p class="comment">
                Pour faire cela, si vous êtes en sciences éco c'est déjà configuré et vous devez juste cliquer sur <em>Reload</em> dans l'onglet <em>Web</em> de pythonanywhere.
            
            <p class="comment">
                Pour faire cela au stage de Solvay, allez dans Eclipse et faites <em>Run as > Django application</em>
                ou via le terminal comme un pro <code class="bash">python3 manage.py runserserver</code>.
                
            <p>Que se passe-t-il quand je vais sur <code class="url">127.0.0.1:8000/</code> ?
                
            <p class="comment" style="line-height:2em;">Si vous êtes en sciences éco, vous devrez plutôt aller sur <code>infosgr42.pythonanywhere.com/</code>
                où <code>42</code> est le numéro de votre groupe,
                entrez votre numéro de groupe ici : <input type="int" placeholder="42" style="width:60px; text-align:center;" id="group_selector"/>
                puis cliquez sur <button id="group_selector_ok">Ok</button> pour mettre à jour la page.
                
                <span id="group_selector_saved" style="border: 1px solid #0c0; background: #090; color: white; padding: 5px;">Page mise à jour pour le groupe {n} !</span>
            
            <p class="developpement">Il est marqué It works.
            
            <p>Et quand je vais sur <code class="url">/hello</code> ?
            
            <p class="developpement">Erreur 404, et on voit la liste des urls disponibles, il n'y a que <code>admin</code>
            
            <p>Faites une page <code class="url">/hello</code> et une page <code class="url">/cv</code>,
                celles-ci ne contiennent que les textes suivants :
                
            <ul>
                <li><em>Coucou les amis !</em> 
                <li><em>Cv de René: Surfeur, programmeur mais humain avant tout</em>
            </ul>
            
            <pre class="developpement" symbol="urls.py (django 2.0)"><code class="py">
            from django.conf.urls import path

            from . import views

            urlpatterns = [
                path('hello/', views.dire_bonjour), # NEW
                path('cv/', views.montrer_cv),      # NEW
            ]
            </code></pre>
            
            <pre class="developpement" symbol="urls.py (django 1.11)"><code class="py">
            from django.conf.urls import url

            from . import views

            urlpatterns = [
                url(r'^hello/$', views.dire_bonjour), # NEW
                url(r'^cv/$', views.montrer_cv),      # NEW
            ]
            </code></pre>
            
            <pre class="developpement" symbol="views.py"><code class="py">
            from django.http import HttpResponse
            
            def dire_bonjour(request):
                return HttpResponse("Coucou les amis !")

            def montrer_cv(request):
                return HttpResponse("Cv de René: Surfeur, programmeur mais humain avant tout")
            </code></pre>
            
            <p class="comment">Si vous êtes en sciences éco, vous utilisez django 2.0, au stage de Solvay, c'était django 1.11.
            
            <p class="comment">Pour le projet de sciences éco, vous n'avez pas un
                <strong>fichier</strong> <code class="bash">views.py</code>
                mais vous avez un <strong>dossier</strong> <code class="bash">views/</code>,
                n'hésitez pas à créer un <strong>fichier</strong> <code class="bash">views.py</code> à côté du dossier pour suivre ce tutoriel.
                
                Ou bien vous pouvez créer un (ou plusieurs) fichier(s) <code class="bash">.py</code> dans le dossier <code class="bash">views/</code>,
                comme par exemple <code>base.py</code>, vous devrez alors écrire <code class="bash">urls.py</code> comme ceci  :
            
            <pre class="developpement" symbol="urls.py (django 2.0 avec dossier views)"><code class="py">
            from django.conf.urls import path

            from . import views
            <mark>from .views import base</mark>

            urlpatterns = [
                path('hello/', views<mark>.base</mark>.dire_bonjour), # NEW
                path('cv/', views<mark>.base</mark>.montrer_cv),      # NEW
            ]
            </code></pre>
            
            <pre class="developpement" symbol="views/base.py (django 2.0 avec dossier views)"><code class="py">
            from django.http import HttpResponse
            
            def dire_bonjour(request):
                return HttpResponse("Coucou les amis !")

            def montrer_cv(request):
                return HttpResponse("Cv de René: Surfeur, programmeur mais humain avant tout")
            </code></pre>
            
            <p>Remarquez que j'aurais également pu appeler mes fonctions <code class="py">hello</code> et <code class="py">cv</code>
                en écrivant <code class="py">def hello(request)</code> et <code class="py">def cv(request)</code> dans <code class="bash">views.py</code>
                pour que chaque fonction aie le même nom que son url, mais j'ai préféré faire la différence.
            
            <p>Que se passe-t-il maintenant quand je vais sur <code class="url">/hello</code> et <code class="url">/cv</code> ?
            
            <p>Et quand je vais sur <code class="url">/superapp</code> ?
            
            <p class="developpement">Une erreur 404
            
            <h3 id="exerci{{c|s}}e-2">Exerci{{c|s}}e 2{{ |}}: Du html !</h3>
            
            <p>Comment mettre par exemple <em>René</em> en <strong>gras</strong> ?
            
            <pre class="developpement" symbol="views.py"><code>
            from django.http import HttpResponse

            def dire_bonjour(request):
                return HttpResponse("Coucou les amis !")
        
            def montrer_cv(request):
                return HttpResponse("Cv de &lt;strong>René&lt;/strong>: Surfeur, programmeur mais humain avant tout")
            </code></pre>
            
            <p class="comment">Remarquez maintenant qu'il y a une différence entre ce qu'on a envoyé (le code html) et ce qui est affiché à l'utilisateur par le navigateur (la page).
                Faites un clic droit sur la page et cliquez sur <strong>Afficher la Source</strong> (sous google chrome ou firefox, c'est également Ctrl+U ou Cmd+U sous Mac).
                Vous verrez le html qu'on a envoyé.
            
            <p>Et comment lister ses compétences dans une liste comme celle-ci :
            
            <ul>
                <li>Surfeur
                <li>Programmeur
                <li>Humain avant tout
            </ul>
            
            <pre class="developpement" symbol="views.py"><code class="py">
            def montrer_cv(request):
                return HttpResponse("Cv de &lt;strong>René&lt;/strong>: &lt;ul> &lt;li>Surfeur&lt;/li> &lt;li>Programmeur&lt;/li> &lt;li>Mais humain avant tout&lt;/li> &lt;/ul>")
            </code></pre>
            
            <p>Le fichier contient donc maintenant deux fonctions, <code>dire_bonjour</code> et <code>montrer_cv</code>, on peut en créer autant que l'on veut.
            
            <h3 id="exerci{{c|s}}e-3">Exerci{{c|s}}e 3{{ |}}: Un template pour René</h3>
            
            <p>Cela devient un peu confus de mettre des données dans le code python, et en plus les accents peuvent parfois s'afficher mal !
            Comment faire un document html séparé ?
            
            <pre class="developpement" symbol="views.py"><code class="py">
            from django.shortcuts import render
            
            def montrer_cv(request):
                return render(request, 'le_cv.html')
            </code></pre>
            
            <pre class="developpement" symbol="le_cv.html"><code class="html">
            &lt;html>
                &lt;head>
                    &lt;meta charset="utf-8"/>
                    &lt;title>René le magnifique&lt;/title>
                &lt;/head>
                &lt;body>
                    &lt;p>Cv de &lt;strong>René&lt;/strong>&lt;/p>
                    &lt;ul>
                        &lt;li>Surfeur&lt;/li>
                        &lt;li>Programmeur&lt;/li>
                        &lt;li>Mais humain avant tout&lt;/li>
                    &lt;/ul>
                &lt;/body>
            &lt;/html>
            </code></pre>
            
            <p>Attention à ce que le fichier html soit dans le dossier <code>templates</code> et
            que vous ayez rajouté le nom de l'app dans <code>INSTALLED_APP</code> du fichier <code>settings.py</code>
            
            <p>Où est passé le texte <em>René le magnifique</em> dans mon exemple ? Regardez bien partout !
            
            <p>Et comment faire une présentation avec des titres de niveau 1 et 2 ? Et des paragraphes ?
            
            <pre class="developpement" symbol="le_cv.html"><code class="html">
            &lt;html>
                &lt;head>
                    ...
                &lt;/head>
                &lt;body>
                    &lt;h1>Cv de René&lt;/h1>
                    &lt;p>René est un expert depuis le début de sa vie&lt;/p>
                    &lt;p>Il a rencontré Chuck Norris et a compté jusqu'à l'infini avec lui, deux fois&lt;/p>
                    
                    &lt;h2>Compétences incroyables&lt;/h2>
                    &lt;ul>
                        &lt;li>Surfeur&lt;/li>
                        &lt;li>Programmeur&lt;/li>
                        &lt;li>Mais humain avant tout&lt;/li>
                    &lt;/ul>
                    
                    &lt;h2>Parcours international&lt;/h2>
                    &lt;p>René connaît le Cyrrilique et aime beaucoup les lettres &lt;strong>и&lt;/strong> et &lt;strong>ю&lt;/strong>&lt;/p>
                    &lt;p>Il adore également parler des angles avec des θ et des φ&lt;/p>
                &lt;/body>
            &lt;/html>
            </code></pre>
            
            <p class="comment">Toute cette structure peut être retrouvée en ouvrant les <em>outils de développement</em>, faites un clic droit puis inspecter ou sous google chrome et firefox Ctrl+Shift+I ou Cmd+Shift+I sous Mac.
                Vous pouvez ensuite balader votre souris pour voir les correspondances entre le html et les blocs.
            
            <p>Finalement, on aimerait que tous les <strong>paragraphes</strong> soient en <span class="color:blue">bleus</span>, on a besoin de CSS !
            
            <pre class="developpement" symbol="le_cv.html"><code class="html">
            &lt;html>
                &lt;head>
                    &lt;meta charset="utf-8"/>
                    &lt;title>René le magnifique&lt;/title>
                    &lt;style>
                    p {
                        color: blue;
                    }
                    &lt;/style>
                &lt;/head>
                &lt;body>
                    ...
                &lt;/body>
            &lt;/html>
            </code></pre>
            
            <p>Remarquez que vous pouvez nommer votre fichier html comme vous le voulez, même si c'est le même nom que les fonctions ou les urls.
            
            <p>Finalement, faites un petit lien vers notre autre page à l'url <code class="url">/hello</code> !
            
            <pre class="developpement" symbol="le_cv.html"><code class="html">
            &lt;p>Allez voir ma gentille page &lt;a href="/hello">ici&lt;/a> et j'espère que je vous ferai sourire !&lt;/p>
            </code></pre>
            
            <p>Pour en savoir plus sur l'html et le css, direction le très bon
                <a href="https://openclassrooms.com/courses/apprenez-a-creer-votre-site-web-avec-html5-et-css3/comment-fait-on-pour-creer-des-sites-web">
                    tutoriel html et css
                </a>
                sur openclassrooms.
            
                En une ou deux heures vous aurez déjà de quoi faire un <strong>joli</strong> site web !
                En effet, avec beaucoup de css, René pourrait arriver à un cv comme <a href="https://robertvandeneynde.be/cv">celui-ci</a>.
            
            <p>Avoir un joli site c'est bien, mais avoir un site <strong>fonctionnel</strong> c'est peut-être bien aussi !
                Rendez-vous dans la suite du tutoriel.

            <h3 id="{{raccourcis|shortcuts}}">Raccourcis clavier</h3>

            <p>À partir du moment où vous écrivez beaucoup de texte, lisez au moins mon petit tableau des <a href="turtle.{{fr|en}}.html#{{raccourcis|shortcuts}}">raccourcis basiques</a> !
            
        </section>
        
        <h2 id="bdd">Lire la base de données via un modèle Django</h2>
        
        <section name="bdd">
            <p>Nous allons maintenant faire un site web dynamique, 
                le site web statique est un serveur qui fait toujours la même chose :
                
            <ul>
                <li>Attendre une requête http.
                <li>Lire l'url comme <code class="url">/hello</code>.
                <li>Voir s'il existe un fichier appelé <code>hello</code>.
                <li>Si le fichier n'existe pas, renvoyer une 404 Not Found (status = 404).
                <li>Sinon, renvoyer le contenu du fichier (status = 200).
            </ul>
            
            <p>Un site dynamique...
            <ul>
                <li>attendra toujours des requêtes http (car c'est toujours un serveur http),
                <li>lira toujours l'url (car c'est toujours un serveur http),
                <li><strong>mais</strong> à la place de <em>prendre simplement un fichier et le donner</em>,
                <li>il va appeler du <strong>code</strong> (ici du code écrit en <em>python</em>).
                <li>Le code permet de faire strictement tout et n'importe quoi (comme faire un calcul).
                <li>Et finalement, étant un serveur http, il renverra quand même une réponse texte (ou html) avec un status (200 ou 404 par exemple).
            </ul>
            
            <p>On dira donc que la différence est que la réponse sera <strong>générée</strong>.
            
            <p>Généralement, on lira du contenu dans une <strong>base de donnée</strong> et on renverra du html qui <strong>dépend</strong> du contenu de celle-ci.
            
            <h3 id="exerci{{c|s}}e-4">Exerci{{c|s}}e 4{{ |}}: Une question</h3>
            <p>Pour notre site de sondage, créez une <code>class Question</code> qui a deux <em>attributs</em> :
            <ul>
                <li><code>nom</code>: le nom de la question, comme <em>Quel est votre fruit préféré ?</em>
                <li><code>repondants</code>: le nombre de personnes ayant répondu à cette question (qui sera initialement de zéro mais augmentera).
            </ul>
            
            <pre class="developpement" symbol="models.py"><code class="py normal-comments">
            from django.db import models # on a besoin du concept django de <em>modèle</em>
            
            class Question(models.Model): # cette classe est un modèle django et non une simple classe Python
                nom = models.CharField(max_length=50) # cet attribut est du texte (<em>Character Field</em>)
                repondants = models.IntegerField() # cet attribut est un nombre entier
            </code></pre>
            
            <p>Ensuite, effectuez l'opération de <code>makemigrations</code> suivi de l'opération de <code>migrate</code>,
                vous pouvez lire la différence entre ces deux commandes <a href="#makemigrations_vs_migrate">ci-dessous</a> mais ce n'est pas important de savoir cela à votre échelle.
            
            <p class="comment">Pour le stage de Solvay, faites clic droit dans Eclipse puis choissiez migrate ou makemigrations ou passez par le terminal
                en écrivant <code class="bash">python3 manage.py makemigrations</code>
                ou <code class="bash">python3 manage.py migrate</code>.
            
            <p class="comment">Pour sciences éco, vous devrez passer par la console, <a href="#virtualenv">activer le virtualenv</a> si ça n'est pas déjà fait,
                puis lancer <code class="bash">python manage.py makemigrations</code>
                ou <code class="bash">python manage.py migrate</code>.
                
            <div class="developpement" symbol="virtualenv">
                <hr/>
                <p>Beaucoup d'installations python comme celle utilisée en sciences éco
                utilise le concept de <code>virtualenv</code> qui permet de gérer des versions de python.
                
                <p>Dans votre console, si le texte affiché est comme une de ces trois lignes-ci :
                
                <pre><code class="bash">
                    12:00 ~ $
                    12:00 ~/dossier $
                    user@host ~/dossier $
                </code></pre>
                
                <p>... c'est que vous n'êtes <strong>pas</strong> dans le virtualenv, il faut avoir une ligne comme celles-ci :
                
                <pre><code class="bash">
                    (django2) 12:00 ~ $
                    (django2) 12:00 ~/dossier $
                    (django2) user@host ~/dossier $
                </code></pre>
                
                <p>Si la ligne commence par un nom entre parenthèses, c'est que vous êtes dans le virtualenv.
                Dans les exemples ici j'étais dans le virtualenv appelé <code>django2</code>.
                
                <p>Pour activer un virtualenv en sciences éco sur pythonanywhere, lancez cette commande :
                
                <pre><code class="bash">
                    workon django2
                </code></pre>
                
                <p>Une fois dans le virtualenv, la commande <code>python</code> pourra être utilisée correctement
                    (et d'autres commandes utiles comme <code>pip</code> ou <code>django-admin</code> que nous n'utiliserons pas en sciences éco).
                <hr/>
            </div>
            
            <p></p>
                
            <div id="makemigrations_vs_migrate">
            <ul class="developpement" symbol="makemigrations vs migrate" >
                <li><code>makemigrations</code> va regarder les changements faits dans models.py et va créer un fichier python dans le dossier migrations, qui <em>décrit</em> les différences, en l'occurence ici, on crée une nouvelle table qui contient deux attributs.
                <li><code>migrate</code> modifie effectivement la base de données, en l'occurence ici va créer une nouvelle table, on verra plus tard ce qu'il peut arriver à ce moment-ci.
            </ul>
            </div>
            
            <p>Vous avez donc une <strong>base de données</strong> qui s'est créée !
                C'est le petit fichier <code class="txt">db.sqlite3</code> ! (Pour Solvay)
                
            <p class="comment">Comment ouvrir ce fichier ?
                Clic droit dessus
                > Open With
                > Other Program
                > tappez <em>sqlitebrowser</em>
                > sélectionnez <em>DB Browser for sqlite</em>
                > cochez la case <em>toujours utiliser ce programme</em>
                > OK.
            
            <p class="comment">En sciences éco, les professeurs ont choisi d'utiliser directement mysql,
                qui est un moteur plus élaboré de bases de données,
                et donc il n'est donc pas aussi facile de voir le contenu de la base de donnée,
                mais en <a href="https://docs.djangoproject.com/fr/2.0/intro/tutorial02/#introducing-the-django-admin">activant l'admin</a>
                vous pourrez voir vos modèles, il y a également moyen de configurer votre projet pour utiliser sqlite
                et le fichier <code class="bash">db.sqlite3</code>
                sera alors téléchargeable puis lisible avec le programme <a href="http://sqlitebrowser.org/">sqlitebrowser</a>.
                
            <div class="developpement" symbol="Comment configurer le projet pour utiliser sqlite (facultatif)">
                <hr/>
                <p>Dans le fichier settings, recherchez la ligne <code>DATABASES = {...}</code>, mettez toutes ces lignes en commentaire 
                en y insérant un hashtag <code>#</code> au début des lignes, puis remplacez ça par :
                
                <pre><code>
                DATABASES = {
                    "default": {
                        'ENGINE': 'django.db.backends.sqlite3',
                        'NAME': os.path.join(BASE_DIR, 'db.sqlite3'),
                    }
                }
                </pre></code>
                
                <p>Vous devrez relancer <code>makemigrations</code> et <code>migrate</code> après.
                <hr/>
            </div>  
            
            <p>Vous verrez le contenu de la base de données ! Remarquez que la création de notre modèle <code>Question</code>
                correspond bien à la table <code>askme_question</code>.
                
            <p>Allez dans la table en question, et <strong>créez y quelques questions</strong>
                (en cliquant sur <em>Nouvel enregistrement</em>).
            
            <p>Vous voyez donc qu'une <strong>base de données</strong>, c'est <strong>comme un Excel</strong>,
            plusieurs tableaux de valeurs.
            
            <p class="comment">Cependant, une base de donnée présente des avantages par rapport au Excel, comme pouvoir être lue facilement depuis un code,
            ou vérifier certains tests, nous verrons ça plus tard.
            
            <p>Ce qui m'amène à faire un petit tableau de terminologie de bases de données :
            
            <table>
            <tr> <th>SQL</th>     <th>Django</th>   <th>Excel</th>   </tr>
            <tr> <td>Table</td>   <td>Modèle</td>   <td>Feuille</td> </tr>
            <tr> <td>Colonne</td> <td>Attribut</td> <td>Colonne</td> </tr>
            <tr> <td>Ligne</td>   <td>Objet</td>    <td>Ligne</td>   </tr>
            </table>
            
            <p>Remarquez également que les <em>modèles django</em> sont des <em>classes Python</em>
            donc j'utiliserai souvent le mot <em>classe</em> pour <em>modèle</em> (quand c'est sous entendu que c'est bien un modèle et pas une simple classe Python).
            
            <p>En voyant la liste des tables, vous avez vu que django utilie des tables pour son usage interne,
                comme par exemple, une classe <code>User</code> qui gère les password et les login de manière sécurisées (on l'utilisera à la fin de ce tutoriel).
                
            <p class="comment">On préférera donc utiliser cette classe toute faite de django plutôt que de la recoder sois-même
                (ça nous évitera de se faire hacker et d'apprendre beaucoup de bonnes pratiques de sécurité, comme le <em>hash</em> des passwords, les <em>rainbow table</em> et autres joyeusetés).
            
            <p>Finalement, remarquez que <strong>tout modèle django a un attribut id</strong>,
                et que cet attribut s'appelle également <strong>pk</strong>
                comme <strong>p</strong>rimary <strong>k</strong>ey,
                c'est un nombre qui sera garantit être unique.
            
            <p class="comment">Cette garantie d'être unique est un des exemples
                pour lequel une base de données, c'est plus qu'un Excel.
            
            <p>Dans les slides du cours, on activait l'admin de django pour rajouter facilement des objets,
                ici on va directement modifier les données (sans passer par l'admin).
            
            <p><code>admin</code> est une application django créée qui ne fait que modifier la base de données, on peut donc s'en passer.
            
            <p class="comment">J'utiliserai le terme <em>db</em> (<em>database</em>) ou <em>bdd</em> (base de données)
                car ce concept est récurrent et <em>base de données</em> c'est long à dire.
            
            <p>Après ce petit discours sur les bases de données, revenons un peu au code !
            
            <h3 id="exerci{{c|s}}e-5">Exerci{{c|s}}e 5{{ |}}: Une page de détail d'une question</h3>
            
            <p>Comme annoncé au début du chapitre, dans un site dynamique,
                on lira du contenu dans une <strong>base de donnée</strong> et on renverra du html qui <strong>dépend</strong> du contenu de celle-ci.
                
            <p>Essayons donc de lire une question et de l'afficher sur notre site :
            
            <ol>
                <li>Pour lire dans une base de données, on utilisera <code>Question.objects.get()</code> pour avoir une question.
                <li>Ensuite, on a reçu l'objet de la base de données, et on le garde près de nous dans une <strong>variable</strong>.
                <li>Finalement on passe la variable au template, qui attend un <strong>paramètre</strong>.
                <li>Le template pourra donc lire l'objet question qu'on lui donne, et écrire du contenu dynamique via <code>&#x7b;&#x7b; q.nom }}</code>
                par exemple pour le nom de la question.
            </ol>
            
            <p>Nous allons donc créer une nouvelle page à l'url <code class="url">/detail</code> !
            
            <pre class="developpement" symbol="urls.py (django 2.0)"><code class="py">
            urlpatterns = [
                path('hello/', views.dire_bonjour), 
                path('cv/', views.montrer_cv),      
                path('detail/', views.donner_une_question), # NEW
            ]
            </code></pre>
            
            <pre class="developpement" symbol="urls.py (django 1.11)"><code class="py">
            urlpatterns = [
                url(r'^hello/$', views.dire_bonjour), 
                url(r'^cv/$', views.montrer_cv),      
                url(r'^detail/$', views.donner_une_question), # NEW
            ]
            </code></pre>
            
            <p>Notre template aimerait recevoir un paramètre pour pouvoir écrire le nom de la question
                et le nombre de répondants, écrire des templates étant long et fatigant, il choisit de nommer le paramètre <code>q</code>
                (mais il aurait pu l'appeler autrement).
        
            <pre class="developpement" symbol="templates/detail.html"><code class="html">
            &lt;body>
                &lt;h1>Détails d'une question&lt;/h1>
                &lt;h2>Titre : &lt;em>&#x7b;&#x7b; q.nom }}&lt;/em>&lt;/h2>
                &lt;p>Cette question a accumulé un total de &#x7b;&#x7b; q.repondants }} répondants.&lt;/p>
            &lt;/body>
            </code></pre>
            
            <p>Les templates sont des artistes, ils ne se satisfieront pas d'avoir un affichage peu attractif,
            ils mélangeront nos donnnées avec du joli html pour avoir un affichage agréable à regarder.
            
            <p class="comment">Le titre sera en bleu ciel, un point c'est tout &mdash; Un template un peu insistant lors d'un business meeting.
            
            <p>Ce template veut donc une question qu'il appelle <code>q</code>,
            mais nous, le serveur, on va devoir aller demander à la base de donnée cette information,
            nous utiliserons <code>Question.objects.get()</code> comme traduction en code de <em>hello base de donnée, donne-moi <strong>une</strong> question s'il-te-plaît</em>.
            
            <pre class="developpement" symbol="views.py"><code class="py">
            def donner_une_question(request):
                a = Question.objects.get()
                ...
            </code></pre>
            
            <p>Nous gardons cette information <em>près de nous</em> dans une <strong>variable</strong>,
            rappelez-vous qu'écrire <code>a = ...</code>
            crée une variable python nommée <code>a</code>, ce choix de nom est bien entendu arbitraire.
            
            <p>Finalement, on doit donc...
            
            <ul>
                <li>donner notre variable <code>a</code>,
                <li>au template <code>detail.html</code>,
                <li>qui l'appellera <code>q</code>.
            </ul>
            
            <pre class="developpement" symbol="views.py"><code class="py">
            def donner_une_question(request):
                a = Question.objects.get()
                return render(request, "details.html", {
                    "q": a,
                })
            </code></pre>
            
            <p>Allez maintenant dans le navigateur, et observez le résultat !
            Il y a un souci, mais lequel ?
            
            <p class="developpement" symbol="Résultat">
            On demande à la base de données <strong>une</strong> question mais celle-ci nous répond
            qu'il existe plusieurs questions, et donc ne sait pas laquelle choisir !
            On doit être plus précis dans notre requête.
            </p>
            
            <p>Quand vous avez une erreur, <strong>ne vous précipitez pas dans le code</strong> pour la résoudre,
            lisez la description de l'erreur et descendez pour voir quelle ligne l'a causée.
            
            <p>On voit donc que l'erreur est dûe à la ligne <code class="py">a = Question.objects.get()</code>,
            en effet, on doit être plus précis dans notre <code>.get()</code>.
            Demandons par exemple à avoir la question dont l'id vaut 1.
            
            <pre class="developpement" symbol="views.py"><code class="py">
            def donner_une_question(request):
                a = Question.objects.get(id=1)
                return render(request, "details.html", {
                    "q": a,
                })
            </code></pre>
            
            <p>Et là, devant vos yeux ébahis, nous voyons la description de la question numéro 1 et son nombre de répondants.
            Changez le 1 en 2, et vous aurez une autre question, nous avons un site web <strong>dynamique</strong> !
            
            <p>Remarquez que <em>Afficher la source</em> nous montre bien le html <strong>généré</strong>,
                le browser a bien reçu le html <strong>généré</strong>, il n'est pas du tout au courant de notre
                communication entre nous et la base de données et entre nous et le template.
            
            <p>On peut également demander la question dont le nombre de répondants vaut 42.
            
            <pre class="developpement" symbol="views.py"><code class="py">
            def donner_une_question(request):
                a = Question.objects.get(repondants=42)
                return render(request, "details.html", {
                    "q": a,
                })
            </code></pre>
            
            <p class="comment">
                Que se passe-t-il si aucune question avec 42 répondant n'existe ?
                Et s'il y a en a plus d'une ?
                
            <p>Finalement, remarquez que vu que nous sommes en python, on peut faire ce que l'on veut, comme des <code>if</code>
            ou des <code>while</code>.
            
            <p>Essayez d'écrire cette condition: <strong>si</strong> le nombre de répondants est nul, renvoyer la réponse <em>cette question n'est <strong>pas</strong> intéressante</em>,
            <strong>sinon</strong>, renvoyez la question formattée par le template.
            
            <pre class="developpement" symbol="views.py"><code class="py">
            def donner_une_question(request):
                a = Question.objects.get(id=1)
                if a.repondants == 0:
                    return HttpResponse("Cette question n'est &lt;strong>pas&lt;/strong> intéressante")
                return render(request, "details.html", {
                    "q": a,
                })
            </code></pre>
            
            <pre class="developpement" symbol="views.py (autre solution)"><code class="py">
            def donner_une_question(request):
                a = Question.objects.get(id=1)
                if a.repondants == 0:
                    return HttpResponse("Cette question n'est &lt;strong>pas&lt;/strong> intéressante")
                else:
                    return render(request, "details.html", {
                        "q": a,
                    })
            </code></pre>
            
            <h3 id="exerci{{c|s}}e-6">Exerci{{c|s}}e 6{{ |}}: Lire la requête</h3>
            <p>Devoir changer le code source n'est pas bien pratique,
            ça serait bien si <strong>l'utilisateur</strong> pouvait tout simplement
            nous demander le numéro de la question qu'il veut pour que nous ne devions pas changer notre code source à chaque fois.
            
            <p>C'est là que le paramètre <code>request</code> entre en jeu.
            
            <p>Revenons à la discussion http entre le client et nous, le serveur.
            Le client nous envoie juste une url, <code class="url">/detail</code>, ça serait s'il pouvait dire quelque chose 
            de plus précis du genre, <em>le détail de la question numéro 1</em>, ce qui se traduira en url par :
            
            <p class="developpement"><code class="url">/detail?numero=1</code>
            
            <p>Le client nous demande donc un certain <code>numero</code>, allons-y et essayons de lire ce numéro,
            et de le mettre <em>près de nous</em> dans une <strong>variable</strong>, disons <strong>n</strong>
            (comme ça on pourra jouer avec, faire des <code>if</code> ou des <code>while</code> ou des maths).
            
            <pre class="developpement" symbol="views.py"><code class="py">
            def donner_une_question(request):
                n = request.GET['numero'] # NEW
                a = Question.objects.get(id=1)
                return render(request, "details.html", {
                    "q": a,
                })
            </code></pre>
            
            <p class="comment">Pourquoi <code>GET</code> ? Car quand on va sur une page en écrivant directement l'url ou en cliquant sur un lien,
            on fait une requête http de type <code>GET</code>, cela peut se voir dans les outils de développeurs de votre navigateur (<kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>I</kbd>)
            à l'endroit où l'on voit les informations http, nous verrons plus tard qu'elle s'oppose à la méthode <code>POST</code>.
            
            <p>Essayez d'aller sur <code class="url">/details?numero=1</code> ou <code class="url">/details?numero=2</code> et que voyez-vous ?
            Notre code donne toujours la question numéro 1 et non celle qu'on donne en paramètre... Modifions le code !
            
            <pre class="developpement" symbol="views.py"><code class="py">
            def donner_une_question(request):
                n = request.GET['numero']
                a = Question.objects.get(id=n) # NEW: id=n
                return render(request, "details.html", {
                    "q": a,
                })
            </code></pre>
            
            <p>Les deux urls <code class="url">/details?numero=1</code> ou <code class="url">/details?numero=2</code>
            affichent maintenant deux résultats différents, on a donc vraiment un site <strong>dynamique</strong> !
            
            <p>Exercice : Sur la page d'accueil
                (disons l'url <code class="url">/accueil</code> ou même l'url vide, <code class="url">/</code>),
                créez un lien html qui dira <em>viens voir ma <a>super question</a></em> et quand on cliquera sur le lien,
                on arrivera sur la page que l'on vient de créer, qui affiche la question numéro, disons, 4.
            
            <p>Maintenant, que donne l'url <code class="url">/details?numero=68</code> ?
            
            <p class="developpement">Nous n'avons pas de question numéro 68, django nous informe cela avec une erreur (<code>.get()</code> ne trouve pas l'élément).</p>
            
            <p>Peut-être que ce cas peut être géré différemment en <strong>capturant l'exception</strong> (voir <a href="progra_exceptions.py.html">théorie de python</a>).
            
            <pre class="developpement" symbol="views.py"><code class="py">
            from django.http import HttpResponseNotFound
            
            def donner_une_question(request):
                n = request.GET['numero']
                try:
                    a = Question.objects.get(id=n) # NEW: id=n
                except:
                    return HttpResponseNotFound("Pas de question ici !")
                return render(request, "details.html", {
                    "q": a,
                })
            </code></pre>
            
            <p class="comment">Notez que dans un code structuré on préférera être plus précis sur le type de l'exception, vous n'êtes pas obligé d'avoir un code aussi structuré lors du stage.
            
            <pre class="developpement" symbol="views.py (pas obligatoire)"><code class="py">
            from django.http import HttpResponseNotFound
            
            def donner_une_question(request):
                n = request.GET['numero']
                try:
                    a = Question.objects.get(id=n) # NEW: id=n
                except <mark>Question.DoesNotExist</mark>:
                    return HttpResponseNotFound("Pas de question ici !")
                return render(request, "details.html", {
                    "q": a,
                })
            </code></pre>
            
            <p class="comment">Remarquez que Django préfère utiliser des noms plutôt que des <a href="https://en.wikipedia.org/wiki/List_of_HTTP_status_codes">numéros officiels http (status code)</a>.
                Ainsi on écrira <code>HttpResponseNotFound</code> pour la 404, <code>HttpResponse</code> pour la 200,
                et plus tard nous verrons également  <code>HttpResponseBadRequest</code> pour la 400
                et <code>HttpResponseRedirect</code> pour la 301.
            
            <p>Cependant maintenant, notre ancienne url <code class="url">/detail</code> (tout court) ne marche plus.
            Peut-être que certains utilisateurs étaient très content que nous renvoyions la première question dans ce cas.
            
            <p>Comment détecter la différence entre <code class="url">/detail</code> et <code class="url">/detail?reponse=2</code> ?
            
            <pre class="developpement" symbol="views.py"><code class="py">
            def donner_une_question(request):
                <mark>if 'numero' in request.GET</mark>:
                    n = request.GET['numero']
                else:
                    n = 1 # question par défaut
                a = Question.objects.get(id=n)
                return render(request, "details.html", {
                    "q": a,
                })
            </code></pre>
            
            <p>Finalement, l'utilisateur veut peut-être être plus précis, et demander deux choses en même temps via une requête comme
            
            <pre><code class="url">/detail?reponses=20&amp;categorie=SPORT</code></pre>
            
            <p>Cela veut dire que nous aurons <strong>deux</strong> paramètres disponibles,
            respectivement <code>request.GET['reponses']</code>
            et <code>request.GET['categorie']</code>.
            
            <p>Créez un <strong>nouvel attribut</strong> dans les questions, <code>categorie</code>, cet attribut devrait valoir exactement 
            un choix parmi <code>SPORT</code>, <code>CULTURE</code>, ou <code>SCIENCES</code>.
            
            <p><code>migrate</code> se plaint, pourquoi ? Indice : Que se passe-t-il dans Excel quand on rajoute une nouvelle colonne ?
            Les anciennes questions vont avoir quoi commme valeur pour cette colonne ?
            Cela casse notre contrainte de <code>categorie in ("SPORT", "CULTURE", "SCIENCES")</code> !

            <p>Dans de pareilles requêtes (donne moi les question de sport dont le nombre de répondants vaut 20), nous devrons donc gérer plus d'une question,
            <strong>une seule variable</strong> ne sera plus utile
            et nous aurons besoin de <strong>listes</strong> !

            <h3 id="exerci{{c|s}}e-7">Exerci{{c|s}}e 7{{ |}}: Gérer des listes</h3>
            
            <p>Nous aurons besoin de deux nouvelles compétences :
            
            <ol>
                <li>Comment demander des listes à la base de données (<code>all</code>, <code>filter</code>, <code>limit</code>, <code>order_by</code>).
                <li>Comment un template peut-il afficher une liste ?
            </ol>
            
            <p>Commençons par un exemple simple, dans une nouvelle url <code class="url">/nonrepondues</code>, demandons à Django, toutes les questions sans répondants (<code>filter</code>),
            et affichons la première (souvenez-vous de comment lire le premier élément d'une liste ?).
            
            <pre class="developpement" symbol="views.py"><code class="py normal-comments">
            def pas_de_repondants(request):
                a = Question.objects.<strong>filter</strong>(repondants=0) # a est une liste, je pourrais renommer la variable a
                b = a[0] # b est une question
                return render(request, "details.html", {
                    "q": b, # on donne b au template details.html qui accepte une seule question "q"
                })
            </code></pre>
            
            <pre class="developpement" symbol="urls.py (django 2.0)"><code class="py">
            urlpatterns = [
                ...,
                path('nonrepondues/', views.pas_de_repondants),
            ]
            </code></pre>
            
            <pre class="developpement" symbol="urls.py (django 1.11)"><code class="py">
            urlpatterns = [
                ...,
                url(r'^nonrepondues/$', views.pas_de_repondants),
            ]
            </code></pre>
            
            <p>Django permet aussi de faire des requêtes contenant des comparaisons, <em>donne moi la liste des questions avec <strong>moins de 10</strong> répondants</em>
            ou en abbrégé <em>où repondants &lt; 10</em> se traduira en django <code>.filter(repondants__lt=10)</code> (<strong>l</strong>ess <strong>t</strong>han).
            
            <pre class="developpement" symbol="views.py"><code class="py">
            def pas_de_repondants(request):
                a = Question.objects.<strong>filter</strong>(repondants__lt=10)
                b = a[0]
                return render(request, "details.html", {
                    "q": b,
                })
            </code></pre>
            
            <p>Cela va donc afficher une des questions ayant moins de 10 répondants, mais on ne sait pas préduire laquelle.
            
            <p>Souvenez-vous bien de ceci :
            
            <ul>
                <li>dans une <strong>base de donnnées</strong>,
                <li>les <strong>lignes</strong>
                <li>n'ont <strong>pas d'ordre</strong>.
            </ul>
            
            <p>Et donc quand vous faites des requêtes ambigües comme <em>premier éléments de la liste des questions où repondants &lt; 10</em>
            vous devez <strong>toujours</strong> ajouter un <strong>ordre</strong>.
            Cela se fait via <strong>order_by</strong>.
            
            <p>Comment par exemple prendre la question ayant l'<code>id</code> le plus petit ?
            
            <pre class="developpement" symbol="views.py"><code class="py">
            def pas_de_repondants(request):
                a = Question.objects.filter(repondants__lt=10).order_by('id')
                b = a[0]
                return render(request, "details.html", {
                    "q": b,
                })
            </code></pre>
            
            <p>La liste sera donc triée par ordre <strong>croissant</strong> d'<code>id</code>.
            Prendre le premier élément de cette liste sera donc l'élément avec l'<code>id</code> le plus petit.
            
            <p>Les bases de données peuvent également ordonner dans l'ordre décroissant,
                ce qui se fait en django via le symbole <strong>&minus;</strong> avant le nom de l'attribut.
                
            <pre class="developpement" symbol="views.py"><code class="py">
            def pas_de_repondants(request):
                a = Question.objects.filter(repondants__lt=10).order_by('<strong>-</strong>id')
                b = a[0]
                return render(request, "details.html", {
                    "q": b,
                })
            </code></pre>
            
            <p>La question affichée sera donc celle avec le nombre de répondants plus petit que 10, dont l'indice est le plus grand.
            
            <p>Remarquez que si l'on ne met pas de condition, on obtiendra simplement <strong>tous</strong> les éléments de la base de donnnée.
            
            <pre class="developpement" symbol="views.py"><code class="py">
            def pas_de_repondants(request):
                a = Question.objects.filter().order_by('-id')
                b = a[0]
                return render(request, "details.html", {
                    "q": b,
                })
            </code></pre>
            
            <p>On affiche donc la question avec l'id le plus grand dans <strong>toute</strong> la base de donnée,
                ce qui est donc probablement la dernière créée.
            
            <p>Quand filter n'a pas d'argument comme ici, il y a en fait un raccourci plus parlant, <code>all()</code>.
            
            <pre class="developpement" symbol="views.py"><code class="py">
            def pas_de_repondants(request):
                a = Question.objects.all().order_by('-id')
                b = a[0]
                return render(request, "details.html", {
                    "q": b,
                })
            </code></pre>
            
            <p>Petit exercice, comment afficher la question avec le <strong>moins</strong> de répondants ?
            
            <pre class="developpement" symbol="views.py"><code class="py">
            def pas_de_repondants(request):
                a = Question.objects.all().order_by('repondants')
                b = a[0]
                return render(request, "details.html", {
                    "q": b,
                })
            </code></pre>
            
            <p>Comment créer un nouveau template qui contient <strong>deux</strong> variables ?
            Disons <code>p</code> et <code>q</code>, où <code>p</code> représente la question avec le plus de répondant, et <code>q</code> celle avec le moins ?
            
            <pre class="developpement" symbol="views.py"><code class="py">
            # correction à venir !
            </code></pre>
            <pre class="developpement" symbol="deux_questions.html"><code class="py">
            &lt;!-- correction à venir ! -->
            </code></pre>
            
            <p>Le template aimerait également une troisième variable, qu'il appelle <strong>somme</strong>,
            elle contient la somme des répondants des deux questions
            (indice : python a l'opérateur <code>+</code> pour additionner deux variables).
            
            <pre class="developpement" symbol="views.py"><code class="py">
            # correction à venir !
            </code></pre>
            <pre class="developpement" symbol="somme_deux_questions.html"><code class="html">
            &lt;!-- correction à venir ! -->
            </code></pre>
            
            <p>Nous pouvons bien-sûr faire la moyenne ou autre opération mathématique.
            
            <p>Sur la page d'accueil, mettez un lien <em>voir notre plus grosse question !</em> qui redirigera vers une page ayant le plus de répondants !
            
            <p class="developpement" symbol="Solution">à venir !
            
            <p class="comment">Et là, notre ami le template a décidé de nommer sa variable <strong>somme</strong>, tant de 
                rationalité dans le cerveau de notre artiste que j'en étais étonné, je ne vois qu'une seule raison 
                logique à ce changement de comportement : je suis sûr qu'il sort depuis peu
                avec une ingénieure ! &mdash;
                Discussion à la machine à café après la business meeting</p>
            
            <p>(Désolé pour mes blagues, il est tard et je ris facilement).
            
            <p>Nous manipulons des listes mais nous ne ne les voyons pas,
            ça serait bien si notre <strong>template</strong> était capable de nous afficher des listes et plus juste une seule question !
            
            <h3 id="exerci{{c|s}}e-8">Exerci{{c|s}}e 8{{ |}}: Boucles dans le template</h3>
            
            <p>Créons maintenant une url <code class="url">/summary</code>,
                qui contiendra toutes les pages, et ce, trié par répondants !
                
            <pre class="developpement" symbol="views.py"><code class="py">
            def donne_les_questions(request):
                toutes_les_questions = Question.objects.all().order_by('-repondants')
                return render(request, "liste_de_question.html", {
                    "L": toutes_les_questions,
                })
            </code></pre>
            
            <p>Nous faisons donc une requête à la base de donnée (une <em>query</em>) pour avoir notre liste,
            et nous la passons à un nouveau template qui sera capable de l'afficher.
            
            <p>En python sans dango, comment faisiez vous pour afficher tous les éléments d'une liste ?
            En utilisant <code>print()</code> essayez d'afficher les noms de toutes les questions à l'écran, le chapitre des <strong>boucles</strong> sera utile.
            
            <pre class="developpement" symbol="views.py (avec while)"><code class="py">
            def donne_les_questions(request):
                toutes_les_questions = Question.objects.all().order_by('-repondants')
                
                i = 0
                while i &lt; len(toutes_les_questions):
                    q = toutes_les_questions[i]
                    print(q.nom, q.repondants)
                    i += 1
                
                return render(request, "liste_de_question.html", {
                    "L": toutes_les_questions,
                })
            </code></pre>
            
            <p>Cependant, cette itération peut être simplifiée drastiquement avec <code>for</code> :
            
            <pre class="developpement" symbol="views.py (avec for)"><code class="py">
            def donne_les_questions(request):
                toutes_les_questions = Question.objects.all().order_by('-repondants')
                
                for q in toutes_les_questions:
                    print(q.nom, q.repondants)
                
                return render(request, "liste_de_question.html", {
                    "L": toutes_les_questions,
                })
            </code></pre>
            
            <p class="comment">De plus, utiliser <strong>for</strong> dans ce cas-ci est accompagné d'un boost de performances.
            
            <p>Et bien, sachez que le <strong>langage de template django</strong> contient également un <strong>tag</strong> 
            <code>{% for variable in list %} ... {% endfor %}</code>.
            Comment sera notre nouveau template qui accepte une liste <code>L</code> ?
            
            <pre class="developpement" symbol="liste_de_question.html"><code class="html">
            &lt;body>
                &lt;h1>Questions disponibles&lt;/h1>
                {% for q in L %}
                    &lt;h2>Question: &#x7b;&#x7b; q.nom }}&lt;/h2>
                    &lt;p>Répondants: &#x7b;&#x7b; q.repondants }}&lt;/p>
                {% endfor %}
            &lt;/body>
            </code></pre>
            
            <p>Testez maintenant cette nouvelle url !
            
            <p>Peut-être les balises html <code>&lt;ul></code> et <code>&lt;li></code> seront plus adaptés à notre affichage en liste ?
            
            <pre class="developpement" symbol="liste_de_question.html"><code class="html">
            &lt;body>
                &lt;h1>Questions disponibles&lt;/h1>
                {% for q in L %}
                    &lt;h2>Question: &#x7b;&#x7b; q.nom }}&lt;/h2>
                    &lt;p>Répondants: &#x7b;&#x7b; q.repondants }}&lt;/p>
                {% endfor %}
            &lt;/body>
            </code></pre>
            
            <p>Exercice, en python pur, comment afficher toutes les questions, mais si le nombre de répondants est nul, alors on affichera plutot <em>question pas intéressante</em> à la place du nom.
            
            <pre class="developpement" symbol="views.py"><code class="py">
            def donne_les_questions(request):
                toutes_les_questions = Question.objects.all().order_by('-repondants')
                
                for q in toutes_les_questions:
                    if q.repondants == 0:
                        print("Pas intéressante")
                    else:
                        print(q.nom, q.repondants)
                
                return render(request, "liste_de_question.html", {
                    "L": toutes_les_questions,
                })
            </code></pre>
            
            <p>Remarquez que le tag <code>{% if condition %}{% endif %}</code> existe, il est moins puissant que celui de python, mais peut parfois bien aider comme des cas comme ici.
            
            <p class="developpement" symbol="correction à venir !">correction à venir !
            
            <p>Comment afficher la liste des questions, mais en mettant en rouge les questions dont le nombre de répondants est plus petit que <strong>10</strong> ?
            
            <p class="developpement" symbol="correction à venir !">correction à venir !
            
            <p>Comment faire pour que ce paramètre est choisissable dans l'url via <code>request.GET</code> ?
            
            <p class="developpement" symbol="correction à venir !">correction à venir !
            
            <p>Comment faire pour afficher les 3 questions avec le plus de répondants ?
            
            <p class="developpement" symbol="correction à venir !">correction à venir !
            
            <p>Raccourci: peut également faire des slicing sur une liste, comme <code>L[:3]</code> pour les trois premiers d'une liste.
            
            <p class="developpement" symbol="correction à venir !">correction à venir !
            
            <p>Faire une nouvelle url, disons <code class="url">/shortlist</code> qui va afficher la liste des questions 
            avec juste le nom, mais ce nom est un <strong>lien</strong> qui va vers la vue détaillée.
            
            <p class="developpement" symbol="correction à venir !">correction à venir !
            
            <p>Affichez la catégorie de la question, mais pas en majuscule (google: mettre en minuscule dans un django template),
            et accompagnez également une petite description du style <em>Cette question est culturelle, elle parle de bla bla bla</em>.
            
            <p class="developpement" symbol="correction à venir !">correction à venir !
            
            <!-- <p>limit : only 3 last, only n last → GET parameter n
            <p>filter by a new attribute fcatégorie (validate!), mode, sport, info, phys
            <p>makemigrations, and error when migrate ! (why ?)
            <p>filter by répondants > 50
            <p>On homepage, a link to n=1 -->
            <!-- limit, filter, order by, all() is just a special case -->
            <!-- .count() et .exists() optimisations -->
            
            <!-- for in the templates -->
            
            <h3 id="exerci{{c|s}}e-9">Exerci{{c|s}}e 9{{ |}}: Les dates</h3>
            <p>Un nouveau type d'attribut est le type <code>DateTimeField</code>, il permet de stocker une <em>date et heure</em>,
            très pratique lors de la création d'un site web !
            
            <p>Créez un attribut <code>date_de_fin</code> qui indiquera la date de fin du sondage.
            
            <p class="developpement" symbol="correction à venir !">correction à venir !
            
            <p class="comment">Pure curiosité, comment cet attribut est-il représenté dans la base de donnée ?
            <p class="developpement" symbol="Solution">par une chaîne de caractère de la forme <code>2000-12-31T08:30:10</code>
            
            <p>Afficher une page qui affiche les questions qui vont bientôt se fermer !
            C'est à dire que vous aurez besoin de savoir le temps actuel (google <code>timezone.now()</code>).
            Indice : Deux dates python peuvent être comparées via <code>&lt;</code>.
            
            <p class="developpement" symbol="correction à venir !">correction à venir !
            
            <p>Comment avoir les questions finies la semaine passée ? (filter, google !).
            
            <p>Comment afficher une date dans un template au format belge 31/12/2018 ? (google !)

            <!-- <p>Python de base from datetime import datetime, timedelta, date, time, datetime.strftime, datetime.strptime -->
            <!-- <p>Petite note sur les timezone et DST (fuseaux horaires et heures d'été) UTC vs Greenwhich -->
            <!-- <p>Django et les timezone: timezone.now(), use of pytz, date in filter -->
            <!-- https://docs.djangoproject.com/en/1.11/ref/templates/builtins/#date -->
            
        </section>
        
        <h2 id="form">Les formulaires pour envoyer des données au serveur</h2>
        
        <section name="form">
            <h3 id="exerci{{c|s}}e-10">Exerci{{c|s}}e 10{{ |}}: POSTer un formulaire</h3>
            
            <h4>Le formulaire à remplir</h4>
                <p class="comment">Imaginez... la vraie vie :
                    Vous êtes à la commune (la mairie pour nos amis français), et vous voulez leur apporter des informations,
                    disons que vous avez un nouveau né à déclarer.
                    
                    Vous arrivez à l'accueil et là vous voyez <strong>Au guichet A12, service des naissances</strong>,
                    vous êtes donc parti pour le guichet A12... Qui vous donne, un <strong>formulaire</strong>.

                <p>Créer une page statique <code class="url">/formulaire_creation_question</code> qui contient un formulaire !
                    Il y aura deux attributs, le nom, et la catégorie.
                    
                    Mettez également un petit lien sur la page d'accueil pour que les utilisateurs puissent facilement le trouver.
                
                <pre class="developpement" symbol="urls.py"><code class="py">
                    urlpatterns = [
                        ...
                        path('/formulaire_creation_question', views.formulaire_creation_question),
                    ]
                </code></pre>
                <pre class="developpement" symbol="views.py"><code class="py">
                    def formulaire_creation_question(request):
                        return render(request, 'question_form.html')
                    </code></pre>
                <pre class="developpement" symbol="accueil.html"><code class="html">
                    &lt;p>Venez &lt;a href="/formulaire_creation_question">ici&lt;/a> pour créer une question !
                </code></pre>
                <pre class="developpement" symbol="question_form.html"><code class="html">
                    &lt;form> &lt;!-- à remplir au prochain point -->
                        &lt;!-- à remplir au prochain point -->
                    &lt;/form>
                </code></pre>
                
            <h4>Le contenu du formulaire : <code>&lt;input/></code></h4>
                <p>Le formulaire contient des <code>&lt;input type="text"></code>
                    ce sont les champs qui vont êtres affichés :</p>
                    
                <!--
                vous devez également indiquer vers quelle url on ira quand on clique sur le bouton <em>Envoyer</em>,
                    créez donc une <strong>autre</strong> url qui va être capable de créer une question !
                    Disons <code class="url">/create_question</code>.</p>
                -->
                
                <pre class="developpement" symbol="question_form.html"><code class="html">
                    &lt;form method="GET" action="/inconnu"> &lt;!-- on ne sait pas encore quoi mettre dans action -->
                        &lt;p>Titre de la question : &lt;input type="text" name="le_nom" />&lt;/p>
                        &lt;p>Sa catégorie : &lt;input type="text" name="la_categorie" />&lt;/p>
                    &lt;/form>
                </code></pre>
                
                <p>L'utilisateur sera donc invité à rentrer deux données, essayez la nouvelle url et admirez le formulaire !
                
                <form class="developpement" symbol="Solution" method="GET">
                    <p>Titre de la question : <input type="text" name="le_nom" /></p>
                    <p>Sa catégorie : <input type="text" name="la_categorie" /></p>
                    <p><input disabled type="submit" />
                </form>
                
                <p>Que se passe-t-il quand on clique sur <em>Envoyer</em> après avoir rempli les deux informations, disons <em>Aimez-vous la pizza ?</em> et <em>SPORT</em> ?
                
                <p class="developpement" symbol="Solution">
                    On arrive sur l'url <code class="url">/inconnu?le_nom=Aimez-vous+la+pizza+?&amp;la_categorie=SPORT</code>
            
            <h4>La cible du formulaire : L'url de traitement de l'information</h4>
                <p class="comment">La vraie vie, suite : Vous avez maintenant rempli votre formulaire à la commune (<span style="text-decoration: line-through;">la mairie</span>),
                    et au dessus vous voyez <strong>Veuillez rendre ce formulaire au guichet B42</strong>
                    en effet, le guichet B42 est spécialisé dans la modification des dossiers des citoyens, pas dans la remise de formulaire.
                    Le guichet B42 c'est pas le A12, voyons.
            
                <p>On arrive donc sur une autre url, qui contient des paramètres <code>GET</code> !
                    On peut donc faire une url dont le but sera de <strong>créer une question</strong>.
                    
                <pre class="developpement" symbol="question_form.html"><code class="html">
                    &lt;form method="GET" action="<mark>/creer_une_question</mark>"> 
                        &lt;p>Titre de la question : &lt;input type="text" name="le_nom" />&lt;/p>
                        &lt;p>Sa catégorie : &lt;input type="text" name="la_categorie" />&lt;/p>
                        &lt;p><mark>&lt;input type="submit" /></mark>
                    &lt;/form>
                </code></pre>
                <pre class="developpement" symbol="urls.py"><code class="py">
                    urlpatterns = [
                        ...
                        path('/creer_une_question', views.creer_une_question),
                    ]
                </code></pre>
                <pre class="developpement" symbol="views.py"><code class="py">
                    def creer_une_question(request):
                        a = request.GET['le_nom']
                        b = request.GET['la_categorie']
                        print('On veut créer une question dont le nom est', a, 'et la catégorie', b)
                        return HttpResponse('Création réussie !')
                </code></pre>
                
                <p>On fera donc bien la différence entre la page statique qui donne le formulaire et indique où aller après,
                    et la deuxième url qui fait effectivement l'action (modifier la base de données !).
            
            <h3 id="exerci{{c|s}}e-11">Exerci{{c|s}}e 11{{ |}}: Modifier la base de donnée</h3>
                <p>Pour créer un objet dans la base de données, rien de plus simple, créez un objet Python comme <code>q = Question()</code>, mettez ses attributs
                    (le nombre de répondants commence à 0), puis appelez <code>q.save()</code> qui va sauvegarder l'objet dans la base de donnée.
                
                <pre class="developpement" symbol="views.py"><code class="py">
                    def creer_une_question(request):
                        a = request.GET['le_nom']
                        b = request.GET['la_categorie']
                        
                        <mark>q = Question() </mark> # 1) on crée un objet
                        <mark>q.nom = a      </mark> # 2) on lui met ses attributs
                        <mark>q.categorie = b</mark>
                        <mark>q.repondants = 0</mark>
                        <mark>q.save()       </mark> # 3) on le sauve dans la base de donnée
                        return HttpResponse('Création réussie !')
                </code></pre>
                
                <p>Django permet également un petit raccourci pour rapidement mettre des données dans un nouvel objet :
                
                <pre class="developpement" symbol="views.py"><code class="py">
                    def creer_une_question(request):
                        a = request.GET['le_nom']
                        b = request.GET['la_categorie']
                        
                        <mark>q = Question(nom=a, categorie=b, repondants=0)</mark>
                        <mark>q.save()</mark>
                        
                        return HttpResponse('Création réussie !')
                </code></pre>
                
                <p>Et Django contient même <code class="developpement" symbol="un autre raccourci">Question.objects.create(nom=a, categorie=b, repondants=0)</code> qui fait les trois opérations en un coup
                    mais rappelez vous surtout de la première manière qui sépare bien les 3 étapes.
                    
                <p>Essayez de remplir le formulaire, et vérifiez que l'objet a bien été créé dans la base de donnée !
            
                <p>Chaque input aura un nom (<code>name</code> dans le html), c'est ce nom qui sera accessible dans django dans le paramètre de la requête.
                    Essayez d'appeler simplement vos deux <code>input</code> <code>name="premier"</code> et <code>name="deuxieme"</code>,
                    que devez vous changer dans le code python quand vous renommez ces deux <code>input</code> ?
            
            <h3 id="exerci{{c|s}}e-12">Exerci{{c|s}}e 12{{ |}}: Redirection avec http 301</h3>
                <p>Quand la donnée a été sauvegardée, on doit bien entendu renvoyer une réponse, par exemple <em>Création réussie</em>,
                mais peut être que si tout se passe bien, on aimerait aller sur une autre page. On peut utiliser si l'on veut une 
                Http 301 Redirect :
                
                <pre class="developpement" symbol="views.py"><code class="py">
                    def creer_une_question(request):
                        a = request.GET['le_nom']
                        b = request.GET['la_categorie']
                        q = Question(nom=a, categorie=b)
                        q.save()
                        <mark>return HttpResponseRedirect('/accueil')</mark>
                </code></pre>
                
                <p class="comment">Dans les outils de développement, Ctrl+Shift+I, onglet réseau on voit que l'on a d'abord été sur la première url qui nous donne le formulaire,
                    puis sur <code class="url">/creer_une_question</code>
                    qui nous renvoie (status = 301) (Redirect) pour dire <em>tout s'est bien passé, mais maintenant va sur une autre url !</em>
                    et puis nous arrivons sur <code class="url">/accueil</code> qui nous renvoie status = 200 avec la page d'accueil.
                
            <h3 id="exerci{{c|s}}e-13">Exerci{{c|s}}e 13{{ |}}: Validation</h3>
                <p>Attention, la catégorie doit bien être une des 3 valeurs autorisées, <code>SPORT</code>, <code>SCIENCES</code>, <code>CULTURE</code>, le serveur doit vérifier cela !
                
                <p>Cette étape est une sorte de sécurité des données et est appelée <strong>Validation</strong>,
                    de la sorte, on n'acceptera pas n'importe quoi dans la base de donnée !
                    
                <p>Si l'utilisateur a écrit n'importe quoi, on fera une erreur 400 Bad Request
                accompagnée d'un petit message sympatique.
                Erreur 400 veut dire par convention, <em>erreur du client</em>
                en effet, ce gentil utilisateur, il a écrit <em>banane</em> dans le champs catégorie, quel distrait...
                
                <pre class="developpement" symbol="views.py"><code class="py">
                    def creer_une_question(request):
                        a = request.GET['le_nom']
                        b = request.GET['la_categorie']
                        
                        a = a.upper() # on convertit en majuscules
                        
                        if a == 'SPORT' or a == 'CULTURE' or a == 'SCIENCES':
                            q = Question(nom=a, categorie=b)
                            q.save()
                            return HttpResponseRedirect('/accueil')
                        else:
                            return HttpResponseBadRequest('La catégorie doit être une des catégories valides !')
                </code></pre>
                
                <p>Essayez de créer une question ayant une catégorie hors des choix possibles,
                    vous verrez maintenant un petit message d'erreur et devrez cliquer sur le bouton Retour de votre navigateur...
                
                <p>Nous verrons plus tard comment aider notre utilisateur en améliorant son <strong>interface</strong> pour qu'il ne puisse plus faire d'erreur par distraction.
                
                <div class="developpement" symbol="simplification de code !">
                    <hr/>
                    <p>En s'amusant un peu avec les <a href="progra_equivalences.html">équivalences</a>, on peut réécrire le code précédent différemment, si on préfère :
                    
                    <pre class="developpement" symbol="views.py"><code class="py">
                        def creer_une_question(request):
                            a = request.GET['le_nom']
                            b = request.GET['la_categorie']
                            
                            b = b.upper() # on convertit en majuscules
                            
                            if not(b == 'SPORT' or b == 'CULTURE' or b == 'SCIENCES'):
                                return HttpResponseBadRequest('La catégorie doit être une des catégories valides !')
                            else:
                                q = Question(nom=a, categorie=b)
                                q.save()
                                return HttpResponseRedirect('/accueil')
                    </code></pre>
                    
                    <p>C'est une inversion de condition.
                    
                    <p>ou :
                    
                    <pre class="developpement" symbol="views.py"><code class="py">
                        def creer_une_question(request):
                            a = request.GET['le_nom']
                            b = request.GET['la_categorie']
                            
                            b = b.lower() # on convertit en majuscules
                            
                            if not(b == 'SPORT' or b == 'CULTURE' or b == 'SCIENCES'):
                                return HttpResponseBadRequest('La catégorie doit être une des catégories valides !')
                            
                            q = Question(nom=a, categorie=b)
                            q.save()
                            return HttpResponseRedirect('/accueil')
                    </code></pre>
                    
                    <p>C'est utiliser la propriété du return.
                    
                    <p>Finalement la condition
                    
                    <pre><code class="py">not(b == 'SPORT' or b == 'CULTURE' or b == 'SCIENCES')</code></pre>
                    <p>peut être réécrite via les lois de logique (lois de De Morgan) en
                    
                    <pre><code class="py">b != 'SPORT' and b != 'CULTURE' and b != 'SCIENCES'</code></pre>
                    <p>ou bien en
                    
                    <pre><code class="py">b not in ('SPORT', 'CULTURE', 'SCIENCES')</code></pre>
                    <p>si l'on connaît plus de python car l'on sait que
                        <code class="py">a == 1 or a == 2</code>
                        est équivalent à
                        <code class="py">a in (1, 2)</code>
                    <hr/>
                </div>
            
            <h4>Exercices de validation</h4>
                <p>Rajoutez une autre validation, on aimerait que le nom de la question soit d'au moins 10 caractères.
                
                <pre class="developpement" symbol="views.py"><code class="py">
                    def creer_une_question(request):
                        a = request.GET['le_nom']
                        b = request.GET['la_categorie']
                        
                        b = b.lower() # on convertit en minuscule
                        
                        if len(a) &lt; 10:
                            return HttpResponseBadRequest("Veuillez entrer une plus longue question s'il vous plaît.")
                            
                        if b == 'sport' or b == 'culture' or b == 'sciences':
                            q = Question(nom=a, categorie=b)
                            q.save()
                            return HttpResponseRedirect('/accueil')
                        else:
                            return HttpResponseBadRequest('La catégorie doit être une des catégories valides !')
                </code></pre>
                
                <p>On peut faire absoulment tout ce que l'on veut vu qu'on est dans du code python !
                    Essayez par exemple de n'accepter que les questions qui finissent par un point d'interrogation.
                    
                <pre class="developpement" symbol="views.py"><code class="py">
                # à venir !
                </code></pre>
                    
                <p>Ou bien d'en rajouter un s'il n'y en n'a pas.
                
                <pre class="developpement" symbol="views.py"><code class="py">
                # à venir !
                </code></pre>
            
            <!-- Every input element, that have a name, are sent -->
            <!--
            <p>Form: create a question, you need two attributes, name, and type.
            <p>Test the type !
            <p>New view that does "create_question" vs "create_question_form", two urls
            -->
            <!-- (5 minutes, form) -->
            
            <!--
            <h3 id="exerci{{c|s}}e-11">Exerci{{c|s}}e 10{{ |}}: Redirections avec http 301</h3>
            <p>Quand le formulaire Redirect
            (2 minutes)
            <p>→ ctrl shift I, 301
            -->

            <h3 id="exerci{{c|s}}e-14">(Facultatif) Exerci{{c|s}}e 14{{ |}}: Html bonus more input elements</h3>
            <p>À partir d'ici, cette section est en cours d'écriture, donc si vous êtes arrivés jusque ici en guidances, venez me voir (Robert Vanden Eynde sur facebook) et je vous raconterai l'essentiel !
            
            <p>Html, change the type using a &lt;select>
            <p>Html, have a <code>&lt;textarea></code> for a new attribute <code>description</code>
            <p>Html, checkbox, if checked will be <code>in request.GET</code>, else, won't be.
            
            <h3 id="exerci{{c|s}}e-15">(Facultatif) Exerci{{c|s}}e 15{{ |}}: method <code>POST</code> vs <code>GET</code></h3>
            <p class="comment">Ça serait quand même plus simple si ces deux guichets étaient au même endroit.
            
            <p>À partir d'ici, cette section est en cours d'écriture, donc si vous êtes arrivés jusque ici en guidances, venez me voir (Robert Vanden Eynde sur facebook) et je vous raconterai l'essentiel !
            
            <p>How to merge the two views ? (Not mandatory to do so, one can choose to always have two different urls).
            <!-- (3 min, merge) -->
            <ul>
                <li>One could do <em>if the form has some missing field, return the form, else process the data</em>
                <li>→ method=POST vs GET, POST is more logical than GET for most forms.
                <li>GET doesn't modify the database, POST does (that's just a convention).
                <li>POST hides the data from the URL, url are often shared and sometimes written
                    (parameters may contain sensitive data, and accidentally be sent to a friend)
                    but you can see it in Ctrl+Shift+I (still sent in the enveloppe)
                    or <code>print(request.POST)</code>.
                    Google <em>difference between POST and GET in website architecture</em>
                <li>POST enables file upload (google <em>how to upload files</em>).
                    → html <code>enctype="multipart/form-data"</code>
                    → django <code>request.FILES</code>
                <li>POST in django has a security called <em>csrf</em> enabled by default,
                    when writing a <code class="html">&lt;form></code> with <code class="html">method="POST"</code>
                    one must include <code class="html">{% crsf_token %}</code> in the form.
            </ul>
            
            <p>→ If you want to merge the two views, use <code>if request.method == 'POST':</code>, the user explicitly says <em>I want to modify the db</em>.
                <em>I want to post something</em>. And not only <em>I want to GET something</em>.
            <!-- (2 min, using post) -->
            
            <h3 id="exerci{{c|s}}e-16">Exerci{{c|s}}e 16{{ |}}: QCM</h3>
            <p>How to have different possible answers stored in the db ?
            <p>What would you do on an Excel ?
            <p>→ Columns answer1, answer2, answer3, count1, count2, count3
            <p>→ It sounds stupid, we'll get to that later (chapter relational databases).
            <!-- (3 min) Create the 3 columns with the stupid 1 2 3 names. -->
            
            <h3 id="exerci{{c|s}}e-17">Exerci{{c|s}}e 17{{ |}}: QCM le &lt;form></h3>
            <p>Form with a single attribute : num answer (people just write 1, 2 or 3 to choose).
            <p>→ A form that will modify the database, the 4 bases of the database: CRUD (Create, Read, Update and Delete).
                Update means modify.
            <!-- 5 minutes: implement the Answer stuff -->
            
            <h3 id="exerci{{c|s}}e-18">Exerci{{c|s}}e 18{{ |}}: Html bonus radio</h3>
            <p>Change html, type=radio
            
            <p>Order by répondants don't forget to +1 !
            <p>New page <code class="url">show_answers?numero=4</code>: Show answsers for one question, sot by votes ?
            <p>Only show answers if the date is over, otherwise redirect to the <em>answer form</em>.
            <p>People can answer only if the date is not over.
            <!-- 3 minutes: html radio, order by répondants -->
        </section>
        
        <h2 id="bddr">Les bases de données... <em>relationnelles</em></h2>
        
        <section name="bddr">
            <p>Cette section est en cours d'écriture, donc si vous êtes arrivés jusque ici en guidances, venez me voir (Robert Vanden Eynde sur facebook) et je vous raconterai l'essentiel !
            
            <h3 id="exerci{{c|s}}e-19">Exerci{{c|s}}e 19{{ |}}: Foreign key, the holy grale</h3>
            <p>Reponse object ! Base de données relationnelles ! How would you do that in excel ?
            <p>Reponse(name, text, votes) Open sqlite, create some
            <!-- <p>Change design: reponse_pk -->
            <p>How to have the list of all reponse, that belongs to a question 4 ? (filter !)
            <p>We have a <span style="color:red">1</span> to <span style="color:blue">N</span> relation because,
                1 Reponse is linked to <span style="color:red">1</span> Question,
                but 1 Question is linked to <span style="color:blue">N</span> Reponse. 
            <!-- 5 minutes: Reponse Object, Foreign key -->
            
            <h3 id="exerci{{c|s}}e-20">Exerci{{c|s}}e 20{{ |}}: Reuse code from others <code>django.auth.User</code></h3>
            <p>Users, login, cookies, hashpassword → use code from others ! Here <code>django.contrib.auth</code> (look at <a href="https://github.com/django/django/blob/master/django/contrib/auth/models.py#L288">source code</a>, almost a super simple class)
            <p>Create users from the admin, or <code>class User</code> (<code class="py">from django.contrib.auth.models import User</code>)
            <p>Cookie, django does use auth cookies. See source code.
            <p>Cookies in the browser : look at ctrl shift I, private browsing
            <p>New user form, uername, email, (send email saying hello !), password is hashed !
            (See db, or shell), verify there is a <code>@</code> in the email.
            <!-- 5 minutes: new user form -->
            
            <h3 id="exerci{{c|s}}e-21">Exerci{{c|s}}e 21{{ |}}: Profile, Foreign key to other class</h3>
            <p>Profile : Foreign key to User, add stuffs like, phone number, color preferences, anything relevant to your app.
            <p>Boolean, creator, can create questions, or builtin is_staff, can connect to the admin.
            <!-- 3 minutes: foreign key for Profile -->
            <p>→ There is also this programming concept called Inheritance (Héritage),
                that will just create a foreign key but new attributes are available without <code>.profile</code>. 
            
            <h3 id="exerci{{c|s}}e-22">Exerci{{c|s}}e 22{{ |}}: N to N relations</h3>
            <p>The relation <em>User has answered Question</em>, or <em>Answered</em> is a N to N relation !
                1 User has answered N Question.
                And 1 Question can be modified by N Users.
                Or 1 Question has a list of modifiers.
                And 1 User has a list of Questions she can modify.
            <p>How would you do that in Excel ?
            <!-- 3 minutes, N to N relation -->
            
            <h3 id="exerci{{c|s}}e-23">Exerci{{c|s}}e 23{{ |}}: N to N relations through a model</h3>
            <p>N to N relationship are not <em>fundamental</em> because they are just two N-1 1-N relations.
                Indeed, when we say <em>we have a N to N relationship Answered between Users and Questions</em> or
                <em>A user has a list of (answered) Questions and a Question has a list of (answered) Users</em>...
                Is a shortcut for saying <em>A user has a list of Answer, an Answer has one Question</em> and 
                <em>A Question has a list of Answers, an Answer has one User</em>.
            <p>N to N relationship <strong>through</strong> model (here Answer).
            <p>Can add arbitrary stuffs like <em>this user has answered this question... on this date</em>.
            <!-- 3 minutes, through -->
            
            <h3 id="exerci{{c|s}}e-24">Exerci{{c|s}}e 24{{ |}}: related_name, multiple FK and self FK</h3>
            
            <p>Given models like this :
            
            <pre><code>
                class Student(Model):
                    pass
                    
                class Message(Model):
                    sender = ForeignKey(Student)
                    likes = IntegerField()
            </code></pre>
            
            <p>How to get all the messages of a selected student <code>s</code> ?
             Or only the one that had at least 10 likes ?
            
            <pre><code>
                s = Student.objects.get(id=5)
                Message.objects.filter(student=5) # all
                Message.objects.filter(student=5).filter(likes__gte=10) # at least 10 likes
            </code></pre>
            
            <p>Django also allow us to use reverse relationship, using <code>s.message_set</code> :
            
            <pre><code>
                s = Student.objects.get(id=5)
                s.message_set.all() # all
                s.message_set.filter(likes_gte=10) # at least 10 likes
            </code></pre>
            
            <p>That would be translated to <em>Give me the set of all the messages of that student</em>.
            
            <p>Django chose the name message_set as a default name based on the name of the <code>class Message</code>.
            
            <p>If one doesn't want this <em>reverse relationship</em> to be created, one can write <code>related_name='+'</code> in the model.
            
            <pre><code>
                class Message(Model):
                    sender = ForeignKey(Student, <mark>related_name='+'</mark>)
                    likes = IntegerField()
            </code></pre>
            
            <p>u.student_set would raise an exception.
            
            <p>If one want to change the name of this <em>reverse relationship</em>, one can write <code>related_name='name'</code> in the model.
            
            <pre><code>
                class Message(Model):
                    sender = ForeignKey(Student, <mark>related_name='messages'</mark>)
                    likes = IntegerField()
            </code></pre>
            
            <p>Then it can be used :
            
            <pre><code>
                s = Student.objects.get(id=5)
                s<mark>.messages</mark>.filter(likes__gte=10)
            </code></pre>
            
            <p>If one uses multiple times a relation between the same models, like here :
            
            <pre><code>
                class Student(Model):
                    university = ForeignKey(University)
                    age = IntegerField()
                
                class Message:
                    sender = ForeignKey(Student)
                    receiver = ForeignKey(Student)
            </code></pre>
            
            <p>Django could complain, because what would it mean <em>Give the set of all messages of that student</em>.
            What would <code>message_set</code> mean on a student ?
            
            <p>In that case one would have to set both the relations <code>related_name='+'</code> or some names like :
            
            <pre><code>
                class Student(Model):
                    university = ForeignKey(University)
                    age = IntegerField()
                
                class Message:
                    sender = ForeignKey(Student, related_name='messages_sent')
                    receiver = ForeignKey(Student, related_name='messages_received')
            </code></pre>
            
            <p>One could then write :
            
            <pre><code>
                s = Student.objects.get(id=5)
                
                A = Message.objects.filter(sender=s)
                A = s.messages_sent.all() # shortcut
                
                B = Message.objects.filter(receiver=s)
                B = s.messages_received.all() # shortcut
            </code></pre>
            
            <h3 id="exerci{{c|s}}e-25">Exerci{{c|s}}e 25{{ |}}: More django: clean <code>GET</code> urls</h3>
            <p>Django: URL regex, use django 2 ! (Clean GET parameters) 
            
            <h3 id="exerci{{c|s}}e-26">Exerci{{c|s}}e 26{{ |}}: Cookies et sessions</h3>
        </section>
    </div>
    </body>
</html>
